<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.126.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="污点分析初探"><meta itemprop=description content="集中一点,登峰造极"><meta name=description content="集中一点,登峰造极"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://zp9080.github.io/imgs/author.png"><meta itemprop=keywords content="污点分析"><meta property="og:type" content="article"><meta property="og:title" content="污点分析初探"><meta property="og:description" content="集中一点,登峰造极"><meta property="og:image" content="/imgs/author.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://zp9080.github.io/post/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2/"><meta property="og:site_name" content="f1ow-blog"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="f1ow"><meta property="article:published_time" content="2024-10-25 20:29:25 +0800 CST"><meta property="article:modified_time" content="2024-10-25 20:29:25 +0800 CST"><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/font-awesome/6.6.0/css/all.min.css><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/animate.css/4.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href=/css/main.min.bfbac3431de920c11b5b1cafa45029ea1bc93d5d3da50fed4ab6924b4c250360.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2","permalink":"https://zp9080.github.io/post/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2/","title":"污点分析初探","waline":{"js":[{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"2.15.8"},{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>污点分析初探 - f1ow-blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><div class=overlay></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>f1ow-blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>集中一点,登峰造极</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>207</span></a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-categories hvr-icon"></i>分类</a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#污点分析基本原理>污点分析基本原理</a><ul><li><a href=#污点分析定义>污点分析定义</a></li><li><a href=#识别污点源和汇聚点>识别污点源和汇聚点</a></li><li><a href=#污点传播分析>污点传播分析</a></li><li><a href=#无害处理>无害处理</a></li></ul></li><li><a href=#污点传播分析的关键技术>污点传播分析的关键技术</a><ul><li><a href=#污点传播中的显式流分析>污点传播中的显式流分析</a><ul><li><a href=#静态分析技术>静态分析技术</a></li><li><a href=#动态分析技术>动态分析技术</a></li></ul></li><li><a href=#污点传播中的隐式流分析>污点传播中的隐式流分析</a></li></ul></li><li><a href=#污点分析方法实现>污点分析方法实现</a><ul><li><a href=#静态污点分析技术>静态污点分析技术</a></li><li><a href=#动态污点分析>动态污点分析</a></li></ul></li><li><a href=#总结>总结</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=f1ow src=/imgs/img-lazy-loading.gif data-src=/imgs/author.png><p class=site-author-name itemprop=name>f1ow</p><div class=site-description itemprop=description>集中一点,登峰造极</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>207</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>38</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>80</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/zp9080 title="Github → https://github.com/zp9080" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://v3rdant.cn/ title=https://v3rdant.cn/ target=_blank>v3rdant</a></li><li class=links-of-blogroll-item><a href=https://juicymio.github.io/ title=https://juicymio.github.io/ target=_blank>juicymio</a></li><li class=links-of-blogroll-item><a href=https://ka7arotto.github.io/ title=https://ka7arotto.github.io/ target=_blank>Goku</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2024-07-28T00:00:00+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=273686></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=660></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2025-02-27T17:57:37+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/zp9080 rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://zp9080.github.io/post/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/author.png"><meta itemprop=name content="f1ow"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="f1ow"><meta itemprop=description content="集中一点,登峰造极"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="污点分析初探"><meta itemprop=description content></span><header class=post-header><h1 class=post-title itemprop="name headline">污点分析初探
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/post/%e6%b1%a1%e7%82%b9%e5%88%86%e6%9e%90/%e6%b1%a1%e7%82%b9%e5%88%86%e6%9e%90%e5%88%9d%e6%8e%a2.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2024-10-25 20:29:25 +0800 CST" itemprop="dateCreated datePublished" datetime="2024-10-25 20:29:25 +0800 CST">2024-10-25
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90 itemprop=url rel=index><span itemprop=name>AEG/污点分析</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>5411</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>11分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p><a href=https://ch3nye.top/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E7%AC%94%E8%AE%B0/ title=超级超级超级详细的参考博客 rel="noopener external nofollow noreferrer" target=_blank class=exturl>超级超级超级详细的参考博客
<i class="fa fa-external-link-alt"></i></a></p><p>这篇博客可以说是非常详尽了，里面讲述了如下内容，以下部分是记得一些笔记和理解</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>污点分析基本原理
</span></span><span style=display:flex><span>污点传播分析的关键技术
</span></span><span style=display:flex><span>污点分析方法实现:静态、动态、显式、隐式污点分析
</span></span></code></pre></div><h1 id=污点分析基本原理>污点分析基本原理
<a class=header-anchor href=#%e6%b1%a1%e7%82%b9%e5%88%86%e6%9e%90%e5%9f%ba%e6%9c%ac%e5%8e%9f%e7%90%86></a></h1><h2 id=污点分析定义>污点分析定义
<a class=header-anchor href=#%e6%b1%a1%e7%82%b9%e5%88%86%e6%9e%90%e5%ae%9a%e4%b9%89></a></h2><p>污点分析可以抽象成一个<strong>三元组&lt;sources,sinks,sanitizers>的形式</strong>,其中,source 即污点源,代表直接引入不受信任的数据或者机密数据到系统中;sink 即污点汇聚点,代表直接产生安全敏感操作(违反数据完整性)或者泄露隐私数据到外界(违反数据保密性);sanitizer 即无害处理,代表通过数据加密或者移除危害操作等手段使数据传播不再对软件系统的信息安全产生危害.
<strong>污点分析就是分析程序中由污点源引入的数据是否能够不经无害处理,而直接传播到污点汇聚点</strong>.如果不能,说明系统是信息流安全的;否则,说明系统产生了隐私数据泄露或危险数据操作等安全问题.</p><p>在漏洞分析中,使用污点分析技术将所感兴趣的数据(通常来自程序的外部输入,假定所有输入都是危险的)标记为污点数据,然后通过跟踪和污点数据相关的信息的流向,可以知道它们是否会影响某些关键的程序操作,进而挖掘程序漏洞.
即将<strong>程序是否存在某种漏洞的问题转化为污点信息是否会被 Sink 点上的操作所使用的问题.</strong></p><p>污点分析的处理过程可以分成 3 个阶段:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>(1) 识别污点源和汇聚点;(根据所分析的系统的不同使用定制的识别策略)
</span></span><span style=display:flex><span>(2) 污点传播分析;(利用特定的规则跟踪分析污点信息在程序中的传播过程)
</span></span><span style=display:flex><span>(3) 漏洞检测、无害处理
</span></span></code></pre></div><p><img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/69.png alt></p><h2 id=识别污点源和汇聚点>识别污点源和汇聚点
<a class=header-anchor href=#%e8%af%86%e5%88%ab%e6%b1%a1%e7%82%b9%e6%ba%90%e5%92%8c%e6%b1%87%e8%81%9a%e7%82%b9></a></h2><p>现有的识别污点源和汇聚点的方法可以大致分成 3 类:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>(1)使用启发式的策略进行标记,例如把来自程序外部输入的数据统称为“污点”数据,保守地认为这些数据有可能包含恶意的攻击数据(如 PHP Aspis);
</span></span><span style=display:flex><span>(2)根据具体应用程序调用的 API 或者重要的数据类型,手工标记源和汇聚点(如 DroidSafe[12]);
</span></span><span style=display:flex><span>(3)使用统计或机器学习技术自动地识别和标记污点源及汇聚点.[11]
</span></span></code></pre></div><h2 id=污点传播分析>污点传播分析
<a class=header-anchor href=#%e6%b1%a1%e7%82%b9%e4%bc%a0%e6%92%ad%e5%88%86%e6%9e%90></a></h2><p>污点传播分析就是分析污点标记数据在程序中的传播途径.按照分析过程中关注的程序依赖关系的不同, 可以将污点传播分析分为显式流分析和隐式流分析.</p><p><strong>(1)显示流分析</strong></p><p>污点传播分析中的显式流分析就是分析污点标记如何随程序中<strong>变量之间的数据依赖关系</strong>传播. <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/70.png alt></p><p><strong>(2)隐式流分析</strong></p><p>污点传播分析中的隐式流分析是分析污点标记如何随程序中变量之间的<strong>控制依赖关系</strong>传播,也就是分析污点标记如何从<strong>条件指令传播到其所控制的语句</strong>. <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/71.png alt></p><h2 id=无害处理>无害处理
<a class=header-anchor href=#%e6%97%a0%e5%ae%b3%e5%a4%84%e7%90%86></a></h2><p>污点数据在传播的过程中可能会经过无害处理模块,<strong>无害处理模块是指污点数据经过该模块的处理后,数据本身不再携带敏感信息或者针对该数据的操作不会再对系统产生危害</strong>.换言之,带污点标记的数据在经过无害处理模块后,污点标记可以被移除.<strong>正确地使用无害处理可以降低系统中污点标记的数量,提高污点分析的效率,并且避免由于污点扩散导致的分析结果不精确的问题.</strong></p><p>在应用过程中,为了防止敏感数据被泄露(保护保密性),通常会对敏感数据进行加密处理.此时,<strong>加密库函数应该被识别成无害处理模块</strong>.这一方面是由于库函数中使用了大量的加密算法,导致攻击者很难有效地计算出密码的可能范围;另一方面是加密后的数据不再具有威胁性,继续传播污点标记没有意义.</p><p>此外,为了防止外界数据因为携带危险操作而对系统关键区域产生危害(保护完整性),通常会对输入的数据进行验证.此时,<strong>输入验证(input validation)模块应当被识别成无害处理模块</strong>.例如,为了防止代码注入漏洞,PHP 提供的 htmlentities 函数可以将特殊含义的 HTML 字符串转化成HTML实体(例如,将&rsquo;&lt;&lsquo;转化成’&lt;&rsquo;).输入字符串经过上述转化后不会再携带可能产生危害的代码,可以安全地 发送给用户使用.除了语言自带的输入验证函数外,一些系统还提供了额外的输入验证工具,比如ScriptGard[50],CSAS[51],XSS Auditor[]52,Bek[53].这些工具也应被识别成无害处理模块.</p><p>综上,目<strong>前对污点源、污点汇聚点以及无害处理模块的识别通常根据系统或漏洞类型使用定制的方法.由于这些方法都比较直接</strong>,本文将不再进行更深入的探讨.下一节将重点介绍污点传播中的关键技术.</p><p>总结一下,使用污点分析检测程序漏洞的工作原理如下图所示：
<img src=/imgs/img-lazy-loading.gif data-src=/imgs/photo5/72.png alt></p><h1 id=污点传播分析的关键技术>污点传播分析的关键技术
<a class=header-anchor href=#%e6%b1%a1%e7%82%b9%e4%bc%a0%e6%92%ad%e5%88%86%e6%9e%90%e7%9a%84%e5%85%b3%e9%94%ae%e6%8a%80%e6%9c%af></a></h1><p>污点传播分析是当前污点分析领域的研究重点.与程序分析技术相结合,可以获得更加高效、精确的污点分析结果.根据分析过程中是否需要运行程序,可以将污点传播分析分为<strong>静态污点分析和动态污点分析</strong>.本节主要介绍如何使用动/静态程序分析技术来解决污点传播中的显式流分析和隐式流分析问题.</p><h2 id=污点传播中的显式流分析>污点传播中的显式流分析
<a class=header-anchor href=#%e6%b1%a1%e7%82%b9%e4%bc%a0%e6%92%ad%e4%b8%ad%e7%9a%84%e6%98%be%e5%bc%8f%e6%b5%81%e5%88%86%e6%9e%90></a></h2><h3 id=静态分析技术>静态分析技术
<a class=header-anchor href=#%e9%9d%99%e6%80%81%e5%88%86%e6%9e%90%e6%8a%80%e6%9c%af></a></h3><p><strong>静态污点传播分析(简称静态污点分析)是指在不运行且不修改代码的前提下,通过分析程序变量间的数据依赖关系来检测数据能否从污点源传播到污点汇聚点.</strong></p><p>静态污点分析的对象一般是程序的源码或中间表示.可以将对污点传播中显式流的静态分析问题转化为对程序中静态数据依赖的分析:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>(1)首先,根据程序中的函数调用关系构建调用图(call graph,简称CG);
</span></span><span style=display:flex><span>(2)然后,在函数内或者函数间根据不同的程序特性进行具体的数据流传播分析.常见的显式流污点传播方式包括直接赋值传播、通过函数(过程)调用传播以及通过别名(指针)传播.
</span></span></code></pre></div><h3 id=动态分析技术>动态分析技术
<a class=header-anchor href=#%e5%8a%a8%e6%80%81%e5%88%86%e6%9e%90%e6%8a%80%e6%9c%af></a></h3><p>动态污点传播分析(简称动态污点分析)是<strong>指在程序运行过程中,通过实时监控程序的污点数据在系统程序中的传播来检测数据能否从污点源传播到污点汇聚点</strong>.动态污点传播分析首先需要为污点数据扩展一个污点标记(tainted tag)的标签并将其存储在存储单元(内存、寄存器、缓存等)中,然后根据指令类型和指令操作数设计相应的传播逻辑传播污点标记.</p><p>动态污点传播分析按照实现层次被分为基于硬件、基于软件以及混合型的污点传播分析这3类.</p><p>1.硬件</p><p>基于硬件的污点传播分析需要定制的硬件支持,一般需要<strong>在原有体系结构上为寄存器或者内存扩展一个标记位,用来存储污点标记</strong>,代表的系统有 Minos[62],Raksha[63]等.</p><p>2.基于软件</p><p><strong>基于软件的污点传播分析通过修改程序的二进制代码来进行污点标记位的存储与传播</strong>,代表的系统有 TaintEraser[64],TaintDroid[19]等.</p><p>基于软件的污点传播的<strong>优点在于不必更改处理器等底层的硬件,并且可以支持更高的语义逻辑的安全策略(利用其更贴近源程序层次的特点),但缺点是使用插桩(instrumentation 在保证被测程序原有逻辑完整性的基础上在程序中插入一些探针)或代码重写(code rewriting)修改程序往往会给分析系统带来巨大的开销</strong>.相反地,基于硬件的污点传播分析虽然可以利用定制硬件降低开销,但通常不能支持更高的语义逻辑的安全策略,并且需要对处理器结构进行重新设计.</p><p>3.混合型</p><p>混合型的污点分析是对上述两类方法的折中,即,通过尽可能少的硬件结构改动以保证更高的语义逻辑的安全策略,代表的系统有 Flexitaint[65],PIFT[19]等.</p><p>目前,针对动态污点传播分析的研究工作关注的首要问题是如何设计有效的污点传播逻辑,以确保精确的污点传播分析.</p><h2 id=污点传播中的隐式流分析>污点传播中的隐式流分析
<a class=header-anchor href=#%e6%b1%a1%e7%82%b9%e4%bc%a0%e6%92%ad%e4%b8%ad%e7%9a%84%e9%9a%90%e5%bc%8f%e6%b5%81%e5%88%86%e6%9e%90></a></h2><p><strong>(1)静态分析技术</strong></p><p><strong>静态隐式流分析面临的核心问题是精度与效率不可兼得的问题</strong>.精确的隐式流污点传播分析需要分析每一个分支控制条件是否需要传播污点标记.<strong>路径敏感的数据流分析往往会产生路径爆炸问题</strong>,导致开销难以接受.为了降低开销,一种简单的静态传播(标记)分支语句的污点标记方法是将控制依赖于它的语句全部进行污点标记,但该方法会导致一些并不携带隐私数据的变量被标记,导致过污染情况的发生.过污染会引起污点的大量扩散,最终导致用户得到的报告中信息过多,难以使用.</p><p><strong>(2)动态分析技术</strong></p><p><strong>动态隐式流分析关注的首要问题是如何确定污点控制条件下需要标记的语句的范围</strong>.由于动态执行轨迹并不能反映出被执行的指令之间的控制依赖关系,**目前的研究多采用离线的静态分析辅助判断动态污点传播中的隐式流标记范围.**Clause等人[70]提出,利用离线静态分析得到的控制流图节点间的后支配(post-dominate)关系来解决动态污点传播中的隐式流标记问题.</p><h1 id=污点分析方法实现>污点分析方法实现
<a class=header-anchor href=#%e6%b1%a1%e7%82%b9%e5%88%86%e6%9e%90%e6%96%b9%e6%b3%95%e5%ae%9e%e7%8e%b0></a></h1><h2 id=静态污点分析技术>静态污点分析技术
<a class=header-anchor href=#%e9%9d%99%e6%80%81%e6%b1%a1%e7%82%b9%e5%88%86%e6%9e%90%e6%8a%80%e6%9c%af></a></h2><p><strong>静态污点分析系统首先对程序代码进行解析,获得程序代码的中间表示,然后在中间表示的基础上对程序代码进行控制流分析等辅助分析,以获得需要的控制流图、调用图等.在辅助分析的过程中,系统可以利用污点分析规则在中间表示上识别程序中的 Source 点和 Sink 点.最后检测系统根据污点分析规则,利用静态污点分析检查程序是否存在污点类型的漏洞.</strong></p><p><strong>(1)基于数据流的污点分析</strong></p><p>在基于数据流的污点分析中,常常需要一些辅助分析技术,例如别名分析、取值分析等,来提高分析精度.辅助分析和污点分析交替进行,通常沿着程序路径的方向分析污点信息的流向,检查 Source 点处程序接收的污点信息是否会影响到 Sink 点处的敏感操作.</p><p><strong>过程内的分析中</strong>,按照一定的顺序分析过程内的每一条语句或者指令,进而分析污点信息的流向.</p><ul><li>记录污点信息.在静态分析层面,程序变量的污染情况为主要关注对象.为记录污染信息,通常为变量添加一个污染标签.最简单的就是一个布尔型变量,表示变量是否被污染.更复杂的标签还可以记录变量的污染信息来自哪些 Source 点,甚至精确到 Source 点接收数据的哪一部分.当然也可以不使用污染标签,这时我们通过对变量进行跟踪的方式达到分析污点信息流向的目的.例如使用栈或者队列来记录被污染的变量.</li><li>程序语句的分析.在确定如何记录污染信息后,将对程序语句进行静态分析.通常我们主要关注赋值语句、控制转移语句以及过程调用语句三类.</li></ul><p><img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/75.png alt></p><ul><li>代码的遍历.一般情况下,常常使用流敏感的方式或者路径敏感的方式进行遍历,并分析过程中的代码.如果使用流敏感的方式,可以通过对不同路径上的分析结果进行汇集,以发现程序中的数据净化规则.如果使用路径敏感的分析方式,则需要关注路径条件,如果路径条件中涉及对污染变量取值的限制,可认为路径条件对污染数据进行了净化,还可以将分析路径条件对污染数据的限制进行记录,如果在一条程序路径上,这些限制足够保证数据不会被攻击者利用,就可以将相应的变量标记为未污染的.
过程间的分析与数据流过程间分析类似,使用自底向上的分析方法,分析调用图中的每一个过程,进而对程序进行整体的分析.</li></ul><p><strong>(2)基于依赖关系的污点分析</strong></p><p>在基于依赖关系的污点分析中,首先利用程序的中间表示、控制流图和过程调用图构造程序完整的或者局部的程序的依赖关系.在分析程序依赖关系后,根据污点分析规则,检测 Sink 点处敏感操作是否依赖于 Source 点.</p><p>分析程序依赖关系的过程可以看做是构建程序依赖图的过程.程序依赖图是一个有向图.它的节点是程序语句,它的有向边表示程序语句之间的依赖关系.程序依赖图的有向边常常包括数据依赖边和控制依赖边.在构建有一定规模的程序的依赖图时,需要按需地构建程序依赖关系,并且优先考虑和污点信息相关的程序代码.</p><p><img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/73.png alt> <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/74.png alt></p><h2 id=动态污点分析>动态污点分析
<a class=header-anchor href=#%e5%8a%a8%e6%80%81%e6%b1%a1%e7%82%b9%e5%88%86%e6%9e%90></a></h2><p>动态污点分析是在程序运行的基础上,对数据流或控制流进行监控,从而实现对数据在内存中的显式传播、数据误用等进行跟踪和检测.动态污点分析与静态污点分析的唯一区别在于静态污点分析技术在检测时并不真正运行程序,而是通过模拟程序的执行过程来传播污点标记,而动态污点分析技术需要运行程序,同时实时传播并检测污点标记.</p><ul><li>动态污点分析技术可分为三个部分： <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/76.png alt></li><li>动态污点分析的优缺点： <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/77.png alt></li></ul><p><strong>动态污点分析的方法实现</strong></p><ul><li><strong>(1)污点数据标记</strong> <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/78.png alt></li><li><strong>(2)污点动态跟踪</strong> <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/79.png alt></li><li><strong>(3)污点误用检查</strong> <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos5/80.png alt></li></ul><p><strong>动态污点分析的实例分析</strong></p><p>下面我们来看一个使用动态污点分析的方法检测缓冲区溢出漏洞的例子.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>fun</span>(<span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>str)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#0b0;font-weight:700>char</span> temp[<span style=color:#666>15</span>];
</span></span><span style=display:flex><span>    <span style=color:#00a000>printf</span>(<span style=color:#b44>&#34;in strncpy, source: %s</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>, str);
</span></span><span style=display:flex><span>    <span style=color:#00a000>strncpy</span>(temp, str, <span style=color:#00a000>strlen</span>(str));        <span style=color:#080;font-style:italic>// Sink 点
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>}
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>int</span> <span style=color:#00a000>main</span>(<span style=color:#0b0;font-weight:700>int</span> argc, <span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>argv[])
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#0b0;font-weight:700>char</span> source[<span style=color:#666>30</span>];
</span></span><span style=display:flex><span>    <span style=color:#00a000>gets</span>(source);                           <span style=color:#080;font-style:italic>// Source 点
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>    <span style=color:#a2f;font-weight:700>if</span> (<span style=color:#00a000>strlen</span>(source) <span style=color:#666>&lt;</span> <span style=color:#666>30</span>)
</span></span><span style=display:flex><span>        <span style=color:#00a000>fun</span>(source);
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>else</span>
</span></span><span style=display:flex><span>        <span style=color:#00a000>printf</span>(<span style=color:#b44>&#34;too long string, %s</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>, source);
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>漏洞很明显, 调用 strncpy 函数存在缓冲区溢出.</p><p>程序接受外部输入字符串的二进制代码如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>0x08048609 &lt;+51&gt;:    lea    eax,[ebp-0x2a]
</span></span><span style=display:flex><span>0x0804860c &lt;+54&gt;:    push   eax
</span></span><span style=display:flex><span>0x0804860d &lt;+55&gt;:    call   0x8048400 &lt;gets@plt&gt;
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>0x0804862c &lt;+86&gt;:    lea    eax,[ebp-0x2a]
</span></span><span style=display:flex><span>0x0804862f &lt;+89&gt;:    push   eax
</span></span><span style=display:flex><span>0x08048630 &lt;+90&gt;:    call   0x8048566 &lt;fun&gt;
</span></span></code></pre></div><p>程序调用 strncpy 函数的二进制代码如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>0x080485a1 &lt;+59&gt;:    push   DWORD PTR [ebp-0x2c]
</span></span><span style=display:flex><span>0x080485a4 &lt;+62&gt;:    call   0x8048420 &lt;strlen@plt&gt;
</span></span><span style=display:flex><span>0x080485a9 &lt;+67&gt;:    add    esp,0x10
</span></span><span style=display:flex><span>0x080485ac &lt;+70&gt;:    sub    esp,0x4
</span></span><span style=display:flex><span>0x080485af &lt;+73&gt;:    push   eax
</span></span><span style=display:flex><span>0x080485b0 &lt;+74&gt;:    push   DWORD PTR [ebp-0x2c]
</span></span><span style=display:flex><span>0x080485b3 &lt;+77&gt;:    lea    eax,[ebp-0x1b]
</span></span><span style=display:flex><span>0x080485b6 &lt;+80&gt;:    push   eax
</span></span><span style=display:flex><span>0x080485b7 &lt;+81&gt;:    call   0x8048440 &lt;strncpy@plt&gt;
</span></span></code></pre></div><p>首先,在扫描该程序的二进制代码时,能够扫描到 call
<a href=mailto:gets@plt title=gets@plt>gets@plt
</a>,该函数会读入外部输入,即程序的攻击面.确定了攻击面后,我们将分析污染源数据并进行标记,即将 [ebp-0x2a] 数组(即源程序中的source)标记为污点数据.程序继续执行,该污染标记会随着该值的传播而一直传递.在进入 fun() 函数时,该污染标记通过形参实参的映射传递到参数 str 上.然后运行到 Sink 点函数 strncpy().该函数的第二个参数即 str 和 第三个参数 strlen(str) 都是污点数据.最后在执行 strncpy() 函数时,若设定了相应的漏洞规则(目标数组小于源数组),则漏洞规则将被触发,检测出缓冲区溢出漏洞.</p><h1 id=总结>总结
<a class=header-anchor href=#%e6%80%bb%e7%bb%93></a></h1><p>污点分析作为信息流分析的一种实践技术,被广泛应用于互联网及移动终端平台上应用程序的信息安全保障中.本文介绍了污点分析的基本原理和通用技术,并针对近年来污点分析在解决实际应用程序安全问题时遇到的问题和关键解决技术进行了分析综述.不同于基于安全类型系统的信息流分析技术,污点分析可以不改变程序现有的编程模型或语言特性,并提供精确信息流传播跟踪.
在实际应用过程中,污点分析还需要借助传统的程序分析技术的支持,例如静态分析中的数据流分析、动态分析中的代码重写等技术.另外,结合测试用例生成技术、符号执行技术以及虚拟机技术,也会给污点分析带来更多行之有效的解决方案.</p></div><footer class=post-footer><div class=post-tags><a href=/tags/%e6%b1%a1%e7%82%b9%e5%88%86%e6%9e%90>污点分析</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="f1ow - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="f1ow - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
污点分析初探</li><li class=post-copyright-author><strong>本文作者： </strong>f1ow</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://zp9080.github.io/post/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2/ title=污点分析初探>https://zp9080.github.io/post/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90/%E6%B1%A1%E7%82%B9%E5%88%86%E6%9E%90%E5%88%9D%E6%8E%A2/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/fuzz/fuzzing101%E7%AC%94%E8%AE%B0/ rel=next title=Fuzzing101笔记><i class="fa fa-chevron-left"></i> Fuzzing101笔记</a></div><div class="post-nav-prev post-nav-item"><a href=/post/fuzz/fuzz%E5%8F%82%E8%80%83%E5%8D%9A%E5%AE%A2/ rel=prev title=fuzz参考博客>fuzz参考博客
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2024 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>f1ow</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.126.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.6.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>鄂ICP备 20240001号</a>
<img src=/imgs/gongan.png alt=鄂公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42010002002000" target=_blank>鄂公网安备 42010002002000 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://github.com title=Github><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/github.svg alt=Github>
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://zp9080.github.io/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://zp9080.github.io/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://zp9080.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://zp9080.github.io/3rd"}},"version":"4.6.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src=/js/main.min.befa9b7d22ec90da86c74c5dbff5ee42c12e9fc6d6f4448bfcc596cc329b19e8.js defer></script></body></html>