<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.126.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="llvm中ll文件解读"><meta itemprop=description content="集中一点,登峰造极"><meta name=description content="集中一点,登峰造极"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://zp9080.github.io/imgs/author.png"><meta itemprop=keywords content="llvm pwn"><meta property="og:type" content="article"><meta property="og:title" content="llvm中ll文件解读"><meta property="og:description" content="集中一点,登峰造极"><meta property="og:image" content="/imgs/author.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://zp9080.github.io/post/llvm-pwn/llvm%E4%B8%ADll%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/"><meta property="og:site_name" content="f1ow-blog"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="f1ow"><meta property="article:published_time" content="2024-09-19 13:49:55 +0800 CST"><meta property="article:modified_time" content="2024-09-19 13:49:55 +0800 CST"><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/font-awesome/6.6.0/css/all.min.css><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/animate.css/4.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href=/css/main.min.bfbac3431de920c11b5b1cafa45029ea1bc93d5d3da50fed4ab6924b4c250360.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"llvm%E4%B8%ADll%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB","permalink":"https://zp9080.github.io/post/llvm-pwn/llvm%E4%B8%ADll%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/","title":"llvm中ll文件解读","waline":{"js":[{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"2.15.8"},{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>llvm中ll文件解读 - f1ow-blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><div class=overlay></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>f1ow-blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>集中一点,登峰造极</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>207</span></a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-categories hvr-icon"></i>分类</a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#ll文件中常见变量的理解>ll文件中常见变量的理解</a></li><li><a href=#例题wmctf-2024-babysigin>例题WMCTF-2024 babysigin</a><ul><li><a href=#很重要的一些理解><strong>很重要的一些理解</strong></a></li><li><a href=#有关loadinst>有关LoadInst</a></li><li><a href=#有关storeinst>有关StoreInst</a></li><li><a href=#这里先看简单的-wmctf_open-和-wmctf_read>这里先看简单的 WMCTF_OPEN 和 WMCTF_READ</a></li><li><a href=#再看wmctf_write>再看WMCTF_WRITE</a></li><li><a href=#最后看wmctf_open>最后看WMCTF_OPEN</a></li><li><a href=#exp>exp</a></li><li><a href=#后记与反思>后记与反思</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=f1ow src=/imgs/img-lazy-loading.gif data-src=/imgs/author.png><p class=site-author-name itemprop=name>f1ow</p><div class=site-description itemprop=description>集中一点,登峰造极</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>207</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>38</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>80</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/zp9080 title="Github → https://github.com/zp9080" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://v3rdant.cn/ title=https://v3rdant.cn/ target=_blank>v3rdant</a></li><li class=links-of-blogroll-item><a href=https://juicymio.github.io/ title=https://juicymio.github.io/ target=_blank>juicymio</a></li><li class=links-of-blogroll-item><a href=https://ka7arotto.github.io/ title=https://ka7arotto.github.io/ target=_blank>Goku</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2024-07-28T00:00:00+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=273686></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=660></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2025-02-27T17:57:37+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/zp9080 rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://zp9080.github.io/post/llvm-pwn/llvm%E4%B8%ADll%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/author.png"><meta itemprop=name content="f1ow"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="f1ow"><meta itemprop=description content="集中一点,登峰造极"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="llvm中ll文件解读"><meta itemprop=description content="[TOC] ll文件解析 ll文件中常见变量的理解 @ - 全局变量 % - 局部变量 alloca - 在当前执行的函数的堆栈帧中分配内存，当该函数返回到其调用者时，将自动释放内"></span><header class=post-header><h1 class=post-title itemprop="name headline">llvm中ll文件解读
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/post/LLVM-Pwn/llvm%e4%b8%adll%e6%96%87%e4%bb%b6%e8%a7%a3%e8%af%bb.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2024-09-19 13:49:55 +0800 CST" itemprop="dateCreated datePublished" datetime="2024-09-19 13:49:55 +0800 CST">2024-09-19
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/llvm-pwn itemprop=url rel=index><span itemprop=name>PWN/LLVM Pwn</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>4196</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>9分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/llvm-pwn/llvm%E4%B8%ADll%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p>[TOC]
<a href=https://www.yijinglab.com/specialized/20240819172143 title=ll文件解析 rel="noopener external nofollow noreferrer" target=_blank class=exturl>ll文件解析
<i class="fa fa-external-link-alt"></i></a></p><h1 id=ll文件中常见变量的理解>ll文件中常见变量的理解
<a class=header-anchor href=#ll%e6%96%87%e4%bb%b6%e4%b8%ad%e5%b8%b8%e8%a7%81%e5%8f%98%e9%87%8f%e7%9a%84%e7%90%86%e8%a7%a3></a></h1><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>@ - 全局变量
</span></span><span style=display:flex><span>% - 局部变量
</span></span><span style=display:flex><span>alloca - 在当前执行的函数的堆栈帧中分配内存，当该函数返回到其调用者时，将自动释放内存
</span></span><span style=display:flex><span>i32 - 32位4字节的整数
</span></span><span style=display:flex><span>align - 对齐
</span></span><span style=display:flex><span>load - 读出，store写入
</span></span><span style=display:flex><span>icmp - 两个整数值比较，返回布尔值
</span></span><span style=display:flex><span>br - 选择分支，根据条件来转向label，不根据条件跳转的话类型goto
</span></span><span style=display:flex><span>label - 代码标签
</span></span><span style=display:flex><span>call - 调用函数
</span></span></code></pre></div><h1 id=例题wmctf-2024-babysigin>例题WMCTF-2024 babysigin
<a class=header-anchor href=#%e4%be%8b%e9%a2%98wmctf-2024-babysigin></a></h1><h2 id=很重要的一些理解><strong>很重要的一些理解</strong>
<a class=header-anchor href=#%e5%be%88%e9%87%8d%e8%a6%81%e7%9a%84%e4%b8%80%e4%ba%9b%e7%90%86%e8%a7%a3></a></h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>CallInst：函数类型的变量
</span></span><span style=display:flex><span>LoadInst：ll中应对应load指令
</span></span><span style=display:flex><span>StoreInst：ll中应对应store指令
</span></span><span style=display:flex><span>llvm::dyn_cast&lt;llvm::GlobalVariable/LoadInst/StoreInst,llvm::Value&gt;：这种就是判断其是否是GlobalVariable/LoadInst/StoreInst类型
</span></span></code></pre></div><h2 id=有关loadinst>有关LoadInst
<a class=header-anchor href=#%e6%9c%89%e5%85%b3loadinst></a></h2><p>发现想要满足LoadInst类型，那么传入的不应该是个直接的值，而是先int cmd=1234,func(cmd)用这种方式传参即可
再详细解释一下LoadInst，比如我的exp.c中是这样的</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#00a000>WMCTF_WRITE</span>(<span style=color:#666>0x8888</span>);
</span></span></code></pre></div><p>那么ll文件就会是这样,显然不满足load</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-ll data-lang=ll><span style=display:flex><span><span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_WRITE(<span style=color:#a2f;font-weight:700>i32</span> <span>no</span><span style=color:#a2f;font-weight:700>undef</span> <span style=color:#666>34952</span>)
</span></span></code></pre></div><p>但如果先定义一个变量再传参</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#0b0;font-weight:700>int</span> cmd <span style=color:#666>=</span> <span style=color:#666>0x8888</span>;
</span></span><span style=display:flex><span><span style=color:#00a000>WMCTF_WRITE</span>(cmd);
</span></span></code></pre></div><p>那么ll文件就长这样</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-ll data-lang=ll><span style=display:flex><span>@cmd = <span>dso_local</span> <span style=color:#a2f;font-weight:700>global</span> <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>34952</span>, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>4</span>
</span></span><span style=display:flex><span>%1 = <span style=color:#a2f;font-weight:700>load</span> <span style=color:#a2f;font-weight:700>i32</span>, <span style=color:#a2f;font-weight:700>i32</span>* @cmd, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>4</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_WRITE(<span style=color:#a2f;font-weight:700>i32</span> <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %1)
</span></span></code></pre></div><p><strong>显然这样就满足load类型了！！！</strong></p><h2 id=有关storeinst>有关StoreInst
<a class=header-anchor href=#%e6%9c%89%e5%85%b3storeinst></a></h2><ul><li>这部分和LoadInst类似，可以在WMCTF_OPEN分析中的最后一关这部分看到如何解决</li></ul><h2 id=这里先看简单的-wmctf_open-和-wmctf_read>这里先看简单的 WMCTF_OPEN 和 WMCTF_READ
<a class=header-anchor href=#%e8%bf%99%e9%87%8c%e5%85%88%e7%9c%8b%e7%ae%80%e5%8d%95%e7%9a%84-wmctf_open-%e5%92%8c-wmctf_read></a></h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span>v77 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>ilist_iterator<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ilist_detail<span style=color:#666>::</span>node_options<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Instruction,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span>,<span style=color:#0b0;font-weight:700>void</span><span style=color:#666>&gt;</span>,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span><span style=color:#666>&gt;::</span>operator<span style=color:#666>*</span>(<span style=color:#666>&amp;</span>v79);
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>//v76变成CallInst类型
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>v76 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>CallBase <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>CallInst,llvm<span style=color:#666>::</span>Instruction<span style=color:#666>&gt;</span>(v77);
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>//********************************************WMCTF_READ***************************************************
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>v19 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getCalledFunction</span>(v76);
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>//得到函数名称
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>v55 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span><span style=color:#00a000>getName</span>(v19);
</span></span><span style=display:flex><span>v56 <span style=color:#666>=</span> v20;
</span></span><span style=display:flex><span>llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span><span style=color:#00a000>StringRef</span>((llvm<span style=color:#666>::</span>StringRef <span style=color:#666>*</span>)v54, <span style=color:#b44>&#34;WMCTF_READ&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>if</span> ( (llvm<span style=color:#666>::</span>operator<span style=color:#666>==</span>(v55, v56, v54[<span style=color:#666>0</span>], v54[<span style=color:#666>1</span>]) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//得到函数的第0个参数
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  v21 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v76, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//将这个参数转换为ConstantInt类型
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  v53 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>ConstantInt <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ConstantInt,llvm<span style=color:#666>::</span>Value<span style=color:#666>&gt;</span>(v21);
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>if</span> ( v53 <span style=color:#666>&amp;&amp;</span> llvm<span style=color:#666>::</span>ConstantInt<span style=color:#666>::</span><span style=color:#00a000>getSExtValue</span>(v53) <span style=color:#666>==</span> <span style=color:#666>0x6666</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v22 <span style=color:#666>=</span> (llvm <span style=color:#666>*</span>)fd;
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>if</span> ( <span style=color:#00a000>read</span>(fd, (<span style=color:#0b0;font-weight:700>void</span> <span style=color:#666>*</span>)mmap_addr, <span style=color:#666>0x40uLL</span>) <span style=color:#666>&lt;</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      v23 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>(v22);
</span></span><span style=display:flex><span>      llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v23, <span style=color:#b44>&#34;WMCTF_READ error</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>      v86 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>      <span style=color:#a2f;font-weight:700>return</span> v86 <span style=color:#666>&amp;</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    v24 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>(v22);
</span></span><span style=display:flex><span>    llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v24, <span style=color:#b44>&#34;WMCTF_READ success</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>//***********************************************WMCTF_MMAP****************************************
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic>//与WMCTF_READ类似不再做分析
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>v25 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getCalledFunction</span>(v76);
</span></span><span style=display:flex><span>v51 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span><span style=color:#00a000>getName</span>(v25);
</span></span><span style=display:flex><span>v52 <span style=color:#666>=</span> v26;
</span></span><span style=display:flex><span>llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span><span style=color:#00a000>StringRef</span>((llvm<span style=color:#666>::</span>StringRef <span style=color:#666>*</span>)v50, <span style=color:#b44>&#34;WMCTF_MMAP&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>if</span> ( (llvm<span style=color:#666>::</span>operator<span style=color:#666>==</span>(v51, v52, v50[<span style=color:#666>0</span>], v50[<span style=color:#666>1</span>]) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>v27 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v76, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>v49 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>ConstantInt <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ConstantInt,llvm<span style=color:#666>::</span>Value<span style=color:#666>&gt;</span>(v27);
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>if</span> ( v49 <span style=color:#666>&amp;&amp;</span> llvm<span style=color:#666>::</span>ConstantInt<span style=color:#666>::</span><span style=color:#00a000>getSExtValue</span>(v49) <span style=color:#666>==</span> <span style=color:#666>0x7890</span> )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  mmap_addr <span style=color:#666>=</span> <span style=color:#00a000>mmap</span>(<span style=color:#666>0LL</span>, <span style=color:#666>0x1000uLL</span>, <span style=color:#666>3</span>, <span style=color:#666>33</span>, <span style=color:#666>0</span>, <span style=color:#666>0LL</span>);
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>if</span> ( mmap_addr <span style=color:#666>==</span> (<span style=color:#a2f;font-weight:700>const</span> <span style=color:#0b0;font-weight:700>void</span> <span style=color:#666>*</span>)<span style=color:#666>-</span><span style=color:#666>1LL</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v28 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>(<span style=color:#666>0LL</span>);
</span></span><span style=display:flex><span>    llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v28, <span style=color:#b44>&#34;WMCTF_MMAP failed</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>else</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v29 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>(<span style=color:#666>0LL</span>);
</span></span><span style=display:flex><span>    llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v29, <span style=color:#b44>&#34;WMCTF_MMAP success</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><strong>分析完后发现WMCTF_OPEN 和 WMCTF_READ只要正常传参就行</strong></li></ul><h2 id=再看wmctf_write>再看WMCTF_WRITE
<a class=header-anchor href=#%e5%86%8d%e7%9c%8bwmctf_write></a></h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span>v30 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getCalledFunction</span>(v76);
</span></span><span style=display:flex><span>v47 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span><span style=color:#00a000>getName</span>(v30);
</span></span><span style=display:flex><span>v48 <span style=color:#666>=</span> v31;
</span></span><span style=display:flex><span>llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span><span style=color:#00a000>StringRef</span>((llvm<span style=color:#666>::</span>StringRef <span style=color:#666>*</span>)v46, <span style=color:#b44>&#34;WMCTF_WRITE&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>if</span> ( (llvm<span style=color:#666>::</span>operator<span style=color:#666>==</span>(v47, v48, v46[<span style=color:#666>0</span>], v46[<span style=color:#666>1</span>]) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//获取函数的第0个参数
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  v32 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v76, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//判断这个参数是否是LoadInst类型
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  v45 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>UnaryInstruction <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>LoadInst,llvm<span style=color:#666>::</span>Value<span style=color:#666>&gt;</span>(v32);
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>if</span> ( <span style=color:#666>!</span>v45 )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v86 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> v86 <span style=color:#666>&amp;</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//从LoadInst中获取第一个参数，判断其是否是全局变量
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  v33 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>UnaryInstruction<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v45, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>  v44 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>GlobalVariable <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>GlobalVariable,llvm<span style=color:#666>::</span>Value<span style=color:#666>&gt;</span>(v33);
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>if</span> ( <span style=color:#666>!</span>v44 )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v86 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> v86 <span style=color:#666>&amp;</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//是全局变量再从GlobalVariable获的第一个参数
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  v34 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>GlobalVariable<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v44, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//将获得的参数值转换为ConstantInt类型
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  v43 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>ConstantInt <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ConstantInt,llvm<span style=color:#666>::</span>Value<span style=color:#666>&gt;</span>(v34);
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>if</span> ( v43 )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>if</span> ( (<span style=color:#0b0;font-weight:700>unsigned</span> <span style=color:#0b0;font-weight:700>int</span>)llvm<span style=color:#666>::</span>ConstantInt<span style=color:#666>::</span><span style=color:#00a000>getSExtValue</span>(v43) <span style=color:#666>!=</span> <span style=color:#666>0x8888</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      v86 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>      <span style=color:#a2f;font-weight:700>return</span> v86 <span style=color:#666>&amp;</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>if</span> ( <span style=color:#00a000>write</span>((<span style=color:#0b0;font-weight:700>int</span>)<span style=color:#666>&amp;</span>dword_0 <span style=color:#666>+</span> <span style=color:#666>1</span>, mmap_addr, <span style=color:#666>0x40uLL</span>) <span style=color:#666>&lt;</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      v35 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>((llvm <span style=color:#666>*</span>)((<span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>)<span style=color:#666>&amp;</span>dword_0 <span style=color:#666>+</span> <span style=color:#666>1</span>));
</span></span><span style=display:flex><span>      llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v35, <span style=color:#b44>&#34;WMCTF_WRITE error</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>      v86 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>      <span style=color:#a2f;font-weight:700>return</span> v86 <span style=color:#666>&amp;</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><strong>分析完后发现WMCTF_WRITE传入的参数在ll中应当是load指令的结果，同时这个参数得是个全局变量</strong></li><li>ll文件中应当长这样</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-ll data-lang=ll><span style=display:flex><span>@cmd = <span>dso_local</span> <span style=color:#a2f;font-weight:700>global</span> <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>34952</span>, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>%1 = <span style=color:#a2f;font-weight:700>load</span> <span style=color:#a2f;font-weight:700>i32</span>, <span style=color:#a2f;font-weight:700>i32</span>* @cmd, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>4</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_WRITE(<span style=color:#a2f;font-weight:700>i32</span> <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %1)
</span></span></code></pre></div><h2 id=最后看wmctf_open>最后看WMCTF_OPEN
<a class=header-anchor href=#%e6%9c%80%e5%90%8e%e7%9c%8bwmctf_open></a></h2><ul><li>先过第一关</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span>CalledFunction <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getCalledFunction</span>(v76);
</span></span><span style=display:flex><span>Name <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span><span style=color:#00a000>getName</span>(CalledFunction);
</span></span><span style=display:flex><span>v75 <span style=color:#666>=</span> v3;
</span></span><span style=display:flex><span>llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span><span style=color:#00a000>StringRef</span>((llvm<span style=color:#666>::</span>StringRef <span style=color:#666>*</span>)v73, <span style=color:#b44>&#34;WMCTF_OPEN&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>if</span> ( (llvm<span style=color:#666>::</span>operator<span style=color:#666>==</span>(Name, v75, v73[<span style=color:#666>0</span>], v73[<span style=color:#666>1</span>]) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//获取函数的0个参数，判断是否是LoadInst类型
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  Operand <span style=color:#666>=</span> llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v76, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>if</span> ( (llvm<span style=color:#666>::</span>isa<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>LoadInst,llvm<span style=color:#666>::</span>Value <span style=color:#666>*&gt;</span>(<span style=color:#666>&amp;</span>Operand) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>==</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v4 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>((llvm <span style=color:#666>*</span>)<span style=color:#666>&amp;</span>Operand);
</span></span><span style=display:flex><span>    llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v4, <span style=color:#b44>&#34;parameter error: first operand is not a LoadInst</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>    v86 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> v86 <span style=color:#666>&amp;</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//也是获取函数的第0个参数，但是和上面类似有点不同，笔者这里不懂，但是只要保证WMCTF_OPEN的参数是load类型就行
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  v5 <span style=color:#666>=</span> (llvm <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v76, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>  v71 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>UnaryInstruction <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>LoadInst,llvm<span style=color:#666>::</span>Value<span style=color:#666>&gt;</span>(v5);
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>if</span> ( <span style=color:#666>!</span>v71 )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v6 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>(v5);
</span></span><span style=display:flex><span>    llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v6, <span style=color:#b44>&#34;parameter error: filename is not a LoadInst</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>    v86 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> v86 <span style=color:#666>&amp;</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//获取LoadInst的第0个参数
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  v70 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>UnaryInstruction<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v71, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//获取参数的名字
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#080;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic>  这里打个比方
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic>  %3 = load i8*, i8** @filename, align 8
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic>  v70 = (llvm::Value *)llvm::UnaryInstruction::getOperand(v71, 0);就相当于获取和@filename有关的东西
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic>  那么llvm::Value::getName(v70);就是或者上述内容的名字，也就是filename
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic>  在exp.c中这就是char *filename = &#34;./flag&#34;;但是我们知道变量的命名不能带. 所以这里我们只能自己手动改ll文件
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic>  */</span>
</span></span><span style=display:flex><span>  v69[<span style=color:#666>0</span>] <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span><span style=color:#00a000>getName</span>(v70);
</span></span><span style=display:flex><span>  v69[<span style=color:#666>1</span>] <span style=color:#666>=</span> v7;
</span></span><span style=display:flex><span>  llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span><span style=color:#00a000>StringRef</span>((llvm<span style=color:#666>::</span>StringRef <span style=color:#666>*</span>)v68, <span style=color:#b44>&#34;.addr&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>if</span> ( (llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span><span style=color:#00a000>contains</span>(v69, v68[<span style=color:#666>0</span>], v68[<span style=color:#666>1</span>]) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>==</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v8 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>((llvm <span style=color:#666>*</span>)v69);
</span></span><span style=display:flex><span>    llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v8, <span style=color:#b44>&#34;parameter error: filepath does not contain .addr</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>    v86 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> v86 <span style=color:#666>&amp;</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>再过第二关,可以看到这个open实际上就是根据v66这个字符串的值来open，因此这个WMCTF::getFunctionCallValue[abi:cxx11]将是我们分析的重点</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span>anonymous namespace<span style=color:#666>::</span>WMCTF<span style=color:#666>::</span>getFunctionCallValue[<span style=color:#a0a000>abi</span>:cxx11]((llvm <span style=color:#666>*</span>)v66, (<span style=color:#a2f;font-weight:700>__int64</span>)this, Parent, v84, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>if</span> ( (std<span style=color:#666>::</span>string<span style=color:#666>::</span><span style=color:#00a000>empty</span>(v66) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  v9 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>((llvm <span style=color:#666>*</span>)v66);
</span></span><span style=display:flex><span>  llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v9, <span style=color:#b44>&#34;function error: could not retrieve function call value</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>  v86 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>  v65 <span style=color:#666>=</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>else</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  Context <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Module<span style=color:#666>::</span><span style=color:#00a000>getContext</span>(Parent);
</span></span><span style=display:flex><span>  llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span><span style=color:#00a000>StringRef</span>(v63, v66);
</span></span><span style=display:flex><span>  v10 <span style=color:#666>=</span> v63[<span style=color:#666>0</span>];
</span></span><span style=display:flex><span>  String <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>ConstantDataArray<span style=color:#666>::</span><span style=color:#00a000>getString</span>(Context, v63[<span style=color:#666>0</span>], v63[<span style=color:#666>1</span>], <span style=color:#666>0LL</span>);
</span></span><span style=display:flex><span>  v41 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>GlobalVariable<span style=color:#666>::</span>operator <span style=color:#00a000>new</span>((llvm<span style=color:#666>::</span>GlobalVariable <span style=color:#666>*</span>)<span style=color:#666>&amp;</span>qword_58, v10);
</span></span><span style=display:flex><span>  v38 <span style=color:#666>=</span> Parent;
</span></span><span style=display:flex><span>  Type <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span><span style=color:#00a000>getType</span>(String);
</span></span><span style=display:flex><span>  v40 <span style=color:#666>=</span> String;
</span></span><span style=display:flex><span>  v11 <span style=color:#666>=</span> <span style=color:#00a000>rand</span>();
</span></span><span style=display:flex><span>  std<span style=color:#666>::</span><span style=color:#00a000>to_string</span>((std<span style=color:#666>::</span>__cxx11 <span style=color:#666>*</span>)v59, v11);
</span></span><span style=display:flex><span>  std<span style=color:#666>::</span>operator<span style=color:#666>+&lt;</span><span style=color:#0b0;font-weight:700>char</span><span style=color:#666>&gt;</span>(v60, <span style=color:#b44>&#34;string_constant&#34;</span>, v59);
</span></span><span style=display:flex><span>  llvm<span style=color:#666>::</span>Twine<span style=color:#666>::</span><span style=color:#00a000>Twine</span>(v61, v60);
</span></span><span style=display:flex><span>  llvm<span style=color:#666>::</span>Optional<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>unsigned</span> <span style=color:#0b0;font-weight:700>int</span><span style=color:#666>&gt;::</span><span style=color:#00a000>Optional</span>(<span style=color:#666>&amp;</span>v58, <span style=color:#666>1LL</span>);
</span></span><span style=display:flex><span>  llvm<span style=color:#666>::</span>GlobalVariable<span style=color:#666>::</span><span style=color:#00a000>GlobalVariable</span>(v41, v38, Type, <span style=color:#666>1LL</span>, <span style=color:#666>8LL</span>, v40, v61, <span style=color:#666>0LL</span>, <span style=color:#666>0</span>, v58, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>  std<span style=color:#666>::</span>string<span style=color:#666>::~</span><span style=color:#00a000>string</span>(v60);
</span></span><span style=display:flex><span>  std<span style=color:#666>::</span>string<span style=color:#666>::~</span><span style=color:#00a000>string</span>(v59);
</span></span><span style=display:flex><span>  v62 <span style=color:#666>=</span> v41;
</span></span><span style=display:flex><span>  v12 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Module<span style=color:#666>::</span><span style=color:#00a000>getContext</span>(Parent);
</span></span><span style=display:flex><span>  Int8PtrTy <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Type<span style=color:#666>::</span><span style=color:#00a000>getInt8PtrTy</span>(v12, <span style=color:#666>0LL</span>);
</span></span><span style=display:flex><span>  BitCast <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>ConstantExpr<span style=color:#666>::</span><span style=color:#00a000>getBitCast</span>(v41, Int8PtrTy, <span style=color:#666>0LL</span>);
</span></span><span style=display:flex><span>  llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>setArgOperand</span>(v76, <span style=color:#666>0</span>, BitCast);
</span></span><span style=display:flex><span>  v14 <span style=color:#666>=</span> (<span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>)std<span style=color:#666>::</span>string<span style=color:#666>::</span><span style=color:#00a000>c_str</span>(v66);
</span></span><span style=display:flex><span>  fd <span style=color:#666>=</span> <span style=color:#00a000>open</span>(v14, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>if</span> ( (fd <span style=color:#666>&amp;</span> <span style=color:#666>0x80000000</span>) <span style=color:#666>==</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v18 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>((llvm <span style=color:#666>*</span>)v14);
</span></span><span style=display:flex><span>    llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v18, <span style=color:#b44>&#34;WMCTF_OPEN success</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>    v65 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>else</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v15 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>((llvm <span style=color:#666>*</span>)v14);
</span></span><span style=display:flex><span>    v16 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v15, <span style=color:#b44>&#34;open error: could not open file &#34;</span>);
</span></span><span style=display:flex><span>    v17 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v16, v66);
</span></span><span style=display:flex><span>    llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v17, <span style=color:#b44>&#34;</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>    v86 <span style=color:#666>=</span> <span style=color:#666>0</span>;
</span></span><span style=display:flex><span>    v65 <span style=color:#666>=</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>std<span style=color:#666>::</span>string<span style=color:#666>::~</span><span style=color:#00a000>string</span>(v66);
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>if</span> ( v65 )
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>return</span> v86 <span style=color:#666>&amp;</span> <span style=color:#666>1</span>;
</span></span><span style=display:flex><span>        
</span></span></code></pre></div><ul><li>最后一关</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span>llvm <span style=color:#666>*</span><span style=color:#a2f;font-weight:700>__fastcall</span> anonymous namespace<span style=color:#666>::</span>WMCTF<span style=color:#666>::</span>getFunctionCallValue[<span style=color:#a0a000>abi</span>:cxx11](
</span></span><span style=display:flex><span>        llvm <span style=color:#666>*</span>a1,
</span></span><span style=display:flex><span>        <span style=color:#a2f;font-weight:700>__int64</span> a2,
</span></span><span style=display:flex><span>        llvm<span style=color:#666>::</span>Module <span style=color:#666>*</span>a3,
</span></span><span style=display:flex><span>        llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>a4,
</span></span><span style=display:flex><span>        <span style=color:#0b0;font-weight:700>int</span> a5)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>__int64</span> v5; <span style=color:#080;font-style:italic>// rax
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>CalledFunction; <span style=color:#080;font-style:italic>// rax
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v7; <span style=color:#080;font-style:italic>// rdx
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v8; <span style=color:#080;font-style:italic>// rdx
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> Operand; <span style=color:#080;font-style:italic>// rax
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>v10; <span style=color:#080;font-style:italic>// rax
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v11; <span style=color:#080;font-style:italic>// rdx
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v12; <span style=color:#080;font-style:italic>// rax
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v13; <span style=color:#080;font-style:italic>// rax
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v14; <span style=color:#080;font-style:italic>// rdx
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> User; <span style=color:#080;font-style:italic>// rax
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v16; <span style=color:#080;font-style:italic>// rax
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v17; <span style=color:#080;font-style:italic>// rax
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> Initializer; <span style=color:#080;font-style:italic>// rax
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v19; <span style=color:#080;font-style:italic>// rdx
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#0b0;font-weight:700>char</span> v21[<span style=color:#666>8</span>]; <span style=color:#080;font-style:italic>// [rsp+20h] [rbp-150h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v22[<span style=color:#666>2</span>]; <span style=color:#080;font-style:italic>// [rsp+28h] [rbp-148h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>ConstantDataSequential <span style=color:#666>*</span>v23; <span style=color:#080;font-style:italic>// [rsp+38h] [rbp-138h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>GlobalVariable <span style=color:#666>*</span>v24; <span style=color:#080;font-style:italic>// [rsp+40h] [rbp-130h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>ConstantExpr <span style=color:#666>*</span>v25; <span style=color:#080;font-style:italic>// [rsp+48h] [rbp-128h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>StoreInst <span style=color:#666>*</span>v26; <span style=color:#080;font-style:italic>// [rsp+50h] [rbp-120h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>Use <span style=color:#666>*</span>v27; <span style=color:#080;font-style:italic>// [rsp+58h] [rbp-118h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v28; <span style=color:#080;font-style:italic>// [rsp+60h] [rbp-110h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v29; <span style=color:#080;font-style:italic>// [rsp+68h] [rbp-108h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v30[<span style=color:#666>2</span>]; <span style=color:#080;font-style:italic>// [rsp+70h] [rbp-100h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> <span style=color:#666>*</span>v31; <span style=color:#080;font-style:italic>// [rsp+80h] [rbp-F0h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>v32; <span style=color:#080;font-style:italic>// [rsp+88h] [rbp-E8h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#0b0;font-weight:700>char</span> v33[<span style=color:#666>8</span>]; <span style=color:#080;font-style:italic>// [rsp+90h] [rbp-E0h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v34[<span style=color:#666>2</span>]; <span style=color:#080;font-style:italic>// [rsp+98h] [rbp-D8h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v35[<span style=color:#666>2</span>]; <span style=color:#080;font-style:italic>// [rsp+A8h] [rbp-C8h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>UnaryInstruction <span style=color:#666>*</span>v36; <span style=color:#080;font-style:italic>// [rsp+B8h] [rbp-B8h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v37; <span style=color:#080;font-style:italic>// [rsp+C0h] [rbp-B0h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v38; <span style=color:#080;font-style:italic>// [rsp+C8h] [rbp-A8h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> Name; <span style=color:#080;font-style:italic>// [rsp+D0h] [rbp-A0h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v40; <span style=color:#080;font-style:italic>// [rsp+D8h] [rbp-98h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>CallBase <span style=color:#666>*</span>v41; <span style=color:#080;font-style:italic>// [rsp+E0h] [rbp-90h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v42; <span style=color:#080;font-style:italic>// [rsp+E8h] [rbp-88h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v43; <span style=color:#080;font-style:italic>// [rsp+F0h] [rbp-80h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v44; <span style=color:#080;font-style:italic>// [rsp+F8h] [rbp-78h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>BasicBlock <span style=color:#666>*</span>v45; <span style=color:#080;font-style:italic>// [rsp+100h] [rbp-70h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>BasicBlock <span style=color:#666>*</span>v46; <span style=color:#080;font-style:italic>// [rsp+108h] [rbp-68h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v47; <span style=color:#080;font-style:italic>// [rsp+110h] [rbp-60h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v48; <span style=color:#080;font-style:italic>// [rsp+118h] [rbp-58h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>Function <span style=color:#666>*</span>v49; <span style=color:#080;font-style:italic>// [rsp+120h] [rbp-50h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>v50; <span style=color:#080;font-style:italic>// [rsp+128h] [rbp-48h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v51; <span style=color:#080;font-style:italic>// [rsp+130h] [rbp-40h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v52[<span style=color:#666>2</span>]; <span style=color:#080;font-style:italic>// [rsp+138h] [rbp-38h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#0b0;font-weight:700>char</span> v53[<span style=color:#666>4</span>]; <span style=color:#080;font-style:italic>// [rsp+148h] [rbp-28h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#0b0;font-weight:700>unsigned</span> <span style=color:#0b0;font-weight:700>int</span> v54; <span style=color:#080;font-style:italic>// [rsp+14Ch] [rbp-24h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>v55; <span style=color:#080;font-style:italic>// [rsp+150h] [rbp-20h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm<span style=color:#666>::</span>Module <span style=color:#666>*</span>v56; <span style=color:#080;font-style:italic>// [rsp+158h] [rbp-18h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  <span style=color:#a2f;font-weight:700>__int64</span> v57; <span style=color:#080;font-style:italic>// [rsp+160h] [rbp-10h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  llvm <span style=color:#666>*</span>v58; <span style=color:#080;font-style:italic>// [rsp+168h] [rbp-8h]
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>
</span></span><span style=display:flex><span>  v58 <span style=color:#666>=</span> a1;
</span></span><span style=display:flex><span>  v57 <span style=color:#666>=</span> a2;
</span></span><span style=display:flex><span>  v56 <span style=color:#666>=</span> a3;
</span></span><span style=display:flex><span>  v55 <span style=color:#666>=</span> a4;
</span></span><span style=display:flex><span>  v54 <span style=color:#666>=</span> a5;
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>if</span> ( a5 <span style=color:#666>&lt;=</span> <span style=color:#666>5</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v52[<span style=color:#666>1</span>] <span style=color:#666>=</span> (<span style=color:#a2f;font-weight:700>__int64</span>)v56;
</span></span><span style=display:flex><span>    v52[<span style=color:#666>0</span>] <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Module<span style=color:#666>::</span><span style=color:#00a000>begin</span>(v56);
</span></span><span style=display:flex><span>    v51 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Module<span style=color:#666>::</span><span style=color:#00a000>end</span>(v56);
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>while</span> ( (llvm<span style=color:#666>::</span>operator<span style=color:#666>!=</span>(v52, <span style=color:#666>&amp;</span>v51) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      v50 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>ilist_iterator<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ilist_detail<span style=color:#666>::</span>node_options<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Function,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span>,<span style=color:#0b0;font-weight:700>void</span><span style=color:#666>&gt;</span>,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span><span style=color:#666>&gt;::</span>operator<span style=color:#666>*</span>(v52);
</span></span><span style=display:flex><span>      v49 <span style=color:#666>=</span> v50;
</span></span><span style=display:flex><span>      v48 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Function<span style=color:#666>::</span><span style=color:#00a000>begin</span>(v50);
</span></span><span style=display:flex><span>      v47 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Function<span style=color:#666>::</span><span style=color:#00a000>end</span>(v49);
</span></span><span style=display:flex><span>      <span style=color:#a2f;font-weight:700>while</span> ( (llvm<span style=color:#666>::</span>operator<span style=color:#666>!=</span>(<span style=color:#666>&amp;</span>v48, <span style=color:#666>&amp;</span>v47) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>      {
</span></span><span style=display:flex><span>        v46 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>BasicBlock <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>ilist_iterator<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ilist_detail<span style=color:#666>::</span>node_options<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>BasicBlock,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span>,<span style=color:#0b0;font-weight:700>void</span><span style=color:#666>&gt;</span>,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span><span style=color:#666>&gt;::</span>operator<span style=color:#666>*</span>(<span style=color:#666>&amp;</span>v48);
</span></span><span style=display:flex><span>        v45 <span style=color:#666>=</span> v46;
</span></span><span style=display:flex><span>        v44 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>BasicBlock<span style=color:#666>::</span><span style=color:#00a000>begin</span>(v46);
</span></span><span style=display:flex><span>        v43 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>BasicBlock<span style=color:#666>::</span><span style=color:#00a000>end</span>(v45);
</span></span><span style=display:flex><span>        <span style=color:#080;font-style:italic>//进入遍历list的过程
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>        <span style=color:#a2f;font-weight:700>while</span> ( (llvm<span style=color:#666>::</span>operator<span style=color:#666>!=</span>(<span style=color:#666>&amp;</span>v44, <span style=color:#666>&amp;</span>v43) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>        {                                    
</span></span><span style=display:flex><span>          v42 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>ilist_iterator<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ilist_detail<span style=color:#666>::</span>node_options<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Instruction,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span>,<span style=color:#0b0;font-weight:700>void</span><span style=color:#666>&gt;</span>,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span><span style=color:#666>&gt;::</span>operator<span style=color:#666>*</span>(<span style=color:#666>&amp;</span>v44);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          v41 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>CallBase <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>CallInst,llvm<span style=color:#666>::</span>Instruction<span style=color:#666>&gt;</span>(v42);
</span></span><span style=display:flex><span>          <span style=color:#a2f;font-weight:700>if</span> ( v41 )
</span></span><span style=display:flex><span>          {
</span></span><span style=display:flex><span>            <span style=color:#080;font-style:italic>//获得函数名称
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>            CalledFunction <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getCalledFunction</span>(v41);
</span></span><span style=display:flex><span>            Name <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span><span style=color:#00a000>getName</span>(CalledFunction);
</span></span><span style=display:flex><span>            v40 <span style=color:#666>=</span> v7;
</span></span><span style=display:flex><span>            v37 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span><span style=color:#00a000>getName</span>(v55);
</span></span><span style=display:flex><span>            v38 <span style=color:#666>=</span> v8;
</span></span><span style=display:flex><span>            <span style=color:#a2f;font-weight:700>if</span> ( (llvm<span style=color:#666>::</span>operator<span style=color:#666>==</span>(Name, v40, v37, v8) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>              <span style=color:#080;font-style:italic>//获得函数第一个参数
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>              Operand <span style=color:#666>=</span> llvm<span style=color:#666>::</span>CallBase<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v41, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>              <span style=color:#080;font-style:italic>//变成LoadInst类型
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>              v36 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>UnaryInstruction <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>LoadInst,llvm<span style=color:#666>::</span>Value<span style=color:#666>&gt;</span>(Operand);
</span></span><span style=display:flex><span>              <span style=color:#a2f;font-weight:700>if</span> ( v36 )
</span></span><span style=display:flex><span>              {
</span></span><span style=display:flex><span>                <span style=color:#080;font-style:italic>//获得LoadInst类型的第一个参数
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>                v10 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>UnaryInstruction<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v36, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>                v35[<span style=color:#666>0</span>] <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span><span style=color:#00a000>getName</span>(v10);
</span></span><span style=display:flex><span>                v35[<span style=color:#666>1</span>] <span style=color:#666>=</span> v11;
</span></span><span style=display:flex><span>                <span style=color:#080;font-style:italic>//判断LoadInst类型的第一个参数是否包含.addr，这里要手动改
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>                llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span><span style=color:#00a000>StringRef</span>((llvm<span style=color:#666>::</span>StringRef <span style=color:#666>*</span>)v34, <span style=color:#b44>&#34;.addr&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#a2f;font-weight:700>if</span> ( (llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span><span style=color:#00a000>contains</span>(v35, v34[<span style=color:#666>0</span>], v34[<span style=color:#666>1</span>]) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                  <span style=color:#080;font-style:italic>//进行这个函数的递归，v54初值为0
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>                  anonymous namespace<span style=color:#666>::</span>WMCTF<span style=color:#666>::</span>getFunctionCallValue[<span style=color:#a0a000>abi</span>:cxx11](a1, a2, v56, v50, v54 <span style=color:#666>+</span> <span style=color:#666>1</span>);
</span></span><span style=display:flex><span>                  <span style=color:#a2f;font-weight:700>return</span> a1;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#080;font-style:italic>//0，1，2，3，第3次函数调用应当不包含.addr（从第0次开始计数），防止进入if语句
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>                <span style=color:#a2f;font-weight:700>if</span> ( v54 <span style=color:#666>!=</span> <span style=color:#666>3</span> )
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                  v12 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>((llvm <span style=color:#666>*</span>)v35);
</span></span><span style=display:flex><span>                  v13 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v12, v54);
</span></span><span style=display:flex><span>                  llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v13, <span style=color:#b44>&#34;</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>                  std<span style=color:#666>::</span>allocator<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>char</span><span style=color:#666>&gt;::</span><span style=color:#00a000>allocator</span>(v33);
</span></span><span style=display:flex><span>                  std<span style=color:#666>::</span>string<span style=color:#666>::</span><span style=color:#00a000>basic_string</span>(a1, <span style=color:#b44>&#34;&#34;</span>, v33);
</span></span><span style=display:flex><span>                  std<span style=color:#666>::</span>allocator<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>char</span><span style=color:#666>&gt;::~</span><span style=color:#00a000>allocator</span>(v33);
</span></span><span style=display:flex><span>                  <span style=color:#a2f;font-weight:700>return</span> a1;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#080;font-style:italic>//这下面一大段步骤都是获取LoadInst类型的第0个参数，然后把它复制到a1,也就是刚才的v66中
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>                v32 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Value <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>UnaryInstruction<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v36, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>                v30[<span style=color:#666>0</span>] <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span><span style=color:#00a000>uses</span>(v32);
</span></span><span style=display:flex><span>                v30[<span style=color:#666>1</span>] <span style=color:#666>=</span> v14;
</span></span><span style=display:flex><span>                v31 <span style=color:#666>=</span> v30;
</span></span><span style=display:flex><span>                v29 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>iterator_range<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span>use_iterator_impl<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Use<span style=color:#666>&gt;&gt;::</span><span style=color:#00a000>begin</span>(v30);
</span></span><span style=display:flex><span>                v28 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>iterator_range<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span>use_iterator_impl<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Use<span style=color:#666>&gt;&gt;::</span><span style=color:#00a000>end</span>(v31);
</span></span><span style=display:flex><span>                <span style=color:#a2f;font-weight:700>while</span> ( (llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span>use_iterator_impl<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Use<span style=color:#666>&gt;::</span>operator<span style=color:#666>!=</span>(<span style=color:#666>&amp;</span>v29, <span style=color:#666>&amp;</span>v28) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                  v27 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>Use <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span>use_iterator_impl<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Use<span style=color:#666>&gt;::</span>operator<span style=color:#666>*</span>(<span style=color:#666>&amp;</span>v29);
</span></span><span style=display:flex><span>                  User <span style=color:#666>=</span> llvm<span style=color:#666>::</span>Use<span style=color:#666>::</span><span style=color:#00a000>getUser</span>(v27);
</span></span><span style=display:flex><span>                  <span style=color:#080;font-style:italic>//User要是StoreInst类型，一直向上溯源发现是和v32有关，v32是LoadInst类型的第0个参数
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>                  <span style=color:#080;font-style:italic>//说明LoadInst类型的第0个参数应该又是个StoreInst，怎么做到呢?
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>                  <span style=color:#080;font-style:italic>//利用flag=&#34;./flag&#34;这种赋值，然后再调用 func3(flag);这种传参就可以做到
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>                  v26 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>StoreInst <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>StoreInst,llvm<span style=color:#666>::</span>User<span style=color:#666>&gt;</span>(User);
</span></span><span style=display:flex><span>                  <span style=color:#a2f;font-weight:700>if</span> ( v26 )
</span></span><span style=display:flex><span>                  {
</span></span><span style=display:flex><span>                    v16 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>StoreInst<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v26, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>                    v25 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>ConstantExpr <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ConstantExpr,llvm<span style=color:#666>::</span>Value<span style=color:#666>&gt;</span>(v16);
</span></span><span style=display:flex><span>                    <span style=color:#a2f;font-weight:700>if</span> ( v25 )
</span></span><span style=display:flex><span>                    {
</span></span><span style=display:flex><span>                      v17 <span style=color:#666>=</span> llvm<span style=color:#666>::</span>ConstantExpr<span style=color:#666>::</span><span style=color:#00a000>getOperand</span>(v25, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>                      v24 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>GlobalVariable <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>GlobalVariable,llvm<span style=color:#666>::</span>Constant<span style=color:#666>&gt;</span>(v17);
</span></span><span style=display:flex><span>                      <span style=color:#a2f;font-weight:700>if</span> ( v24 )
</span></span><span style=display:flex><span>                      {
</span></span><span style=display:flex><span>                        Initializer <span style=color:#666>=</span> llvm<span style=color:#666>::</span>GlobalVariable<span style=color:#666>::</span><span style=color:#00a000>getInitializer</span>(v24);
</span></span><span style=display:flex><span>                        v23 <span style=color:#666>=</span> (llvm<span style=color:#666>::</span>ConstantDataSequential <span style=color:#666>*</span>)llvm<span style=color:#666>::</span>dyn_cast<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ConstantDataArray,llvm<span style=color:#666>::</span>Constant<span style=color:#666>&gt;</span>(Initializer);
</span></span><span style=display:flex><span>                        <span style=color:#a2f;font-weight:700>if</span> ( v23 )
</span></span><span style=display:flex><span>                        {
</span></span><span style=display:flex><span>                          v22[<span style=color:#666>0</span>] <span style=color:#666>=</span> llvm<span style=color:#666>::</span>ConstantDataSequential<span style=color:#666>::</span><span style=color:#00a000>getAsString</span>(v23);
</span></span><span style=display:flex><span>                          v22[<span style=color:#666>1</span>] <span style=color:#666>=</span> v19;
</span></span><span style=display:flex><span>                          llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span>str[<span style=color:#a0a000>abi</span>:cxx11](a1, v22);
</span></span><span style=display:flex><span>                          <span style=color:#a2f;font-weight:700>return</span> a1;
</span></span><span style=display:flex><span>                        }
</span></span><span style=display:flex><span>                      }
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>                  }
</span></span><span style=display:flex><span>                  llvm<span style=color:#666>::</span>Value<span style=color:#666>::</span>use_iterator_impl<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Use<span style=color:#666>&gt;::</span>operator<span style=color:#666>++</span>(<span style=color:#666>&amp;</span>v29);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>              }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>          }
</span></span><span style=display:flex><span>          llvm<span style=color:#666>::</span>ilist_iterator<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ilist_detail<span style=color:#666>::</span>node_options<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Instruction,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span>,<span style=color:#0b0;font-weight:700>void</span><span style=color:#666>&gt;</span>,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span><span style=color:#666>&gt;::</span>operator<span style=color:#666>++</span>(<span style=color:#666>&amp;</span>v44);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        llvm<span style=color:#666>::</span>ilist_iterator<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ilist_detail<span style=color:#666>::</span>node_options<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>BasicBlock,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span>,<span style=color:#0b0;font-weight:700>void</span><span style=color:#666>&gt;</span>,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span><span style=color:#666>&gt;::</span>operator<span style=color:#666>++</span>(<span style=color:#666>&amp;</span>v48);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>      llvm<span style=color:#666>::</span>ilist_iterator<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>ilist_detail<span style=color:#666>::</span>node_options<span style=color:#666>&lt;</span>llvm<span style=color:#666>::</span>Function,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span>,<span style=color:#0b0;font-weight:700>void</span><span style=color:#666>&gt;</span>,<span style=color:#a2f>false</span>,<span style=color:#a2f>false</span><span style=color:#666>&gt;::</span>operator<span style=color:#666>++</span>(v52);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    std<span style=color:#666>::</span>allocator<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>char</span><span style=color:#666>&gt;::</span><span style=color:#00a000>allocator</span>(v21);
</span></span><span style=display:flex><span>    std<span style=color:#666>::</span>string<span style=color:#666>::</span><span style=color:#00a000>basic_string</span>(a1, <span style=color:#b44>&#34;&#34;</span>, v21);
</span></span><span style=display:flex><span>    std<span style=color:#666>::</span>allocator<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>char</span><span style=color:#666>&gt;::~</span><span style=color:#00a000>allocator</span>(v21);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>else</span>
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v5 <span style=color:#666>=</span> llvm<span style=color:#666>::</span><span style=color:#00a000>errs</span>(a1);
</span></span><span style=display:flex><span>    llvm<span style=color:#666>::</span>raw_ostream<span style=color:#666>::</span>operator<span style=color:#666>&lt;&lt;</span>(v5, <span style=color:#b44>&#34;error: recursion depth exceeded</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>);
</span></span><span style=display:flex><span>    std<span style=color:#666>::</span>allocator<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>char</span><span style=color:#666>&gt;::</span><span style=color:#00a000>allocator</span>(v53);
</span></span><span style=display:flex><span>    std<span style=color:#666>::</span>string<span style=color:#666>::</span><span style=color:#00a000>basic_string</span>(a1, <span style=color:#b44>&#34;&#34;</span>, v53);
</span></span><span style=display:flex><span>    std<span style=color:#666>::</span>allocator<span style=color:#666>&lt;</span><span style=color:#0b0;font-weight:700>char</span><span style=color:#666>&gt;::~</span><span style=color:#00a000>allocator</span>(v53);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>return</span> a1;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>要注意的地方，v26 = (llvm::StoreInst *)llvm::dyn_cast
<a href=llvm::StoreInst,llvm::User title=llvm::StoreInst,llvm::User>llvm::StoreInst,llvm::User
</a>(User); 注意看代码中的分析部分，具体是是用以下方式实现</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>func4</span>(<span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>name) {
</span></span><span style=display:flex><span>        flag <span style=color:#666>=</span> <span style=color:#b44>&#34;./flag&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#00a000>func3</span>(flag);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=exp>exp
<a class=header-anchor href=#exp></a></h2><ul><li>exp.c</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>WMCTF_OPEN</span>(<span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>name);
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>WMCTF_READ</span>(<span style=color:#0b0;font-weight:700>int</span> cmd);
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>WMCTF_MMAP</span>(<span style=color:#0b0;font-weight:700>int</span> cmd);
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>WMCTF_WRITE</span>(<span style=color:#0b0;font-weight:700>int</span> cmd);
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>filename <span style=color:#666>=</span> <span style=color:#b44>&#34;./flag&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>flag <span style=color:#666>=</span> <span style=color:#b44>&#34;./flag&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>int</span> cmd <span style=color:#666>=</span> <span style=color:#666>0x8888</span>;
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>f0</span>(<span style=color:#0b0;font-weight:700>char</span><span style=color:#666>*</span> name);
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>f1</span>(<span style=color:#0b0;font-weight:700>char</span><span style=color:#666>*</span> name);
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>f2</span>(<span style=color:#0b0;font-weight:700>char</span><span style=color:#666>*</span> name);
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>f3</span>(<span style=color:#0b0;font-weight:700>char</span><span style=color:#666>*</span> name);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>func0</span>(<span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>name) {
</span></span><span style=display:flex><span>        <span style=color:#00a000>WMCTF_OPEN</span>(filename);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>func1</span>(<span style=color:#0b0;font-weight:700>char</span><span style=color:#666>*</span> name) {
</span></span><span style=display:flex><span>        <span style=color:#00a000>func0</span>(filename);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>func2</span>(<span style=color:#0b0;font-weight:700>char</span><span style=color:#666>*</span> name) {
</span></span><span style=display:flex><span>        <span style=color:#00a000>func1</span>(filename);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>func3</span>(<span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>name) {
</span></span><span style=display:flex><span>        
</span></span><span style=display:flex><span>        <span style=color:#00a000>func2</span>(filename);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>func4</span>(<span style=color:#0b0;font-weight:700>char</span> <span style=color:#666>*</span>name) {
</span></span><span style=display:flex><span>        flag <span style=color:#666>=</span> <span style=color:#b44>&#34;./flag&#34;</span>;
</span></span><span style=display:flex><span>        <span style=color:#00a000>func3</span>(flag);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0b0;font-weight:700>void</span> <span style=color:#00a000>funcmain</span>() {
</span></span><span style=display:flex><span>    <span style=color:#00a000>WMCTF_MMAP</span>(<span style=color:#666>0x7890</span>);
</span></span><span style=display:flex><span>    <span style=color:#00a000>WMCTF_READ</span>(<span style=color:#666>0x6666</span>);
</span></span><span style=display:flex><span>    <span style=color:#00a000>WMCTF_WRITE</span>(cmd);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>修改过后的ll文件，主要就是把filename这个名称变为.addr，其他的无需改动</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-ll data-lang=ll><span style=display:flex><span><span style=color:#080;font-style:italic>; ModuleID = &#39;test.c&#39;
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>source_filename</span> = <span style=color:#b44>&#34;test.c&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>target</span> <span style=color:#a2f;font-weight:700>datalayout</span> = <span style=color:#b44>&#34;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>target</span> <span style=color:#a2f;font-weight:700>triple</span> = <span style=color:#b44>&#34;x86_64-pc-linux-gnu&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>@.str = <span style=color:#a2f;font-weight:700>private</span> <span style=color:#a2f;font-weight:700>unnamed_addr</span> <span style=color:#a2f;font-weight:700>constant</span> [<span style=color:#666>7</span> <span style=color:#a2f;font-weight:700>x</span> <span style=color:#a2f;font-weight:700>i8</span>] <span style=color:#a2f;font-weight:700>c</span><span style=color:#b44>&#34;./flag\00&#34;</span>, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>1</span>
</span></span><span style=display:flex><span>@.addr = <span>dso_local</span> <span style=color:#a2f;font-weight:700>global</span> <span style=color:#a2f;font-weight:700>i8</span>* <span style=color:#a2f;font-weight:700>getelementptr</span> <span style=color:#a2f;font-weight:700>inbounds</span> ([<span style=color:#666>7</span> <span style=color:#a2f;font-weight:700>x</span> <span style=color:#a2f;font-weight:700>i8</span>], [<span style=color:#666>7</span> <span style=color:#a2f;font-weight:700>x</span> <span style=color:#a2f;font-weight:700>i8</span>]* @.str, <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>0</span>, <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>0</span>), <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>@flag = <span>dso_local</span> <span style=color:#a2f;font-weight:700>global</span> <span style=color:#a2f;font-weight:700>i8</span>* <span style=color:#a2f;font-weight:700>getelementptr</span> <span style=color:#a2f;font-weight:700>inbounds</span> ([<span style=color:#666>7</span> <span style=color:#a2f;font-weight:700>x</span> <span style=color:#a2f;font-weight:700>i8</span>], [<span style=color:#666>7</span> <span style=color:#a2f;font-weight:700>x</span> <span style=color:#a2f;font-weight:700>i8</span>]* @.str, <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>0</span>, <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>0</span>), <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>@cmd = <span>dso_local</span> <span style=color:#a2f;font-weight:700>global</span> <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>34952</span>, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>4</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>; Function Attrs: noinline nounwind optnone uwtable
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>define</span> <span>dso_local</span> <span style=color:#0b0;font-weight:700>void</span> @func0(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %0) #0 {
</span></span><span style=display:flex><span>  %2 = <span style=color:#a2f;font-weight:700>alloca</span> <span style=color:#a2f;font-weight:700>i8</span>*, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>store</span> <span style=color:#a2f;font-weight:700>i8</span>* %0, <span style=color:#a2f;font-weight:700>i8</span>** %2, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  %3 = <span style=color:#a2f;font-weight:700>load</span> <span style=color:#a2f;font-weight:700>i8</span>*, <span style=color:#a2f;font-weight:700>i8</span>** @.addr, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_OPEN(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %3)
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>ret</span> <span style=color:#0b0;font-weight:700>void</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>declare</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_OPEN(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span>) #1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>; Function Attrs: noinline nounwind optnone uwtable
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>define</span> <span>dso_local</span> <span style=color:#0b0;font-weight:700>void</span> @func1(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %0) #0 {
</span></span><span style=display:flex><span>  %2 = <span style=color:#a2f;font-weight:700>alloca</span> <span style=color:#a2f;font-weight:700>i8</span>*, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>store</span> <span style=color:#a2f;font-weight:700>i8</span>* %0, <span style=color:#a2f;font-weight:700>i8</span>** %2, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  %3 = <span style=color:#a2f;font-weight:700>load</span> <span style=color:#a2f;font-weight:700>i8</span>*, <span style=color:#a2f;font-weight:700>i8</span>** @.addr, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @func0(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %3)
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>ret</span> <span style=color:#0b0;font-weight:700>void</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>; Function Attrs: noinline nounwind optnone uwtable
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>define</span> <span>dso_local</span> <span style=color:#0b0;font-weight:700>void</span> @func2(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %0) #0 {
</span></span><span style=display:flex><span>  %2 = <span style=color:#a2f;font-weight:700>alloca</span> <span style=color:#a2f;font-weight:700>i8</span>*, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>store</span> <span style=color:#a2f;font-weight:700>i8</span>* %0, <span style=color:#a2f;font-weight:700>i8</span>** %2, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  %3 = <span style=color:#a2f;font-weight:700>load</span> <span style=color:#a2f;font-weight:700>i8</span>*, <span style=color:#a2f;font-weight:700>i8</span>** @.addr, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @func1(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %3)
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>ret</span> <span style=color:#0b0;font-weight:700>void</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>; Function Attrs: noinline nounwind optnone uwtable
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>define</span> <span>dso_local</span> <span style=color:#0b0;font-weight:700>void</span> @func3(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %0) #0 {
</span></span><span style=display:flex><span>  %2 = <span style=color:#a2f;font-weight:700>alloca</span> <span style=color:#a2f;font-weight:700>i8</span>*, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>store</span> <span style=color:#a2f;font-weight:700>i8</span>* %0, <span style=color:#a2f;font-weight:700>i8</span>** %2, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  %3 = <span style=color:#a2f;font-weight:700>load</span> <span style=color:#a2f;font-weight:700>i8</span>*, <span style=color:#a2f;font-weight:700>i8</span>** @.addr, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @func2(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %3)
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>ret</span> <span style=color:#0b0;font-weight:700>void</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>; Function Attrs: noinline nounwind optnone uwtable
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>define</span> <span>dso_local</span> <span style=color:#0b0;font-weight:700>void</span> @func4(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %0) #0 {
</span></span><span style=display:flex><span>  %2 = <span style=color:#a2f;font-weight:700>alloca</span> <span style=color:#a2f;font-weight:700>i8</span>*, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>store</span> <span style=color:#a2f;font-weight:700>i8</span>* %0, <span style=color:#a2f;font-weight:700>i8</span>** %2, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>store</span> <span style=color:#a2f;font-weight:700>i8</span>* <span style=color:#a2f;font-weight:700>getelementptr</span> <span style=color:#a2f;font-weight:700>inbounds</span> ([<span style=color:#666>7</span> <span style=color:#a2f;font-weight:700>x</span> <span style=color:#a2f;font-weight:700>i8</span>], [<span style=color:#666>7</span> <span style=color:#a2f;font-weight:700>x</span> <span style=color:#a2f;font-weight:700>i8</span>]* @.str, <span style=color:#a2f;font-weight:700>i64</span> <span style=color:#666>0</span>, <span style=color:#a2f;font-weight:700>i64</span> <span style=color:#666>0</span>), <span style=color:#a2f;font-weight:700>i8</span>** @flag, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  %3 = <span style=color:#a2f;font-weight:700>load</span> <span style=color:#a2f;font-weight:700>i8</span>*, <span style=color:#a2f;font-weight:700>i8</span>** @flag, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>8</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @func3(<span style=color:#a2f;font-weight:700>i8</span>* <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %3)
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>ret</span> <span style=color:#0b0;font-weight:700>void</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>; Function Attrs: noinline nounwind optnone uwtable
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>define</span> <span>dso_local</span> <span style=color:#0b0;font-weight:700>void</span> @funcmain() #0 {
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_MMAP(<span style=color:#a2f;font-weight:700>i32</span> <span>no</span><span style=color:#a2f;font-weight:700>undef</span> <span style=color:#666>30864</span>)
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_READ(<span style=color:#a2f;font-weight:700>i32</span> <span>no</span><span style=color:#a2f;font-weight:700>undef</span> <span style=color:#666>26214</span>)
</span></span><span style=display:flex><span>  %1 = <span style=color:#a2f;font-weight:700>load</span> <span style=color:#a2f;font-weight:700>i32</span>, <span style=color:#a2f;font-weight:700>i32</span>* @cmd, <span style=color:#a2f;font-weight:700>align</span> <span style=color:#666>4</span>
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>call</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_WRITE(<span style=color:#a2f;font-weight:700>i32</span> <span>no</span><span style=color:#a2f;font-weight:700>undef</span> %1)
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>ret</span> <span style=color:#0b0;font-weight:700>void</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>declare</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_MMAP(<span style=color:#a2f;font-weight:700>i32</span> <span>no</span><span style=color:#a2f;font-weight:700>undef</span>) #1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>declare</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_READ(<span style=color:#a2f;font-weight:700>i32</span> <span>no</span><span style=color:#a2f;font-weight:700>undef</span>) #1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>declare</span> <span style=color:#0b0;font-weight:700>void</span> @WMCTF_WRITE(<span style=color:#a2f;font-weight:700>i32</span> <span>no</span><span style=color:#a2f;font-weight:700>undef</span>) #1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>attributes</span> #0 = { <span style=color:#a2f;font-weight:700>noinline</span> <span style=color:#a2f;font-weight:700>nounwind</span> <span style=color:#a2f;font-weight:700>optnone</span> <span style=color:#a2f;font-weight:700>uwtable</span> <span style=color:#b44>&#34;frame-pointer&#34;</span>=<span style=color:#b44>&#34;all&#34;</span> <span style=color:#b44>&#34;min-legal-vector-width&#34;</span>=<span style=color:#b44>&#34;0&#34;</span> <span style=color:#b44>&#34;no-trapping-math&#34;</span>=<span style=color:#b44>&#34;true&#34;</span> <span style=color:#b44>&#34;stack-protector-buffer-size&#34;</span>=<span style=color:#b44>&#34;8&#34;</span> <span style=color:#b44>&#34;target-cpu&#34;</span>=<span style=color:#b44>&#34;x86-64&#34;</span> <span style=color:#b44>&#34;target-features&#34;</span>=<span style=color:#b44>&#34;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&#34;</span> <span style=color:#b44>&#34;tune-cpu&#34;</span>=<span style=color:#b44>&#34;generic&#34;</span> }
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>attributes</span> #1 = { <span style=color:#b44>&#34;frame-pointer&#34;</span>=<span style=color:#b44>&#34;all&#34;</span> <span style=color:#b44>&#34;no-trapping-math&#34;</span>=<span style=color:#b44>&#34;true&#34;</span> <span style=color:#b44>&#34;stack-protector-buffer-size&#34;</span>=<span style=color:#b44>&#34;8&#34;</span> <span style=color:#b44>&#34;target-cpu&#34;</span>=<span style=color:#b44>&#34;x86-64&#34;</span> <span style=color:#b44>&#34;target-features&#34;</span>=<span style=color:#b44>&#34;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&#34;</span> <span style=color:#b44>&#34;tune-cpu&#34;</span>=<span style=color:#b44>&#34;generic&#34;</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#b8860b>!llvm.module.flags</span> = !{!0, !1, !2, !3, !4}
</span></span><span style=display:flex><span><span style=color:#b8860b>!llvm.ident</span> = !{!5}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>!0 = !{<span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>1</span>, <span style=color:#b8860b>!&#34;wchar_size&#34;</span>, <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>4</span>}
</span></span><span style=display:flex><span>!1 = !{<span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>7</span>, <span style=color:#b8860b>!&#34;PIC Level&#34;</span>, <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>2</span>}
</span></span><span style=display:flex><span>!2 = !{<span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>7</span>, <span style=color:#b8860b>!&#34;PIE Level&#34;</span>, <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>2</span>}
</span></span><span style=display:flex><span>!3 = !{<span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>7</span>, <span style=color:#b8860b>!&#34;uwtable&#34;</span>, <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>1</span>}
</span></span><span style=display:flex><span>!4 = !{<span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>7</span>, <span style=color:#b8860b>!&#34;frame-pointer&#34;</span>, <span style=color:#a2f;font-weight:700>i32</span> <span style=color:#666>2</span>}
</span></span><span style=display:flex><span>!5 = !{<span style=color:#b8860b>!&#34;Ubuntu clang version 14.0.0-1ubuntu1.1&#34;</span>}
</span></span></code></pre></div><ul><li>相关sh脚本</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-bash data-lang=bash><span style=display:flex><span>opt -load ./WMCTF.so -WMCTF -enable-new-pm<span style=color:#666>=</span><span style=color:#666>0</span> ./test.ll
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>clang -emit-llvm -S test.c -o test.ll
</span></span></code></pre></div><ul><li>至此就打通了 <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos4/48.png alt></li></ul><h2 id=后记与反思>后记与反思
<a class=header-anchor href=#%e5%90%8e%e8%ae%b0%e4%b8%8e%e5%8f%8d%e6%80%9d></a></h2><p>笔者还剩一处没有懂的地方，就是这里的递归调用次数，这里笔者认为的递归次数比实际exp少1，但是通过调试发现只有exp这种形式才打得通，目前尚未解决这个问题</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#a2f;font-weight:700>if</span> ( (llvm<span style=color:#666>::</span>StringRef<span style=color:#666>::</span><span style=color:#00a000>contains</span>(v35, v34[<span style=color:#666>0</span>], v34[<span style=color:#666>1</span>]) <span style=color:#666>&amp;</span> <span style=color:#666>1</span>) <span style=color:#666>!=</span> <span style=color:#666>0</span> )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#080;font-style:italic>//进行这个函数的递归，v54初值为0
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>  anonymous namespace<span style=color:#666>::</span>WMCTF<span style=color:#666>::</span>getFunctionCallValue[<span style=color:#a0a000>abi</span>:cxx11](a1, a2, v56, v50, v54 <span style=color:#666>+</span> <span style=color:#666>1</span>);
</span></span><span style=display:flex><span>  <span style=color:#a2f;font-weight:700>return</span> a1;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>//0，1，2，3，第3次函数调用应当不包含.addr（从第0次开始计数），防止进入if语句
</span></span></span></code></pre></div><p>在打WMCTF的时候此题最主要卡的地方是LoadInst这个东西，因为笔者逆向能力不是很强，所以想通过pwndbg调试查看执行流程以及堆栈情况看看函数在做些什么，但对于这个复杂的过程，动调真的很难看懂，看来看去就看到开辟了好复杂的堆空间，对解题没有一点帮助。</p><p>最终解决LoadInst是在尝试的过程中，偶然发现什么时候会出现load和store这两种指令，然后根据逆向的猜测，发现实际情况确实如此，再结合getOperand这个函数，推测LoadInst，StoreInst和CallInst类似，也是可以获取它的第几个参数（但一般都是第0个），从而豁然开朗，明白如何绕过这些条件判断控制流程</p><p>要加强逆向能力，要有耐心逆向，逆不出来多搜索，能否找到相近源码，或者不明白具体哪一个函数，网上搜搜是否有对应解答，都能帮助逆向。ida有时候看代码不方便，可以放到vscode里面帮助阅读。想要仅靠动调就明白函数的具体作用，笔者认为是很难的。总之逆向是一种综合能力的体现，多练，耐心，才能增强逆向能力。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/llvm-pwn>llvm pwn</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="f1ow - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="f1ow - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
llvm中ll文件解读</li><li class=post-copyright-author><strong>本文作者： </strong>f1ow</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://zp9080.github.io/post/llvm-pwn/llvm%E4%B8%ADll%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/ title=llvm中ll文件解读>https://zp9080.github.io/post/llvm-pwn/llvm%E4%B8%ADll%E6%96%87%E4%BB%B6%E8%A7%A3%E8%AF%BB/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/%E5%A0%86%E6%94%BB%E5%87%BBio_file/libc2.27%E4%B8%8B%E7%9A%84house-of-orange+house-of-apple2/ rel=next title="libc2.27下的house of orange+house of apple2"><i class="fa fa-chevron-left"></i> libc2.27下的house of orange+house of apple2</a></div><div class="post-nav-prev post-nav-item"><a href=/post/iot/goahead%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/ rel=prev title=goahead源码阅读>goahead源码阅读
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2024 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>f1ow</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.126.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.6.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>鄂ICP备 20240001号</a>
<img src=/imgs/gongan.png alt=鄂公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42010002002000" target=_blank>鄂公网安备 42010002002000 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://github.com title=Github><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/github.svg alt=Github>
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://zp9080.github.io/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://zp9080.github.io/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://zp9080.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://zp9080.github.io/3rd"}},"version":"4.6.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src=/js/main.min.befa9b7d22ec90da86c74c5dbff5ee42c12e9fc6d6f4448bfcc596cc329b19e8.js defer></script></body></html>